<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Sumner HPC Setup 2021: Part 3"><meta name=author content="Samir B. Amin"><link href=https://code.sbamin.com/1.0/hpc/cpu/sumner_3/ rel=canonical><link rel=icon href=/assets/images/fixed/favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-8.1.5"><title>Part 3 - Programming 101</title><link rel=stylesheet href=../../../assets/stylesheets/main.ee0f47ba.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.e6a45f82.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CFira+Code&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Fira Code"}</style><link rel=stylesheet href=../../../assets/css/extra.css><script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><!-- Determine analytics provider (deprecated, removed in v8) --><!-- Determine analytics provider --><!-- Set up analytics provider --><!-- Determine analytics property (deprecated, removed in v8) --><!-- Determine analytics property --><!-- Google Analytics 4 (G-XXXXXXXXXX) --><script>
    window.ga = window.ga || function() {
      (ga.q = ga.q || []).push(arguments)
    }
    ga.l = +new Date()

    /* Set up integration and send page view */
    ga("create", "UA-307297-1", "auto")
    ga("set", "anonymizeIp", true)
    ga("send", "pageview")

    /* Register virtual event handlers */
    document.addEventListener("DOMContentLoaded", function() {
      if (document.forms.search) {
        var query = document.forms.search.query
        query.addEventListener("blur", function() {
          if (this.value) {
            var path = document.location.pathname;
            ga("send", "pageview", path + "?q=" + this.value)
          }
        })
      }

      /* Send page view on location change */
      if (typeof location$ !== "undefined")
        location$.subscribe(function(url) {
          ga("send", "pageview", url.pathname)
        })
    })
  </script><script async src=https://www.google-analytics.com/analytics.js></script><!--   <link rel="stylesheet" href="https://code.sbamin.com/1.0../../../assets/stylesheets/main.c296cc61.min.css"> --><meta name=keywords content=sumner,hpc,conda,bash,jupyter,programming><meta property=og:type content=website><meta property=og:title content="Part 3 · Programming 101"><meta property=og:description content="Sumner HPC Setup 2021: Part 3"><meta content=https://code.sbamin.com/1.0/hpc/cpu/sumner_3/ property=og:url><meta property=og:image content=https://code.sbamin.com/1.0assets/images/fixed/sitelogo.png><meta property=og:image:type content=image/png><meta property=og:image:width content=256><meta property=og:image:height content=256><meta name=twitter:card content=summary><meta name=twitter:site content=@sbamin><meta name=twitter:creator content=@sbamin><meta name=twitter:title content="Part 3 · Programming 101"><meta name=twitter:description content="Sumner HPC Setup 2021: Part 3"><meta name=twitter:image content=https://code.sbamin.com/1.0assets/images/fixed/sitelogo.png><meta name=twitter:image:alt content="webpage banner or site logo"></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#julia class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> <div class="md-banner__inner md-grid md-typeset"> You're not viewing the latest version. <a href=../../../..> <strong>Click here to go to latest.</strong> </a> </div> <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="Programming 101" class="md-header__button md-logo" aria-label="Programming 101" data-md-component=logo> <img src=../../../assets/images/fixed/sitelogo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Programming 101 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Part 3 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=teal data-md-color-accent=light-green aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/sbamin/code101/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> sbamin/code101 </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../ class="md-tabs__link md-tabs__link--active"> Getting started with HPC </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Programming 101" class="md-nav__button md-logo" aria-label="Programming 101" data-md-component=logo> <img src=../../../assets/images/fixed/sitelogo.png alt=logo> </a> Programming 101 </label> <div class=md-nav__source> <a href=https://github.com/sbamin/code101/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> sbamin/code101 </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <div class="md-nav__link md-nav__link--index "> <a href=../../ >Getting started with HPC</a> <label for=__nav_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Getting started with HPC" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting started with HPC </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2 type=checkbox id=__nav_2_2 checked> <label class=md-nav__link for=__nav_2_2> CPU Computing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="CPU Computing" data-md-level=2> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> CPU Computing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../sumner_1/ class=md-nav__link> Part 1 </a> </li> <li class=md-nav__item> <a href=../sumner_2/ class=md-nav__link> Part 2 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Part 3 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Part 3 </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#julia class=md-nav__link> Julia </a> <nav class=md-nav aria-label=Julia> <ul class=md-nav__list> <li class=md-nav__item> <a href=#reconfigure-julia-base-directory class=md-nav__link> Reconfigure julia base directory </a> </li> <li class=md-nav__item> <a href=#install-julia-kernel class=md-nav__link> Install julia kernel </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#database class=md-nav__link> Database </a> <nav class=md-nav aria-label=Database> <ul class=md-nav__list> <li class=md-nav__item> <a href=#postgresql-driver class=md-nav__link> postgresql driver </a> </li> <li class=md-nav__item> <a href=#jupyterlab-sql-deprecated class=md-nav__link> jupyterlab-sql (deprecated) </a> </li> <li class=md-nav__item> <a href=#postgresql-kernel class=md-nav__link> postgresql kernel </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#python-2 class=md-nav__link> Python 2 </a> </li> <li class=md-nav__item> <a href=#ruby class=md-nav__link> Ruby </a> </li> <li class=md-nav__item> <a href=#perl class=md-nav__link> Perl </a> <nav class=md-nav aria-label=Perl> <ul class=md-nav__list> <li class=md-nav__item> <a href=#setup-perl5lib class=md-nav__link> setup PERL5LIB </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#snakemake class=md-nav__link> Snakemake </a> </li> <li class=md-nav__item> <a href=#additional-setup class=md-nav__link> Additional Setup </a> <nav class=md-nav aria-label="Additional Setup"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#jupytext class=md-nav__link> JupyText </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#modules class=md-nav__link> Modules </a> </li> <li class=md-nav__item> <a href=#containers class=md-nav__link> Containers </a> </li> <li class=md-nav__item> <a href=#tips-on-compiling-packages class=md-nav__link> Tips on compiling packages </a> </li> <li class=md-nav__item> <a href=#bash-startup class=md-nav__link> bash startup </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3> GPU Computing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="GPU Computing" data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> GPU Computing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../gpu/winter_1/ class=md-nav__link> Part 1 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#julia class=md-nav__link> Julia </a> <nav class=md-nav aria-label=Julia> <ul class=md-nav__list> <li class=md-nav__item> <a href=#reconfigure-julia-base-directory class=md-nav__link> Reconfigure julia base directory </a> </li> <li class=md-nav__item> <a href=#install-julia-kernel class=md-nav__link> Install julia kernel </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#database class=md-nav__link> Database </a> <nav class=md-nav aria-label=Database> <ul class=md-nav__list> <li class=md-nav__item> <a href=#postgresql-driver class=md-nav__link> postgresql driver </a> </li> <li class=md-nav__item> <a href=#jupyterlab-sql-deprecated class=md-nav__link> jupyterlab-sql (deprecated) </a> </li> <li class=md-nav__item> <a href=#postgresql-kernel class=md-nav__link> postgresql kernel </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#python-2 class=md-nav__link> Python 2 </a> </li> <li class=md-nav__item> <a href=#ruby class=md-nav__link> Ruby </a> </li> <li class=md-nav__item> <a href=#perl class=md-nav__link> Perl </a> <nav class=md-nav aria-label=Perl> <ul class=md-nav__list> <li class=md-nav__item> <a href=#setup-perl5lib class=md-nav__link> setup PERL5LIB </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#snakemake class=md-nav__link> Snakemake </a> </li> <li class=md-nav__item> <a href=#additional-setup class=md-nav__link> Additional Setup </a> <nav class=md-nav aria-label="Additional Setup"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#jupytext class=md-nav__link> JupyText </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#modules class=md-nav__link> Modules </a> </li> <li class=md-nav__item> <a href=#containers class=md-nav__link> Containers </a> </li> <li class=md-nav__item> <a href=#tips-on-compiling-packages class=md-nav__link> Tips on compiling packages </a> </li> <li class=md-nav__item> <a href=#bash-startup class=md-nav__link> bash startup </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <!-- Add copied contents from original content.html here --> <!-- https://raw.githubusercontent.com/squidfunk/mkdocs-material/master/src/partials/content.html --> <!-- Edit button --> <a href=https://github.com/sbamin/code101/edit/scratch/web/docs/hpc/cpu/sumner_3.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <!--
  Hack: check whether the content contains a h1 headline. If it
  doesn't, the page title (or respectively site name) is used
  as the main headline.
--> <h1>Part 3</h1> <!-- Markdown content --> <p>Continuing the setup from the <a href=../sumner_2/ >Part 2</a>, now we will finalize setup for Sumner or CPU-optimized HPC with following key configurations:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox checked><span class=task-list-indicator></span></label> Install additional tools and conda envs for Sumner (CPU-based) HPC:<ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox checked><span class=task-list-indicator></span></label> Julia in <em>yoda</em> env</li> <li class=task-list-item><label class=task-list-control><input type=checkbox checked><span class=task-list-indicator></span></label> a new env, <em>luke</em> for installing sql related backend tools, and</li> <li class=task-list-item><label class=task-list-control><input type=checkbox checked><span class=task-list-indicator></span></label> a new env, <em>leia</em> for running <a href=https://snakemake.readthedocs.io>snakemake</a> workflows.</li> </ul> </li> <li class=task-list-item><label class=task-list-control><input type=checkbox checked><span class=task-list-indicator></span></label> Configure <a href=https://modules.readthedocs.io>Modules</a> to load tools that either I use infrequently or require multiple dependencies that may break my stable env, <em>yoda</em></li> <li class=task-list-item><label class=task-list-control><input type=checkbox checked><span class=task-list-indicator></span></label> Finalize <strong>bash startup env</strong> using <em>~/.profile.d/</em> configuration.</li> </ul> <p>Let's start with a fresh <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path fill-rule=evenodd d="M0 2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25V2.75zm1.75-.25a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25V2.75a.25.25 0 0 0-.25-.25H1.75zM7.25 8a.75.75 0 0 1-.22.53l-2.25 2.25a.75.75 0 1 1-1.06-1.06L5.44 8 3.72 6.28a.75.75 0 1 1 1.06-1.06l2.25 2.25c.141.14.22.331.22.53zm1.5 1.5a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5h-3z"/></svg></span> terminal session:</p> <div class=highlight><pre><span></span><code><span class=nb>exit</span> <span class=c1># from prior interactive session, if any</span>
<span class=nb>exit</span> <span class=c1># from sumner</span>

ssh sumner

screen
<span class=c1>## start interactive session</span>
srun -p compute -q batch -N <span class=m>1</span> -n <span class=m>4</span> --mem 10G -t <span class=m>08</span>:00:00 --pty bash

<span class=c1>## activate env</span>
conda activate yoda

<span class=c1>## unload gcc if loaded</span>
module unload gcc
</code></pre></div> <blockquote> <p>Confirm that <code>echo $PATH</code> output should now have paths related to conda env <strong>prefixed</strong> but nothing else related to modules, LD_LIBRARY_PATH, etc.</p> </blockquote> <p>Also, make sure that module: <code>gcc</code> is unloaded and should not show up in <code>module list</code> output. We do not want system gcc (or any other devtools), and instead rely on conda-installed devtools when compiling R libraries or any other softwares, e.g., samtools, bcftools, etc.</p> <div class=highlight><pre><span></span><code><span class=c1>## example PATH variable</span>
/projects/verhaak-lab/amins/hpcenv/mambaforge/envs/yoda/bin:/projects/verhaak-lab/amins/hpcenv/mambaforge/condabin:/cm/shared/apps/slurm/18.08.8/sbin:/cm/shared/apps/slurm/18.08.8/bin:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/amins/.local/bin:/home/amins/bin

<span class=c1>## example LD_LIBRARY_PATH variable</span>
/cm/shared/apps/slurm/18.08.8/lib64/slurm:/cm/shared/apps/slurm/18.08.8/lib64
</code></pre></div> <details class=info><summary>Duplicate entries in PATH and LD_LIBRARY_PATH</summary><p>If you are using <code>screen</code>, you may notice duplicate entries for one or more paths, typically for those which are loaded by the system defaults, e.g., modules and <code>/usr/local/...</code>. We will take care of this later when setting up our <strong>bash startup</strong> using <em>~/.profile.d/</em> configurations.</p> </details> <h2 id=julia>Julia<a class=headerlink href=#julia title="Permanent link">&para;</a></h2> <p>Since I use Julia alongside R and Python, I will install it under a primary env, <em>yoda</em>. I will prefer using a long-term support (LTS) version over the latest version. You can install julia via conda-forge channel. However, I'd trouble running conda installed julia in jupyter notebooks with kernel unable to start and connect to console<sup id=fnref:julia1><a class=footnote-ref href=#fn:julia1>1</a></sup>. Hence, I ended up installing pre-compiled version from <a href=https://julialang.org/downloads/ >julia downloads page</a> and then adjusting PATH variable to setup <code>julia</code> command using <em>~/.bashrc</em> or preferably <em>~/.profile.d/</em> configuration (explained later).</p> <details class=tip><summary>Removing conda installed version of julia</summary><p>If you have previously installed julia in conda env, <em>yoda</em> and now like to remove it, you can run <code>mamba remove -n yoda julia</code> to remove julia and all of dependencies which are NOT shared by other conda installed packages. Before removing dependencies, it's good to check if any of removed packages (shared libraries in particular) are requirements or not for other packages by <a href=https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-pkgs.html>listing package dependencies</a>.</p> <p>After ensuring no other conda packages require julia-related dependencies, I used <code>mamba remove -n yoda julia libunwind</code> to remove conda-installed julia and its dependencies.</p> </details> <ul> <li>Create an empty path to store compiled packages. Later in the setup (Modules section), I will end up loading most of these packages as <code>module load package</code> as I use them less often. For julia, I will rather use bash startup to assign it to PATH variable and load it as a routine package.</li> </ul> <div class=highlight><pre><span></span><code>mkdir -p /projects/verhaak-lab/amins/hpcenv/opt/modules/apps/julia
</code></pre></div> <ul> <li>Install LTS version of julia: Go to <a href=https://julialang.org/downloads/ >julia downloads</a> page and download <em>64-bit</em> LTS version (and not one with <em>musl</em> which is <a href=https://en.wikipedia.org/wiki/Static_library>statically linked</a> libraries).</li> </ul> <div class=highlight><pre><span></span><code><span class=nb>cd</span> /projects/verhaak-lab/amins/hpcenv/opt/modules/apps/julia
wget https://julialang-s3.julialang.org/bin/linux/x64/1.6/julia-1.6.4-linux-x86_64.tar.gz

tar xvzf julia-1.6.4-linux-x86_64.tar.gz

<span class=c1># This is to standardize package naming for module definitions, if any.</span>
mv julia-1.6.4 <span class=m>1</span>.6.4
</code></pre></div> <h3 id=reconfigure-julia-base-directory>Reconfigure julia base directory<a class=headerlink href=#reconfigure-julia-base-directory title="Permanent link">&para;</a></h3> <p>By default, julia will store packages (which takes much of space) into <em>~/.julia</em>. Since my home directory is capped at 50 GB, I will reconfigure julia to use non-home path (on tier 1 space) for storing packages. Before reconfiguring, <strong>please read <a href=https://docs.julialang.org/en/v1/manual/environment-variables/ >Environment Variable</a></strong> section in julia documentation and <a href=https://stackoverflow.com/questions/36398629/change-package-directory-in-julia>following post on stackoverflow</a>.</p> <details class=info><summary>Why not to simply move <em>~/.julia/</em> to a new place?</summary><p>Perhaps the easiest solution would be to move <em>~/.julia/</em> to a new path and symlink it from there. While it looks easy, I usually avoid such hack as several softwares, including conda and some of commands of python and R rely on <a href=https://stackoverflow.com/questions/185899/what-is-the-difference-between-a-symbolic-link-and-a-hard-link>hardlinks over symnlinks</a> and can throw errors. Besides, it is always good to understand how softwares set default configurations.</p> </details> <ul> <li>Since pre-compiled julia is not in bash PATH, for now, we will just run following command to manually make julia available in PATH for <strong>the current terminal session</strong>. Once setup is complete, we will set julia path in PATH permanently using bash startup, so julia can load anytime we login to HPC.</li> </ul> <div class=highlight><pre><span></span><code><span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span><span class=s2>&quot;/projects/verhaak-lab/amins/hpcenv/opt/modules/apps/julia/1.6.4/bin:</span><span class=si>${</span><span class=nv>PATH</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=nb>echo</span> <span class=s2>&quot;</span><span class=nv>$PATH</span><span class=s2>&quot;</span>
</code></pre></div> <ul> <li>Start julia prompt.</li> </ul> <div class=highlight><pre><span></span><code><span class=c1># show location of julia</span>
<span class=nb>command</span> -v julia

<span class=c1># start julia prompt</span>
julia
</code></pre></div> <details class=bug><summary>segmentation fault running julia</summary><p>If you have <em>libunwind</em> library for some other conda package(s) and if it is a version higher than 1.5.0, running <code>julia</code> command may throw an error saying segmentation fault. More at <a class="magiclink magiclink-github magiclink-issue" href=https://github.com/conda-forge/julia-feedstock/issues/135 title="GitHub Issue: conda-forge/julia-feedstock #135">conda-forge/julia-feedstock#135</a>. In that case, you may need to tweak PATH and LD_LIBRARY_PATH such that conda installed <em>libunwind</em> does not take precedence when running julia. This is usually achieved using <code>module load julia</code> prior to running julia and thus, tweaking required PATH and LD_LIBRARY_PATH. Alternately, you may downgrade conda installed libunwind only if conda does not throw a warning. <code>mamba install -c conda-forge libunwind=1.5.0</code></p> </details> <ul> <li>Once inside julia terminal, notice existing paths from an output of julia command: <code>DEPOT_PATH</code></li> </ul> <div class=highlight><pre><span></span><code><span class=mi>3</span><span class=o>-</span><span class=n>element</span> <span class=kt>Vector</span><span class=p>{</span><span class=kt>String</span><span class=p>}</span><span class=o>:</span>
 <span class=s>&quot;/home/amins/.julia&quot;</span>
 <span class=s>&quot;/projects/verhaak-lab/amins/hpcenv/opt/modules/apps/julia/1.6.4/local/share/julia&quot;</span>
 <span class=s>&quot;/projects/verhaak-lab/amins/hpcenv/opt/modules/apps/julia/1.6.4/share/julia&quot;</span>
</code></pre></div> <ul> <li>Quit julia by <span class=keys><kbd class=key-control>Ctrl</kbd><span>+</span><kbd class=key-d>D</kbd></span></li> </ul> <p>We will now update PATH variable and also set a new bash env variable, <code>JULIA_DEPOT_PATH</code> in <em>~/.bashrc</em>/ Once we finalize <strong>bash startup</strong>, we will move most of custom configurations from <em>~/.bashrc</em> to a dedicated <em>~/.profile.d/</em> directory.</p> <p>Since we have not installed any julia packages, only packages that are shipped with julia are at <em>/projects/verhaak-lab/amins/hpcenv/opt/modules/apps/julia/1.6.4/share/julia/</em>, specifically under <em>base/</em> subdirectory. We like to keep this path unaltered and hence, we will keep it at the last in <code>JULIA_DEPOT_PATH</code> to assign the lowest priority to install new packages.</p> <ul> <li>First, make an empty package directory <a href=../SR2_setup/#setup-rprofile-and-renviron>similar to R package directory</a> we created earlier.</li> </ul> <div class=highlight><pre><span></span><code>mkdir -p /projects/verhaak-lab/amins/hpcenv/opt/julia/pkgs/1.6
</code></pre></div> <ul> <li>Now copy all of <em>~/.julia/</em> contents to this new path. Since we have not installed any new packages, we will be copying only a skeleton of directory and files to a new package path.</li> </ul> <div class=highlight><pre><span></span><code>rsync -avhP ~/.julia/ /projects/verhaak-lab/amins/hpcenv/opt/julia/pkgs/1.6/
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>Do not delete <em>~/.julia/</em> directory</p> <p>Do not delete <em>~/.julia/</em> after copying it to a new path. Julia will still use this path to store user-defined configurations, primarily under <em>~/.julia/config/startup.jl</em> file. Please read <a href=https://docs.julialang.org/en/v1/manual/environment-variables/ >Environment Variable</a> in julia documentation if you have not read that yet!</p> </div> <ul> <li>Add following line to <em>~/.bashrc</em>, preferably above the <code># &gt;&gt;&gt; conda initialize &gt;&gt;&gt;</code> line because we like to take conda setup precedence over rest of configurations during bash startup.</li> </ul> <div class=highlight><pre><span></span><code><span class=c1>#### custom configs ####</span>
<span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span><span class=s2>&quot;/projects/verhaak-lab/amins/hpcenv/opt/modules/apps/julia/1.6.4/bin:</span><span class=si>${</span><span class=nv>PATH</span><span class=si>}</span><span class=s2>&quot;</span>

<span class=nb>export</span> <span class=nv>JULIA_DEPOT_PATH</span><span class=o>=</span><span class=s2>&quot;/projects/verhaak-lab/amins/hpcenv/opt/julia/pkgs/1.6:/projects/verhaak-lab/amins/hpcenv/opt/modules/apps/julia/1.6.4/local/share/julia:/projects/verhaak-lab/amins/hpcenv/opt/modules/apps/julia/1.6.4/share/julia&quot;</span>

<span class=c1># &gt;&gt;&gt; conda initialize &gt;&gt;&gt;</span>
</code></pre></div> <blockquote> <p>Notice that we have now purposefully kept <em>~/.julia/</em> path out of default paths to store packages. Of course, julia will still use <em>~/.julia/</em> for storing user configurations among other things but those should not take up much space as installing packages do. If otherwise, we will know later and come up with a better solution!</p> </blockquote> <ul> <li>Before we start julia again to check new <code>DEPOT_PATH</code>, ensure that an updated bash startup has been loaded from <em>~/.bashrc</em> file. Ideally, you should exit from a current session and login again same as we did in the beginning of this page. Alternately, you may run above <code>export JULIA_...</code> command in the current terminal to update julia env variable.</li> </ul> <details class=info><summary>Why not we do <code>source ~/.bash_profile</code> or <code>source ~/.bashrc</code>?</summary><p>You may do <code>source ~/.bash_profile</code> but <strong>do note</strong> that this may have unwanted effects on PATH and LD_LIBRARY_PATH variables depending on how <em>~/.bashrc</em> is loading bash startup env, including from <code>/etc/bashrc</code>. In a nutshell, better to run a single command as follows or the best is to log out and login again to have updated bash startup to take an effect.</p> </details> <ul> <li>Update current terminal env with an updated depot path variable. Make sure to run subsequent <code>julia</code> command in the same terminal (and not in any other terminal sessions in screen you may have already opened) else julia may fall back to old depot path.</li> </ul> <div class=highlight><pre><span></span><code><span class=nb>export</span> <span class=nv>JULIA_DEPOT_PATH</span><span class=o>=</span><span class=s2>&quot;/projects/verhaak-lab/amins/hpcenv/opt/julia/pkgs/1.6:/projects/verhaak-lab/amins/hpcenv/opt/modules/apps/julia/1.6.4/local/share/julia:/projects/verhaak-lab/amins/hpcenv/opt/modules/apps/julia/1.6.4/share/julia&quot;</span>
</code></pre></div> <ul> <li>Start <code>julia</code> and type <code>DEPOT_PATH</code> inside julia prompt.</li> </ul> <div class=highlight><pre><span></span><code><span class=mi>3</span><span class=o>-</span><span class=n>element</span> <span class=kt>Vector</span><span class=p>{</span><span class=kt>String</span><span class=p>}</span><span class=o>:</span>
 <span class=s>&quot;/projects/verhaak-lab/amins/hpcenv/opt/julia/pkgs/1.6&quot;</span>
 <span class=s>&quot;/projects/verhaak-lab/amins/hpcenv/opt/modules/apps/julia/1.6.4/local/share/julia&quot;</span>
 <span class=s>&quot;/projects/verhaak-lab/amins/hpcenv/opt/modules/apps/julia/1.6.4/share/julia&quot;</span>
</code></pre></div> <blockquote> <p>You should now see an updated DEPOT_PATH with our custom path taking the highest priority.</p> </blockquote> <h3 id=install-julia-kernel>Install julia kernel<a class=headerlink href=#install-julia-kernel title="Permanent link">&para;</a></h3> <p>Similar to python and r kernel, we will install julia kernel to interact with julia from JupyterLab console.</p> <div class="admonition warning"> <p class=admonition-title>Running Jupyter notebook from julia prompt</p> <p>IJulia kernel package in julia also allows you to run jupyter notebook or JupyterLab from julia prompt. It does so by installing a separate conda env inside julia package directory. Since we already have installed conda env outside julia package paths, I prefer <strong>not to install conda env via julia</strong>. So, if you ever come across <a href=https://julialang.github.io/IJulia.jl/dev/manual/running/ >Running IJulia guide</a>, please tread carefully installing two different conda env on your system! Unless you know what you are doing, avoid running commands like <code>notebook()</code> or <code>jupyterlab()</code> inside julia prompt.</p> </div> <div class="admonition tip"> <p class=admonition-title>Run <code>julia</code> command under <em>yoda</em> env</p> <p>Since we have installed julia as a standalone package and path to <code>julia</code> is fixed in PATH variable, we can run <code>julia</code> independent of which conda env we are in. However, I am using <em>yoda</em> env as my routine env where R and other tools are installed. So, as the best practice, I will <strong>run <code>julia</code> after activating <em>yoda</em> env</strong>, including running julia as a kernel.</p> </div> <div class=highlight><pre><span></span><code>mamba activate yoda

<span class=c1># enter julia prompt</span>
julia
</code></pre></div> <ul> <li>Install IJulia kernel</li> </ul> <div class=highlight><pre><span></span><code><span class=k>using</span> <span class=n>Pkg</span>
<span class=n>Pkg</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=s>&quot;IJulia&quot;</span><span class=p>)</span>
</code></pre></div> <blockquote> <p>Notice where julia is now installing new packages to!</p> </blockquote> <div class=highlight><pre><span></span><code>julia&gt; Pkg.add(&quot;IJulia&quot;)
  Installing known registries into `/projects/verhaak-lab/amins/hpcenv/opt/julia/pkgs/1.6`
  ...Resolving and installing dependency packages...

    Building Conda ─→ `/projects/verhaak-lab/amins/hpcenv/opt/julia/pkgs/1.6/scratchspaces/44cfe95a-1eb2-52ea-b672-e2afdf69b78f/6cdc8832ba11c7695f494c9d9a1c31e90959ce0f/build.log`
    Building IJulia → `/projects/verhaak-lab/amins/hpcenv/opt/julia/pkgs/1.6/scratchspaces/44cfe95a-1eb2-52ea-b672-e2afdf69b78f/d8b9c31196e1dd92181cd0f5760ca2d2ffb4ac0f/build.log`
Precompiling project...
  11 dependencies successfully precompiled in 8 seconds (4 already precompiled)
</code></pre></div> <ul> <li>Exit julia prompt by <code>CTRD D</code></li> </ul> <p>For consistency with naming kernels and ensuring that we load a valid <em>yoda</em> env prior to running kernel, let's adjust kernel settings.</p> <ul> <li>Create a new kernel wrapper, <em>/projects/verhaak-lab/amins/hpcenv/opt/kernels/wrap_yoda_jl16</em></li> </ul> <div class=highlight><pre><span></span><code>mkdir -p /projects/verhaak-lab/amins/hpcenv/opt/kernels/wrap_yoda_jl16
touch /projects/verhaak-lab/amins/hpcenv/opt/kernels/wrap_yoda_jl16

<span class=c1># make file executable</span>
chmod <span class=m>700</span> /projects/verhaak-lab/amins/hpcenv/opt/kernels/wrap_yoda_jl16
</code></pre></div> <blockquote> <p>Add following to <em>wrap_yoda_jl16</em></p> </blockquote> <div class=highlight><pre><span></span><code>#!/bin/bash

## Load env before loading jupyter kernel @sbamin https://github.com/jupyterhub/jupyterhub/issues/847#issuecomment-260152425

#### Activate CONDA in subshell ####
## Read https://github.com/conda/conda/issues/7980
# I am using conda instead of mamba to activate env
# as somehow I notices warnings/errors sourcing
# mamba.sh in sub-shells.
CONDA_BASE=$(conda info --base) &amp;&amp; \
source &quot;${CONDA_BASE}&quot;/etc/profile.d/conda.sh &amp;&amp; \
conda activate yoda &amp;&amp; \
echo &quot;Env is $(basename ${CONDA_PREFIX})&quot;
#### END CONDA SETUP ####

# this is the critical part, and should be at the end of your script:
exec /projects/verhaak-lab/amins/hpcenv/opt/modules/apps/julia/1.6.4/bin/julia -i --color=yes --project=@. /projects/verhaak-lab/amins/hpcenv/opt/julia/pkgs/1.6/packages/IJulia/e8kqU/src/kernel.jl &quot;$@&quot;

## Make sure to update corresponding kernel.json under ~/.local/share/jupyter/kernels/&lt;kernel_name&gt;/kernel.json

#_end_
</code></pre></div> <ul> <li>Now, adjust kernel settings.</li> </ul> <div class=highlight><pre><span></span><code><span class=c1>## go to kernel base dir</span>
<span class=nb>cd</span> ~/.local/share/jupyter/kernels/

<span class=c1>## rename julia kernel dir to yoda_jl16</span>
mv julia-1.6 yoda_jl16

<span class=c1>## edit kernel.json to rename display name to yoda_jl16</span>
<span class=nb>cd</span> yoda_jl16
nano kernel.json
</code></pre></div> <blockquote> <p>Replace contents of <em>kernel.json</em> with following:</p> </blockquote> <div class=highlight><pre><span></span><code><span class=p>{</span>
 <span class=nt>&quot;argv&quot;</span><span class=p>:</span> <span class=p>[</span>
  <span class=s2>&quot;/projects/verhaak-lab/amins/hpcenv/opt/kernels/wrap_yoda_jl16&quot;</span><span class=p>,</span>
  <span class=s2>&quot;{connection_file}&quot;</span>
 <span class=p>],</span>
 <span class=nt>&quot;display_name&quot;</span><span class=p>:</span> <span class=s2>&quot;yoda_jl16&quot;</span><span class=p>,</span>
 <span class=nt>&quot;language&quot;</span><span class=p>:</span> <span class=s2>&quot;julia&quot;</span><span class=p>,</span>
 <span class=nt>&quot;env&quot;</span><span class=p>:</span> <span class=p>{},</span>
 <span class=nt>&quot;interrupt_mode&quot;</span><span class=p>:</span> <span class=s2>&quot;signal&quot;</span>
<span class=p>}</span>
</code></pre></div> <blockquote> <p>Done! Next time you run jupyter, you should have a new julia kernel in JupyterLab.</p> </blockquote> <h2 id=database>Database<a class=headerlink href=#database title="Permanent link">&para;</a></h2> <p>This is an optional setup. If you are using database like postgresql, you may end up needing similar setup to install required postgresql drivers in conda env. Database driver(s) vary based on type of database, e.g., postgresql, mongodb, etc., and supported programming language.</p> <h3 id=postgresql-driver>postgresql driver<a class=headerlink href=#postgresql-driver title="Permanent link">&para;</a></h3> <ul> <li>Create a new env, <em>luke</em> to host database related drivers among other backend tools.</li> </ul> <div class=highlight><pre><span></span><code>mamba create -c conda-forge -n luke psqlodbc

<span class=c1># activate _luke_ env</span>
mamba activate luke
</code></pre></div> <ul> <li>Add database connection entries to <em>~/.odbc.ini</em> and make it <code>chmod 600 ~/.odbc.ini</code> as it contains login credentials in plain characters!</li> </ul> <blockquote> <p>We use postgresql database in our lab and it is hosted internally on a dedicated linux node. I can programmatically (via R, python, jupyterlab kernel) connect to this database by declaring following connection definition in <em>~/.odbc.ini</em> file. Notice path to database driver, <em>psqlodbcw.so</em> that we have just installed, and will be used to connect to a remote database.</p> </blockquote> <div class=highlight><pre><span></span><code>[db1]
Driver              = /projects/verhaak-lab/amins/hpcenv/mambaforge/envs/luke/lib/psqlodbcw.so
Database            = db1
Servername          = db1.example.com
UserName            = user1
Password            = password1
Port                = &lt;db1 port&gt;
sslmode             = require
[db2]
Driver              = /projects/verhaak-lab/amins/hpcenv/mambaforge/envs/luke/lib/psqlodbcw.so
Database            = db2
Servername          = db2.example.com
UserName            = user2
Password            = password2
Port                = &lt;db1 port&gt;
</code></pre></div> <ul> <li>If database connection requires SSL (preferable), then you will need to put required SSL configuration files into <em>~/.postgresql</em> or similar database-specific directory.</li> </ul> <h3 id=jupyterlab-sql-deprecated><del>jupyterlab-sql (deprecated)</del><a class=headerlink href=#jupyterlab-sql-deprecated title="Permanent link">&para;</a></h3> <p>I installed jupyterlab-sql in <em>base</em> env thinking it is supported for jupyterlab v3 or higher. However, jupyterlab-sql seems to be outdated and may not function in jupyterlab v3+.</p> <p><mark>You can ignore following setup for jupyterlab-sql</mark> (and jump to <a href=#postgresql-kernel>postgresql-kernel</a>) unless <a href=https://github.com/pbugnion/jupyterlab-sql>source wbesite</a> confirms that it is supported in an updated jupyrterlab env. Since I already installed jupyterlab-sql, I am going to remove it from <em>base</em> env.</p> <ul> <li>Remove deprecated package.</li> </ul> <div class=highlight><pre><span></span><code>pip uninstall jupyterlab-sql
</code></pre></div> <div class=highlight><pre><span></span><code>pip uninstall jupyterlab-sql
Found existing installation: jupyterlab-sql 0.3.3
Uninstalling jupyterlab-sql-0.3.3:
  Would remove:
    /projects/verhaak-lab/amins/hpcenv/mambaforge/lib/python3.9/site-packages/jupyterlab_sql-0.3.3.dist-info/*
    /projects/verhaak-lab/amins/hpcenv/mambaforge/lib/python3.9/site-packages/jupyterlab_sql/*
Proceed (Y/n)? Y
</code></pre></div> <ul> <li>Remove a related extension.</li> </ul> <div class=highlight><pre><span></span><code>jupyter serverextension disable jupyterlab_sql
jupyter labextension uninstall jupyterlab-sql
</code></pre></div> <ul> <li>Rebuild existing jupyter extensions.</li> </ul> <div class=highlight><pre><span></span><code>jupyter lab build

<span class=c1>## update all extensions</span>
jupyter labextension update --all

<span class=c1># check enabled extensions</span>
jupyter serverextension list
<span class=nb>echo</span> <span class=nv>$?</span>
</code></pre></div> <details class=bug><summary>Error loading server extension</summary><p>If you still notice a following warning (though <code>echo $?</code> should be 0 for an error-free configuration of jupyterlab extensions) related to jupyterlab_sql, it should not impact running jupyterlab. This seems like an open issue with jupyterlab extension configuration. <a class="magiclink magiclink-github magiclink-issue" href=https://github.com/jupyter/notebook/issues/2584 title="GitHub Issue: jupyter/notebook #2584">jupyter/notebook#2584</a></p> <div class=highlight><pre><span></span><code>Error loading server extension jupyterlab_sql
      X is jupyterlab_sql importable?
</code></pre></div> </details> <hr> <div class="admonition warning"> <p class=admonition-title>Before installing third-party packages, check project page for compatibility</p> <p>Turns out that <a href=https://github.com/pbugnion/jupyterlab-sql>jupyterlab-sql</a> is no longer actively being maintained and may not be compatible with an updated jupyterlab v2+. <a class="magiclink magiclink-github magiclink-issue" href=https://github.com/pbugnion/jupyterlab-sql/issues/147 title="GitHub Issue: pbugnion/jupyterlab-sql #147">pbugnion/jupyterlab-sql#147</a></p> <p>Before installing third-party packages, prefer packages that are being actively maintained by looking into <a href=https://github.com/pbugnion/jupyterlab-sql/commits/master>last commit date</a>, <a href=https://github.com/pbugnion/jupyterlab-sql/releases>release history, if any</a>, and <a href=https://github.com/pbugnion/jupyterlab-sql/issues>list of open issues</a>.</p> </div> <p>jupyterlab-sql is a <a href=https://en.wikipedia.org/wiki/Graphical_user_interface>GUI</a> extension in the <em>base</em> env because we run jupyter from <em>base</em>.</p> <ul> <li>From jupyterlab-sql page, <a href=https://github.com/pbugnion/jupyterlab-sql/blob/master/setup.py>check setup.py</a> requirements.</li> </ul> <div class=highlight><pre><span></span><code><span class=c1>## return to base env from _yoda_</span>
mamba deactivate
<span class=c1>## confirm that login prompt is showing (base) [userid@sumner]</span>
<span class=c1>## else run mamba deactivate or mamba activate base</span>

<span class=c1>## check if requirements are already installed or not</span>
mamba list <span class=p>|</span> grep -E <span class=s2>&quot;sqlalchemy|jsonschema&quot;</span>

<span class=c1>## install required dependencies</span>
mamba install -c conda-forge sqlalchemy jsonschema
</code></pre></div> <div class=highlight><pre><span></span><code>pip install jupyterlab-sql
</code></pre></div> <div class=highlight><pre><span></span><code>Successfully built jupyterlab-sql
Installing collected packages: jupyterlab-sql
Successfully installed jupyterlab-sql-0.3.3
</code></pre></div> <ul> <li>Build required jupyterlab extension for SQL</li> </ul> <div class=highlight><pre><span></span><code>jupyter serverextension <span class=nb>enable</span> jupyterlab_sql --py --sys-prefix

<span class=c1>## Rebuild all of jupyterlab extensions</span>
<span class=c1>## this may take a while (~5 minutes)</span>
jupyter lab build

<span class=c1>## update all extensions</span>
jupyter labextension update --all

<span class=c1># check enabled extensions</span>
jupyter serverextension list
</code></pre></div> <ul> <li><a href=https://github.com/pbugnion/jupyterlab-sql>Read on how-to use SQL GUI</a> </li> </ul> <h3 id=postgresql-kernel>postgresql kernel<a class=headerlink href=#postgresql-kernel title="Permanent link">&para;</a></h3> <p>Similar to other kernels, let's install postgresql kernel, so that jupyter notebooks can interact with postgres database. If using non-postgres system, <a href=https://docs.sqlalchemy.org/en/13/dialects/postgresql.html>follow driver installation based on sqlalchemy-based compatible drivers</a>.</p> <ul> <li>Install postgres driver.</li> </ul> <blockquote> <p>This is not available in conda-forge channel. So, installing using <code>pip install</code> after <a href=https://pypi.org/project/py-postgresql/ >ensuring that all of dependencies for the drivers</a> are satisfied in <em>base</em> env and if not, prefer installing dependencies first by <code>mamba install</code> and then do <code>pip install</code>.</p> </blockquote> <div class=highlight><pre><span></span><code>pip install py-postgresql
</code></pre></div> <div class=highlight><pre><span></span><code>Successfully built py-postgresql
Installing collected packages: py-postgresql
Successfully installed py-postgresql-1.2.2
</code></pre></div> <ul> <li>Install <a href=https://github.com/catherinedevlin/ipython-sql>ipython-sql</a> kernel and psycopg2 - a popular postgresql driver for python.</li> </ul> <div class=highlight><pre><span></span><code><span class=c1>## install core package, sqlalchemy and related dependencies, if any.</span>
mamba install -c conda-forge sqlalchemy jsonschema
mamba install -c conda-forge ipython-sql psycopg2
</code></pre></div> <blockquote> <p>Since I will be using <em>yoda</em> env for most times, I have also installed core sql drivers into <em>yoda</em> env without any conflicts with an existing setup.</p> </blockquote> <div class=highlight><pre><span></span><code>mamba activate yoda
mamba install -c conda-forge sqlalchemy ipython-sql psycopg2
mamba deactivate
</code></pre></div> <ul> <li>If applicable, restart jupyterlab server to enable SQL integration in jupyterlab env. Here is a good <a href=https://towardsdatascience.com/jupyter-magics-with-sql-921370099589>tutorial on using jupyter magic commands with SQL</a>.</li> </ul> <h2 id=python-2>Python 2<a class=headerlink href=#python-2 title="Permanent link">&para;</a></h2> <p>Python comes in two major flavors: Python 2 and Python 3. Since January 1, 2020, the official python developer community have <a href=https://www.python.org/doc/sunset-python-2/ >stopped supporting further development and bug fixes for Python 2</a>. So, it's ideal to use Pythonh 3 over Python 2 unless for a few (or more!) softwares in computational biology that depend on Python 2.</p> <p>Since conda env is bound to Python (and the major version), let's create a separate conda env, <em>windu</em> that will host Python 2.</p> <blockquote> <p>Optional: Along with python 2, I will also install a software, <a href=https://github.com/morrislab/phylowgs>PhyloWGS</a> which requires python 2 as a core dependency.</p> </blockquote> <div class=highlight><pre><span></span><code><span class=c1>## python 2.7 was the last major release.</span>
mamba create -n windu <span class=nv>python</span><span class=o>=</span><span class=m>2</span>.7 phylowgs
</code></pre></div> <ul> <li>Let's check briefly if it works ok!</li> </ul> <div class=highlight><pre><span></span><code>mamba activate windu
python --version

<span class=c1>## if you have also installed phylowgs</span>
<span class=c1># evolve.py --help</span>
</code></pre></div> <blockquote> <p>Python 2.7.15</p> </blockquote> <ul> <li>Deactivate and return to <em>base</em> env.</li> </ul> <div class=highlight><pre><span></span><code>mamba deactivate
</code></pre></div> <h2 id=ruby>Ruby<a class=headerlink href=#ruby title="Permanent link">&para;</a></h2> <p>Tools installed under dev or beta env, <em>anakin</em></p> <div class=highlight><pre><span></span><code>mamba create -c conda-forge -n anakin httpie
mamba activate anakin
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1># install ruby and github cli, https://github.com/cli/cl</span>
mamba install -c conda-forge ruby gh
<span class=c1># additional gist utility, https://github.com/defunkt/gist</span>
gem install gist
</code></pre></div> <blockquote> <p>Installing gem for the first time will prepend gem bin path, <code>/projects/verhaak-lab/amins/hpcenv/mambaforge/envs/anakin/share/rubygems/bin</code> to <code>$PATH</code> variable.</p> </blockquote> <div class="admonition warning"> <p class=admonition-title>Use <code>mamba deactivate</code> prior to switching to a new conda env</p> <p>When switching to an another conda env, always prefer using <code>mamba deactivate</code> first and then run <code>mamba activate &lt;other_env&gt;</code> instead of directly running <code>mamba activate &lt;other_env&gt;</code>. By doing deactivation first, conda will reset conda-related paths in <code>$PATH</code>, i.e., to remove paths from a deactivated env and fall back to the conda env (or default <em>base</em> env) that was active prior to a deactivated env. However, if you run <code>mamba activate &lt;other_env&gt;</code> without prior <code>mamba deactivate</code>, some of non-standard paths, i.e., paths other than <em>.../envs/<env_name>/bin/</em>, e.g., ruby gem path above, may remain in the <code>$PATH</code> and even takes the precedence over paths from a switched (and now active) conda env. Such Such invalid ordering of paths in <code>$PATH</code> variable may create issues when you either compile softwares by inadvertently using devtools from a wrong conda env or run softwares with a dynamically linked shared libraries from a wrong conda env.</p> </div> <h2 id=perl>Perl<a class=headerlink href=#perl title="Permanent link">&para;</a></h2> <p>I rarely use perl language except when it is part of a software, e.g., <a href=https://github.com/mskcc/vcf2maf>vcf2maf</a>. If you have configured linux env using setup detailed above, including in previous two parts, you should already have a working perl setup under both, <em>base</em> and <em>yoda</em> env with an identical version (<code>perl --version</code> 5.32.1).</p> <h3 id=setup-perl5lib>setup PERL5LIB<a class=headerlink href=#setup-perl5lib title="Permanent link">&para;</a></h3> <p>Optional: Similar to setting up version-specific custom R and julia package path, let's do the same for perl too using a bash env variable, <code>PERL5LIB</code>.</p> <div class="admonition warning"> <p class=admonition-title>Prefer setting up PERL5LIB at the runtime</p> <p>Please know that it is a better to set PERL5LIB at the run time, i.e., using <code>module load &lt;some program&gt;</code> (see <a href=#modules>Modules</a>) of a specific package over hardcoding it in the bash startup (as I am doing below!). Hardcoding PERL5LIB with the same perl packages but built using two different perl versions may fail to run your program. <a href=https://www.ibm.com/support/pages/perl5lib-or-perllib-can-cause-scripts-fail>Read this post at IBM website</a></p> </div> <p>Since we have an identical perl version in <em>base</em> and <em>yoda</em> env, we will only create a common path for both env. If you have a different perl version across conda env, you need to source custom bash startup to update <code>PERL5LIB</code> at the time you activate or deactivate conda env. See notes under <a href=#tips-on-compiling-packages>Tips on compiling packages</a>. Also, read more on <code>PERL5LIB</code> path at <a href=https://stackoverflow.com/questions/5167484/setting-perl5lib>stackoverflow</a> and <a href=https://chestofbooks.com/computers/webservers/apache/Stas-Bekman/Practical-mod_perl/3-9-2-2-Using-the-PERL5LIB-environment-variable.html>following guide on setting up custom PERL5LIB path</a>.</p> <div class="admonition warning"> <p class=admonition-title>Setting up PERL5LIB path</p> <p>HPC job schedulers, like slurm and moab may use their respective perl libraries. Typically, installing a different version of perl in your (user) conda env should not conflict with running slurm or moab commands as the latter is built using system-installed perl (at <code>/usr/bin/</code>). If it does, you may need to debug specific errors and resolve issue(s) mostly related to PERL5LIB path.</p> </div> <ul> <li>First, check default perl library paths by checking tail portion of <code>perl -V</code> output under <code>@INC:</code>, e.g., for <em>yoda</em> env, it shows following paths:</li> </ul> <div class=highlight><pre><span></span><code>@INC:
    /projects/verhaak-lab/amins/hpcenv/mambaforge/envs/yoda/lib/perl5/site_perl
    /projects/verhaak-lab/amins/hpcenv/mambaforge/envs/yoda/lib/perl5/5.32/vendor_perl
    /projects/verhaak-lab/amins/hpcenv/mambaforge/envs/yoda/lib/perl5/vendor_perl
    /projects/verhaak-lab/amins/hpcenv/mambaforge/envs/yoda/lib/perl5/5.32/core_perl
    /projects/verhaak-lab/amins/hpcenv/mambaforge/envs/yoda/lib/perl5/core_perl
</code></pre></div> <ul> <li>Create an empty path to store user-installed perl packages. We will only need perl standard library path and one for <em>site_perl</em>. Paths for vendor and core library are designed for system-only perl packages.</li> </ul> <div class=highlight><pre><span></span><code>mkdir -p /projects/verhaak-lab/amins/hpcenv/opt/perl/pkgs/perl5/5.32
mkdir -p /projects/verhaak-lab/amins/hpcenv/opt/perl/pkgs/perl5/site_perl/5.32
</code></pre></div> <blockquote> <p><img alt=⚠ class=twemoji src=https://twemoji.maxcdn.com/v/latest/svg/26a0.svg title=:warning:> Update PERL5LIB to respective major.minor perl version in case you update perl program.</p> </blockquote> <ul> <li>For now, add following to <em>~/.bashrc</em> above <code># &gt;&gt;&gt; conda initialize &gt;&gt;&gt;</code> line. Again, we will move most of custom bash startup settings to a dedicated <em>~/.profile.d/</em> path.</li> </ul> <div class=highlight><pre><span></span><code>export PERL5LIB=&quot;/projects/verhaak-lab/amins/hpcenv/opt/perl/pkgs/perl5/5.32:/projects/verhaak-lab/amins/hpcenv/opt/perl/pkgs/perl5/site_perl/5.32:/projects/verhaak-lab/amins/hpcenv/opt/perl/pkgs/perl5/site_perl&quot;
</code></pre></div> <blockquote> <p>Unlike setting up other library paths, e.g., LD_LIBRARY_PATH, LIBPATH, etc. where we need to append existing system paths (else bash env may fail to find those libraries), in PERL5LIB, we only need to specify user-level library paths and perl will pick up system path based at the run-time.</p> </blockquote> <ul> <li>Logout and login again to HPC and activate <em>yoda</em> env.</li> <li><code>perl -V</code> should now show a new <code>%ENV</code> variable and perl library paths should now show updated paths with precedence for user-level paths over system paths.</li> </ul> <div class=highlight><pre><span></span><code>%ENV:
    PERL5LIB=&quot;/projects/verhaak-lab/amins/hpcenv/opt/perl/pkgs/perl5/5.32:/projects/verhaak-lab/amins/hpcenv/opt/perl/pkgs/perl5/site_perl/5.32:/projects/verhaak-lab/amins/hpcenv/opt/perl/pkgs/perl5/site_perl&quot;
@INC:
    /projects/verhaak-lab/amins/hpcenv/opt/perl/pkgs/perl5/5.32
    /projects/verhaak-lab/amins/hpcenv/opt/perl/pkgs/perl5/site_perl/5.32
    /projects/verhaak-lab/amins/hpcenv/opt/perl/pkgs/perl5/site_perl
    /projects/verhaak-lab/amins/hpcenv/mambaforge/lib/perl5/5.32/site_perl
    /projects/verhaak-lab/amins/hpcenv/mambaforge/lib/perl5/site_perl
    /projects/verhaak-lab/amins/hpcenv/mambaforge/lib/perl5/5.32/vendor_perl
    /projects/verhaak-lab/amins/hpcenv/mambaforge/lib/perl5/vendor_perl
    /projects/verhaak-lab/amins/hpcenv/mambaforge/lib/perl5/5.32/core_perl
    /projects/verhaak-lab/amins/hpcenv/mambaforge/lib/perl5/core_perl
</code></pre></div> <h2 id=snakemake>Snakemake<a class=headerlink href=#snakemake title="Permanent link">&para;</a></h2> <p>I use <a href=https://snakemake.readthedocs.io>snakemake</a> for running computational workflows. Snakemake is a well maintained python package with <a href=https://snakemake.readthedocs.io/en/stable/project_info/history.html>frequent releases</a> for new features and bugfixes. Hence, I prefer to install it in a dedicated conda env, <em>leia</em>. This will allow me to update snakemake periodically without worrying about conflicting dependencies for other packages installed in <em>yoda</em> or other envs. Also, I can execute complex workflows using snakemake and can activate other conda envs, like <em>yoda</em> (CPU-otpimized) or <em>rey</em> (GPU-optimized) using one or more of <a href=https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html>snakemake-based rules</a>. To install snakemake, please read <a href=https://snakemake.readthedocs.io/en/stable/getting_started/installation.html>installation guide</a></p> <div class=highlight><pre><span></span><code><span class=c1># for clarity (and sanity): Better to name this env as snakemake unless</span>
<span class=c1># being loyal to Star Wars saga!</span>
mamba create -c conda-forge -c bioconda -n leia snakemake
</code></pre></div> <ul> <li>To update snakemake to its latest release:</li> </ul> <div class=highlight><pre><span></span><code>mamba activate snakemake
mamba update -c conda-forge -c bioconda snakemake
</code></pre></div> <h2 id=additional-setup>Additional Setup<a class=headerlink href=#additional-setup title="Permanent link">&para;</a></h2> <p>Following setup is optional.</p> <ul> <li>Additional packages in <em>yoda</em> env.</li> </ul> <div class=highlight><pre><span></span><code><span class=c1>## in yoda env</span>
<span class=c1># depmap was not available in conda-forge</span>
<span class=c1># biconda version had no conflict with existing setup</span>
mamba install -c bioconda bioconductor-depmap
mamba install -c conda-forge r-odbc r-dbi
mamba install -c conda-forge r-ggthemes r-cowplot r-ggstatsplot r-hrbrthemes
</code></pre></div> <h3 id=jupytext>JupyText<a class=headerlink href=#jupytext title="Permanent link">&para;</a></h3> <p>Optional: <a href="mamba install -c conda-forge">Jupytext</a> allows running jupyter notebooks as text or markdown files similar to running scripts for R, Python, and Julia. </p> <ul> <li>Install jupytext in <em>base</em> env. Note compatibility for related jupyterlab extension at <a class="magiclink magiclink-github magiclink-repository" href=https://github.com/mwouts/jupytext title="GitHub Repository: mwouts/jupytext">mwouts/jupytext</a> Current version of jupytext (1.13.3) is only compatible with JupyterLab 3+ (I have v3.2.4 and so all good!)</li> </ul> <div class=highlight><pre><span></span><code>mamba install -c conda-forge jupytext
</code></pre></div> <ul> <li>After installing or updating a new jupyterlab extension, good to update and list all extensions.</li> </ul> <div class=highlight><pre><span></span><code><span class=c1>## list enabled extension</span>
jupyter serverextension list

<span class=c1>## update all extensions</span>
jupyter labextension update --all

jupyter serverextension list
</code></pre></div> <p>I have also installed <a href=https://jupyter-contrib-nbextensions.readthedocs.io/en/latest/index.html>jupyter_contrib_nbextensions</a> extension earlier in <a href=../sumner_2/#start-jupyterlab>Part 2</a> which allows additional configuration for jupyter notebook. This is a <strong>beta extension and an optional</strong> setup.</p> <hr> <h2 id=modules>Modules<a class=headerlink href=#modules title="Permanent link">&para;</a></h2> <p>Similar to managing conda env using <code>mamba activate</code> or <code>mamba deactivate</code>, we can also load/unload a specific package via <code>module load</code> or <code>module unload</code> commands. Modules allows us to manage compiled packages or softwares which otherwise are either not available via conda-forge or bioconda channel or installing those with conda is creating dependencies conflict with core conda packages like R and python. Besides overcoming conflicting dependencies, Modules is a better way to organize the same software with multiple versions in case we need to occasionally use an older version for some legacy (and complex) workflow while prefer using an updated version otherwise.</p> <p>Here, I need to assume you have a working knowledge of using Modules. If not, no worries and here are a few tutorials on using modules in HPC env. Also, talk to your Research IT staff as module configuration may vary across HPC envs.</p> <div class="admonition info"> <p class=admonition-title>Resources on Modules</p> <ul> <li><a href=https://hpc.nih.gov/apps/modules.html>HPC at NIH</a></li> <li><a href=https://www.sherlock.stanford.edu/docs/software/modules/ >Sherlock at Stanford</a></li> <li><a href=https://modules.readthedocs.io/ >Official documentation</a> also provides an excellent overview of working with Modules. </li> </ul> </div> <ul> <li>Your HPC staff may already have installed a few modules. To view those, run <code>module list</code>.</li> <li>Besides these default modules, you may also want to load packages that you have compiled by yourself. While buding packages, you may find <a href=#tips-on-compiling-packages>tips on compiling packages</a> useful.</li> <li>Once packages are built, create an empty directory to package-specific directory and respective <em>Modulefiles</em> - one file each for a version, e.g.,</li> </ul> <div class=highlight><pre><span></span><code>mkdir -p /projects/verhaak-lab/amins/hpcenv/modules
<span class=nb>cd</span> /projects/verhaak-lab/amins/hpcenv/modules

<span class=c1>## subdir that will host compiled packages in version specific manner</span>
mkdir apps

<span class=c1>## subdir that will host Modulefiles</span>
mkdir def
</code></pre></div> <ul> <li>Now, if I have compiled multiple versions of a package, e.g., samtools v1.11, v1, 14, etc. or a pre-built packages, e.g., GATK v4.1.9.0 and GATK 4.2, I can do that as follows:</li> </ul> <div class=highlight><pre><span></span><code><span class=nb>cd</span> /projects/verhaak-lab/amins/hpcenv/modules

<span class=c1>## bash syntax, {1.11,1.14} will create multiple directories</span>
<span class=c1>## for each entry separated by comma</span>
mdkir -p apps/samtools/<span class=o>{</span><span class=m>1</span>.11,1,14<span class=o>}</span>
mkdir -p def/samtools/<span class=o>{</span><span class=m>1</span>.11,1.14<span class=o>}</span>
</code></pre></div> <ul> <li>In <em>/def/</em> directory, you will need to put <em>Modulefile</em> as detailed in <a href=https://modules.readthedocs.io/ >official documentation</a>. For advanced configuration, <a href=https://lmod.readthedocs.io/en/latest/ >refer to following documentation if your HPC is using Lua module system</a>. Following are example Modulefile for samtools v1.14</li> </ul> <details class=example><summary>Example Modulefile</summary><div class="tabbed-set tabbed-alternate" data-tabs=1:2><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>Tcl format</label><label for=__tabbed_1_2>Lua format</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=c>#%Module1.0</span>
<span class=c>## Example format in Tcl langugae</span>
<span class=c>## samtools</span>
<span class=c>## Author: Samir Amin</span>

<span class=c>## Read about Modulefile manpage</span>
<span class=c>## https://modules.readthedocs.io/en/latest/modulefile.html</span>

<span class=c>## Substitute version number and app name below</span>
<span class=c># for Tcl script use only</span>
<span class=k>set</span><span class=w> </span>VERSION<span class=w> </span><span class=mf>1.11</span>
<span class=k>set</span><span class=w> </span>MODULEDIR<span class=w> </span><span class=o>/</span>projects<span class=o>/</span>verhaak-lab<span class=o>/</span>amins<span class=o>/</span>hpcenv<span class=o>/</span>modules<span class=o>/</span>apps
<span class=k>set</span><span class=w> </span>NAME<span class=w> </span>samtools
<span class=c>## create a new modulefile for a different version, e.g., 1.14</span>
<span class=k>set</span><span class=w> </span>INSTALL_DIR<span class=w> </span><span class=err>$</span><span class=k>{</span><span class=nv>MODULEDIR</span><span class=k>}</span><span class=o>/</span><span class=err>$</span><span class=k>{</span><span class=nv>NAME</span><span class=k>}</span><span class=o>/</span><span class=err>$</span><span class=k>{</span><span class=nv>VERSION</span><span class=k>}</span>

<span class=k>proc</span><span class=w> </span>ModulesHelp<span class=w> </span><span class=k>{</span><span class=w> </span><span class=k>}</span><span class=w> </span><span class=k>{</span><span class=w></span>
<span class=w>        </span><span class=k>global</span><span class=w> </span>version
<span class=w>        </span><span class=nb>puts</span><span class=w> </span>stderr<span class=w> </span><span class=s2>&quot;\nLoads ${NAME}\n&quot;</span>
<span class=k>}</span>

<span class=nv>module-whatis</span><span class=w>   </span><span class=s2>&quot;${NAME}&quot;</span>

<span class=c>## check available commands in documentation</span>
<span class=nb>append</span><span class=o>-</span>path<span class=w> </span>PATH<span class=w> </span><span class=err>$</span><span class=k>{</span><span class=nv>INSTALL_DIR</span><span class=k>}</span><span class=o>/</span>bin

<span class=k>if</span><span class=w> </span><span class=k>{</span><span class=w> </span><span class=k>[</span><span class=w> </span><span class=nv>module-info</span><span class=w> </span>mode<span class=w> </span>load<span class=w> </span><span class=k>]</span><span class=w> </span><span class=k>}</span><span class=w> </span><span class=k>{</span><span class=w></span>
<span class=w>    </span><span class=nb>puts</span><span class=w> </span>stderr<span class=w> </span><span class=s2>&quot;\nLoaded ${NAME} ${VERSION} from ${INSTALL_DIR}\n&quot;</span>
<span class=k>}</span>

<span class=k>if</span><span class=w> </span><span class=k>{</span><span class=w> </span><span class=k>[</span><span class=w> </span><span class=nv>module-info</span><span class=w> </span>mode<span class=w> </span>remove<span class=w> </span><span class=k>]</span><span class=w> </span><span class=k>}</span><span class=w> </span><span class=k>{</span><span class=w></span>
<span class=w>    </span><span class=nb>puts</span><span class=w> </span>stderr<span class=w> </span><span class=s2>&quot;\nUnloaded ${NAME} ${VERSION}\n&quot;</span>
<span class=k>}</span>

<span class=c>## END ##</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code><span class=cm>--[[</span>
<span class=cm>## Example format in Lua langugae</span>
<span class=cm>## samtools</span>
<span class=cm>## Author: Samir Amin</span>

<span class=cm>## Read about Lmod</span>
<span class=cm>## https://lmod.readthedocs.io/en/latest/015_writing_modules.html</span>
<span class=cm>## https://lmod.readthedocs.io/en/latest/050_lua_modulefiles.html</span>
<span class=cm>## https://lmod.readthedocs.io/en/latest/020_advanced.html</span>
<span class=cm>--]]</span>

<span class=c1>--################################ INTERNAL VARS #################################</span>
<span class=c1>--Module Name and Version are parsed by Lmod from dir/version string in module path</span>
<span class=c1>--Make sure to have exact version numbering when naming respective</span>
<span class=c1>-- app directroy and Modulefile</span>
<span class=kd>local</span> <span class=n>pkgName</span> <span class=o>=</span> <span class=n>myModuleName</span><span class=p>()</span>
<span class=kd>local</span> <span class=n>version</span> <span class=o>=</span> <span class=n>myModuleVersion</span><span class=p>()</span>
<span class=kd>local</span> <span class=n>pkgNameVer</span> <span class=o>=</span> <span class=n>myModuleFullName</span><span class=p>()</span>

<span class=kd>local</span> <span class=n>approot</span> <span class=o>=</span> <span class=s2>&quot;/projects/verhaak-lab/amins/hpcenv/modules/apps&quot;</span>
<span class=kd>local</span> <span class=n>appbase</span> <span class=o>=</span> <span class=s2>&quot;samtools&quot;</span>
<span class=kd>local</span> <span class=n>pkgdir</span> <span class=o>=</span> <span class=n>pathJoin</span><span class=p>(</span><span class=n>approot</span><span class=p>,</span><span class=n>appbase</span><span class=p>,</span><span class=n>version</span><span class=p>)</span>
<span class=kd>local</span> <span class=n>pkgbin</span> <span class=o>=</span> <span class=n>pathJoin</span><span class=p>(</span><span class=n>pkgdir</span><span class=p>,</span><span class=s2>&quot;bin&quot;</span><span class=p>)</span>

<span class=c1>--################################# MODULE INFO ##################################</span>
<span class=n>whatis</span><span class=p>(</span><span class=s2>&quot;Name: &quot;</span><span class=o>..</span> <span class=n>pkgName</span><span class=p>)</span>
<span class=n>whatis</span><span class=p>(</span><span class=s2>&quot;Version: &quot;</span> <span class=o>..</span> <span class=n>version</span><span class=p>)</span>

<span class=c1>--################################## ENV SETUP ###################################</span>
<span class=c1>--## check available commands in documentation</span>
<span class=n>prepend_path</span><span class=p>(</span><span class=s2>&quot;PATH&quot;</span><span class=p>,</span> <span class=n>pkgbin</span><span class=p>)</span>

<span class=c1>--################################# MODULE LOAD ##################################</span>
<span class=n>help</span><span class=p>(</span>
<span class=s2>&quot;Loads &quot;</span> <span class=o>..</span> <span class=n>pkgNameVer</span> <span class=o>..</span> <span class=s1>&#39;</span><span class=se>\n</span><span class=s1>Check env change, if any by</span><span class=se>\n</span><span class=s1>module show &#39;</span> <span class=o>..</span> <span class=n>pkgNameVer</span>
<span class=p>)</span>

<span class=kr>if</span> <span class=p>(</span><span class=n>mode</span><span class=p>()</span> <span class=o>==</span> <span class=s2>&quot;load&quot;</span><span class=p>)</span> <span class=kr>then</span>
  <span class=n>LmodMessage</span><span class=p>(</span><span class=s2>&quot;## INFO ##</span><span class=se>\n</span><span class=s2>Loading &quot;</span> <span class=o>..</span> <span class=n>pkgName</span> <span class=o>..</span> <span class=n>version</span> <span class=o>..</span> <span class=s2>&quot;from &quot;</span> <span class=o>..</span> <span class=n>pkgdir</span><span class=p>)</span>
<span class=kr>end</span>

<span class=kr>if</span> <span class=p>(</span><span class=n>mode</span><span class=p>()</span> <span class=o>==</span> <span class=s2>&quot;unload&quot;</span><span class=p>)</span> <span class=kr>then</span>
  <span class=n>LmodMessage</span><span class=p>(</span><span class=s2>&quot;## INFO ##</span><span class=se>\n</span><span class=s2>Unloading &quot;</span> <span class=o>..</span> <span class=n>pkgName</span> <span class=o>..</span> <span class=n>version</span> <span class=o>..</span> <span class=s2>&quot;from &quot;</span> <span class=o>..</span> <span class=n>pkgdir</span><span class=p>)</span>
<span class=kr>end</span>

<span class=c1>--## END ##</span>
</code></pre></div> </div> </div> </div> </details> <h2 id=containers>Containers<a class=headerlink href=#containers title="Permanent link">&para;</a></h2> <p>Containers are a greay way to enclose project-specifig set of packages and workflow(s) to promote portablity and reproducibility of the same workflow across different HPC environments. Here is a brief intro on two of most popular container systems: <a href=https://www.docker.com/resources/what-container>Docker</a> and <a href=https://sylabs.io/guides/latest/user-guide/introduction.html>Singularity</a>. <a href=https://hpc.nih.gov/apps/singularity.html>HPC at NIH</a> provides a few examples on building singularity based containers, including packages that require GPU-based configuration, e.g., Keras/Tensorflow and Theano. Your HPC may already have a container system like <a href=https://sylabs.io/guides/latest/user-guide/ >Singularity</a>. If so, you can take full advantage of container system.</p> <ul> <li>Optional: In my bash startup, I have tweaked singularity <a href=https://sylabs.io/guides/latest/user-guide/build_env.html>env variables</a> to store cache data on tier 1 space over default <em>~/.singularity/</em> path.</li> </ul> <div class=highlight><pre><span></span><code><span class=c1>### singularity ###</span>
<span class=c1>## add manpath for singularity to an existing manpath</span>
<span class=nv>MANPATH</span><span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>SUM7ENV</span><span class=si>}</span><span class=s2>/local/share/man:/cm/local/apps/singularity/current/share/man</span><span class=si>${</span><span class=nv>MANPATH</span><span class=p>:+:</span><span class=nv>$MANPATH</span><span class=si>}</span><span class=s2>&quot;</span>
<span class=c1>## set cache dir to non-home path</span>
<span class=nv>SINGULARITY_CACHEDIR</span><span class=o>=</span><span class=s2>&quot;/projects/verhaak-lab/amins/containers/cache/singularity&quot;</span>
<span class=c1>## path were built SIF images are manually stored</span>
<span class=nv>SINGULARITY_SIF</span><span class=o>=</span><span class=s2>&quot;/projects/verhaak-lab/amins/containers/sifbin&quot;</span>
</code></pre></div> <details class=tip><summary>bash special syntax: <code>${VAR:+:$VAR}</code> </summary><p>I have expanded bash env variable like, MANPATH using syntax: <code>${MANPATH:+:$MANPATH}</code>. It is a special bash syntax which will expand to existing MANPATH <strong>only if</strong> MANPATH contained any value else output of MANPATH will be an empty string without space or <code>:</code>, thereby perseving MANPATH structure.</p> </details> <h2 id=tips-on-compiling-packages>Tips on compiling packages<a class=headerlink href=#tips-on-compiling-packages title="Permanent link">&para;</a></h2> <ul> <li>Store compiled packages under a base directory like <em>/projects/verhaak-lab/amins/hpcenv/opt/ or */projects/verhaak-lab/amins/hpcenv/opt/apps/</em>.</li> <li>For each of compiled packages, keep a directory structure that maintains package version, e.g., <em>.../apps/samtools/v10.2</em>, <em>.../apps/samtools/v11.3</em>, etc.</li> <li>When possible, install or compile packages using a clean terminal session, i.e., ssh to HPC, start screen, and then interactive session to do rest of installation steps.</li> <li>Avoid installing packages via <code>pip install</code> as unlike <code>mamba install or update</code> command, <code>pip install</code> does not strictly check for package dependencies of conda-installed packaegs. So, at least try installing most of package dependencies using <code>mamba install</code> first before running <code>pip install</code>.</li> <li>Avoid installing packages via Jupyter notebook as unlike terminal session, debugging for a failed installation is difficult with notebook and env session may vary per initialization sequence of jupyter kernel, i.e., whether or not appropriate conda env was loaded prior to starting kernel.</li> <li>While installing packages, prefer using <code>mamba install/update</code> first. If this forces you to downgrade core packages like R and python or several core shared libraries, e.g., libz, openssl, etc., you may fall back to compiling via language-specific functions, e.g., <code>install.packages()</code> in R, <code>pip install</code> for python, etc.</li> <li>While compiling packages, ensure that precedence of paths in PATH, <a href=https://stackoverflow.com/questions/4250624/ld-library-path-vs-library-path>LD_LIBRARY_PATH, LIBRARY_PATH</a>, and related devtools paths are aligned to conda env AND for the respective programming env profile, e.g., if you are compiling a package with intention to use it from <em>yoda</em> env (say a R package), your terminal bash session should have precedence for <em>/projects/verhaak-lab/amins/hpcenv/mambaforge/envs/yoda/</em> path in PATH and if applicable, in LD_LIBRARY_PATH and LIBRARY_PATH too. The identical precedence of paths should also be present in <em>~/.Renviron</em> file.</li> <li>Know that <em>~/.Renviron</em> will be read by any of R session running from <em>yoda</em> or other conda env (say you have R 4.1 in <em>yoda</em> but R 5.1 in <em>anakin</em>). Of course, Renviron varies for R 4.1 and R 5.1, and hence, you should have a dedicated Renviron file](<a href=https://stat.ethz.ch/R-manual/R-devel/library/base/html/Startup.html>https://stat.ethz.ch/R-manual/R-devel/library/base/html/Startup.html</a>) for each of conda env. You can do that by either [creating a <em>Renviron.site</em> file in the respective env under <em>/projects/verhaak-lab/amins/hpcenv/mambaforge/envs/yoda/lib/R/etc</em> path or loading/unloading a custom Renviron file each time you activate/deactivate conda env using configuration files similar to <em>~/profile.d/s01_startup.sh</em> file, e.g., <code>activate.d/load_R4.1env.sh</code> and <code>deactivate/unload_R4.1env.sh</code> under <em>/projects/verhaak-lab/amins/hpcenv/mambaforge/envs/yoda/etc/conda/</em>.</li> <li>For julia, <a href=https://docs.julialang.org/en/v1/manual/environment-variables/ >similar startup env files</a> should be <em>~/.julia/config/startup.jl</em> and <em><code>$JULIA_BINDIR</code>/<code>$SYSCONFDIR</code>/julia/startup.jl</em>.</li> </ul> <hr> <h2 id=bash-startup>bash startup<a class=headerlink href=#bash-startup title="Permanent link">&para;</a></h2> <p>As I wrap up setup for our CPU-based Sumner HPC, I will finally configure <strong>bash startup</strong> - a sequence of files containing bash code that should be loaded to setup a consistent bash login environment on HPC login (interactive) and compute nodes (non-interactive). Here the consistent environment equals to order of paths in <code>PATH</code> and <code>LD_LIBRARY_PATH</code> variables especially when switching conda env and loading of custom configurations for R, Julia, and other packages, etc. that I configured earlier.</p> <p>First, understand what an interactive and a non-interactive bash session is. For most times, we deal with interactive session when we ssh to HPC. You are in the interactive session if env variable, <code>PS1</code> (called <a href=https://www.gnu.org/software/bash/manual/html_node/Controlling-the-Prompt.html>bash custom prompt</a>) is set and <code>echo $PS1</code> is showing some output. For more on bash startup, <a href=https://www.gnu.org/software/bash/manual/bash.html#Bash-Startup-Files>please read official documentation</a>, including <a href=https://www.gnu.org/software/bash/manual/bash.html#Interactive-Shells>notes on interactive shell</a>, especially <strong>behavior of an interactive shell</strong>.</p> <p>Over years of fiddling with bash startup, my startup setup has become overly complex than needed and may not suit well for your need. At minimum, I prefer to have following in bash startup sequence:</p> <ol> <li>Keep minimal configuration (bash code) in the user <em>~/.bash_profile</em> and rather keep all of custom configuration commands under <em>~/.profile.d/</em> directory.</li> <li>Under user <em>~/.profile.d/</em>, organize a few bash script based on order you like your bash startup to setup, e.g., <em>~/.profile.d/A01.sh</em> should load commonly used bash env variables related, e.g., <code>EDITOR</code> to define default text editor, <code>TZ</code> to set default timezone, etc. Then, <em>~/.profile.d/A02.sh</em> should have additional configurations for other packages, e.g., R, Julia, etc. which otherwise we populated in <em>~/.bash_profile</em> above.</li> <li>Keep minimal configuration in the user <em>~/.bashrc</em> file as this may not be loaded with non-interactive, non-login session, e.g., submitting a job to compute nodes without passing bash env of a terminal session or certain commands in R and python using system command to execute bash command(s). Ideally, you like to keep <em>aesthetic</em> configurations in <em>~/.bashrc</em> file like setting up terminal fonts and colors, managing bash history, etc. You may also optionally create <em>~/.bash_aliases</em> to store bash short codes that you may use while doing command-line interactive work.</li> <li>Contrary to a default setup of conda instructions in <em>~/.bashrc</em>, <strong>avoid such major env configuration</strong> in <em>~/.bashrc</em> as it may not be loaded in non-interactive sessions, i.e., <code>mamba activate</code> or <code>mamba deactivate</code> may not work within a running shell script or snakemake workflows before running mamba init code. Conda setup may change in future (an active issue <a class="magiclink magiclink-github magiclink-issue" href=https://github.com/conda/conda/issues/8072 title="GitHub Issue: conda/conda #8072">conda/conda#8072</a>) but until then, I will move conda initialization code from <em>~/.bashrc</em> to <em>~/.bash_profile</em>, specifically after loading <em>~/.bashrc</em> but before loading <em>~/.profile.d/void</em> block (see below).</li> <li>bash startup sequence also includes system default configurations, e.g., setting up default modules to run a workload manager like slurm and a singularity container. These instructions are typically located under <em>/etc/profile</em> file and <em>/etc/profile.d/</em> directory, both of these will be sourced in the very beginning. These configurations are essential for working on HPC, including submitting jobs to compute nodes. However, sometimes default modules may alter PATH and LD_LIBRARY_PATH variables such that it may conflict with your custom env setup. If so, you can <strong>reconfigure</strong> respective variables using bash command(s) in <em>~/.profile.d/void/VA01.sh</em> and similar shell files. These files under <em>void/</em> will be loaded after bash has initialized system default configurations, i.e., sourced <em>/etc/profile</em> file and shell files under <em>/etc/profile.d/</em> directory, and therefore, any of bash commands within <em>~/.profile.d/void/VA01.sh</em> file will override the respective configuration set earlier.</li> <li>I emphasized <strong>reconfigure</strong> and <strong>not resetting</strong> earlier because you should be very careful of resetting PATH and LD_LIBRARY_PATH. You may get locked out of HPC login node and may need a help of sysadmin to let you in again!</li> </ol> <blockquote> <p>PS: I do reset PATH at the very end of <em>~/.bash_profile</em> once bash startup sequence has traversed across all of files detailed above and shown in flow diagram below. By doing so, I can get a consistent bash login environment. However, this is an overkill and you can sure get a stable bash env without such reset.</p> </blockquote> <div class="admonition warning"> <p class=admonition-title>Order of precedence matters</p> <p>Be aware of how bash startup sequence will load these files. Check a flow diagram under <em>My bash startup sequence</em> below.</p> <p>For example, if I set <code>PATH</code> variable as <code>export PATH=/a/b/c:/p/q/r</code> in <em>~/.profile.d/A01.sh</em> and then I add <code>export PATH=/p/q/r:/a/b/c</code> in <em>~/.profile.d/A02.sh</em>, bash startup sequqence will overwrite previous PATH with an updated PATH from A02.sh file.</p> </div> <details class=abstract><summary>My bash startup sequence: flow diagram</summary><p>Following diagram represents sequence of files (containing bash code) that gets sourced each time I login to HPC.</p> <p>If plot is not visible below, you can view plot by pasting following code to <a href=https://mermaid-js.github.io/mermaid-live-editor/ >mermaid live editor</a>.</p> <div class=highlight><pre><span></span><code>graph TB
  A[System &lt;br&gt;/etc/profile] --&gt; B[User&lt;br&gt;.bash_profile]
  B --&gt; C{User .profile.d/ directory};
  C --&gt;|Yes| D[source .profile.d/A01.sh];
  D -.-&gt; E[source .profile.d/A02.sh];
  E -.-&gt; F[source .profile.d/Z99.sh];
  F --&gt; G;
  C --&gt; |No| G{User .bashrc};
  G --&gt; |Interactive shell&lt;br&gt;PS1 var is set| H[source /etc/bashrc]
  H --&gt; I[User .bash_aliases]
  I --&gt; J[bash terminal config, &lt;br&gt; e.g., colors, history, etc.]
  J --&gt; K[Initialize&lt;br&gt;Conda Environment]
  G --&gt; |Non-interactive shell&lt;br&gt;PS1 var is unset| K
  L[User .profile.d/void] --&gt; M[source &lt;br&gt; .profile.d/void/VA01.sh];
  M -.-&gt; N[source &lt;br&gt; .profile.d/void/VZ99.sh];
  K --&gt; L;
  N --&gt; O[Set PATH]
  O --&gt; P[Set PS1]
</code></pre></div> <p><a href=https://mermaid-js.github.io/mermaid-live-editor/edit#eyJjb2RlIjoiICAgIGdyYXBoIFRCXG4gICAgICBBW1N5c3RlbSA8YnI-L2V0Yy9wcm9maWxlXSAtLT4gQltVc2VyPGJyPi5iYXNoX3Byb2ZpbGVdXG4gICAgICBCIC0tPiBDe1VzZXIgLnByb2ZpbGUuZC8gZGlyZWN0b3J5fTtcbiAgICAgIEMgLS0-fFllc3wgRFtzb3VyY2UgLnByb2ZpbGUuZC9BMDEuc2hdO1xuICAgICAgRCAtLi0-IEVbc291cmNlIC5wcm9maWxlLmQvQTAyLnNoXTtcbiAgICAgIEUgLS4tPiBGW3NvdXJjZSAucHJvZmlsZS5kL1o5OS5zaF07XG4gICAgICBGIC0tPiBHO1xuICAgICAgQyAtLT4gfE5vfCBHe1VzZXIgLmJhc2hyY307XG4gICAgICBHIC0tPiB8SW50ZXJhY3RpdmUgc2hlbGw8YnI-UFMxIHZhciBpcyBzZXR8IEhbc291cmNlIC9ldGMvYmFzaHJjXVxuICAgICAgSCAtLT4gSVtVc2VyIC5iYXNoX2FsaWFzZXNdXG4gICAgICBJIC0tPiBKW2Jhc2ggdGVybWluYWwgY29uZmlnLCA8YnI-IGUuZy4sIGNvbG9ycywgaGlzdG9yeSwgZXRjLl1cbiAgICAgIEogLS0-IEtbSW5pdGlhbGl6ZTxicj5Db25kYSBFbnZpcm9ubWVudF1cbiAgICAgIEcgLS0-IHxOb24taW50ZXJhY3RpdmUgc2hlbGw8YnI-UFMxIHZhciBpcyB1bnNldHwgS1xuICAgICAgTFtVc2VyIC5wcm9maWxlLmQvdm9pZF0gLS0-IE1bc291cmNlIDxicj4gLnByb2ZpbGUuZC92b2lkL1ZBMDEuc2hdO1xuICAgICAgTSAtLi0-IE5bc291cmNlIDxicj4gLnByb2ZpbGUuZC92b2lkL1ZaOTkuc2hdO1xuICAgICAgSyAtLT4gTDtcbiAgICAgIE4gLS0-IE9bU2V0IFBBVEhdXG4gICAgICBPIC0tPiBQW1NldCBQUzFdIiwibWVybWFpZCI6IntcbiAgXCJ0aGVtZVwiOiBcImRlZmF1bHRcIlxufSIsInVwZGF0ZUVkaXRvciI6ZmFsc2UsImF1dG9TeW5jIjp0cnVlLCJ1cGRhdGVEaWFncmFtIjpmYWxzZX0><img alt src=https://mermaid.ink/img/eyJjb2RlIjoiICAgIGdyYXBoIFRCXG4gICAgICBBW1N5c3RlbSA8YnI-L2V0Yy9wcm9maWxlXSAtLT4gQltVc2VyPGJyPi5iYXNoX3Byb2ZpbGVdXG4gICAgICBCIC0tPiBDe1VzZXIgLnByb2ZpbGUuZC8gZGlyZWN0b3J5fTtcbiAgICAgIEMgLS0-fFllc3wgRFtzb3VyY2UgLnByb2ZpbGUuZC9BMDEuc2hdO1xuICAgICAgRCAtLi0-IEVbc291cmNlIC5wcm9maWxlLmQvQTAyLnNoXTtcbiAgICAgIEUgLS4tPiBGW3NvdXJjZSAucHJvZmlsZS5kL1o5OS5zaF07XG4gICAgICBGIC0tPiBHO1xuICAgICAgQyAtLT4gfE5vfCBHe1VzZXIgLmJhc2hyY307XG4gICAgICBHIC0tPiB8SW50ZXJhY3RpdmUgc2hlbGw8YnI-UFMxIHZhciBpcyBzZXR8IEhbc291cmNlIC9ldGMvYmFzaHJjXVxuICAgICAgSCAtLT4gSVtVc2VyIC5iYXNoX2FsaWFzZXNdXG4gICAgICBJIC0tPiBKW2Jhc2ggdGVybWluYWwgY29uZmlnLCA8YnI-IGUuZy4sIGNvbG9ycywgaGlzdG9yeSwgZXRjLl1cbiAgICAgIEogLS0-IEtbSW5pdGlhbGl6ZTxicj5Db25kYSBFbnZpcm9ubWVudF1cbiAgICAgIEcgLS0-IHxOb24taW50ZXJhY3RpdmUgc2hlbGw8YnI-UFMxIHZhciBpcyB1bnNldHwgS1xuICAgICAgTFtVc2VyIC5wcm9maWxlLmQvdm9pZF0gLS0-IE1bc291cmNlIDxicj4gLnByb2ZpbGUuZC92b2lkL1ZBMDEuc2hdO1xuICAgICAgTSAtLi0-IE5bc291cmNlIDxicj4gLnByb2ZpbGUuZC92b2lkL1ZaOTkuc2hdO1xuICAgICAgSyAtLT4gTDtcbiAgICAgIE4gLS0-IE9bU2V0IFBBVEhdXG4gICAgICBPIC0tPiBQW1NldCBQUzFdIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifSwidXBkYXRlRWRpdG9yIjpmYWxzZSwiYXV0b1N5bmMiOnRydWUsInVwZGF0ZURpYWdyYW0iOmZhbHNlfQ></a></p> </details> <div class="admonition info"> <p class=admonition-title>Example bash startup files</p> <p>Fix link - You can <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path fill-rule=evenodd d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0v-2.5zm7.5-.188V4.25c0 .138.112.25.25.25h2.688a.252.252 0 0 0-.011-.013l-2.914-2.914a.272.272 0 0 0-.013-.011zM5.72 6.72a.75.75 0 0 0 0 1.06l1.47 1.47-1.47 1.47a.75.75 0 1 0 1.06 1.06l2-2a.75.75 0 0 0 0-1.06l-2-2a.75.75 0 0 0-1.06 0zM3.28 7.78a.75.75 0 0 0-1.06-1.06l-2 2a.75.75 0 0 0 0 1.06l2 2a.75.75 0 0 0 1.06-1.06L1.81 9.25l1.47-1.47z"/></svg></span> <a href=https://github.com/sbamin/code101/tree/main/confs/hpc/user_env/ >download my bash startup files</a>. It will not work by cloning into your linux env. However, each file has inline comments that should help customizing your bash startup.</p> </div> <p>And that's all! <img alt=🏁 class=twemoji src=https://twemoji.maxcdn.com/v/latest/svg/1f3c1.svg title=:checkered_flag:></p> <p>My setup for our CPU-based Sumner HPC or for that matter, a generic linux-based machine is now complete. Since our HPC env at JAX shares the common home directory and base linux image (CentOS 7) between CPU (Sumner) and GPU (Winter) based HPC, the above setup will work off-the-shelf on the Winter HPC too <strong>except</strong> for tasks which require GPU-based computing, e.g., using GPU-based tensorflow and pytorch libraries. For the latter, I will setup a dedicated GPU-based conda env, <em>rey</em> (and <em>ben</em> and <em>gorgu</em>!) and tweak bash startup such that I get GPU-based bash env only when I login to Winter and to Sumner HPC.</p> <p>For GPU-based setup, go to <a href=../../gpu/winter_1/ >Part 4</a>.</p> <div class=footnote> <hr> <ol> <li id=fn:julia1> <p>Related discussions on <a href=https://discourse.julialang.org/t/ijulia-kernel-not-starting-unless-ijulia-is-installed-in-the-global-environment-ie-v1-1/21172>julia forums</a> and <a href=https://julialang.github.io/IJulia.jl/dev/manual/troubleshooting/ >troubleshooting guide</a>.&#160;<a class=footnote-backref href=#fnref:julia1 title="Jump back to footnote 1 in the text">&#8617;</a></p> </li> </ol> </div> <!-- Source file information --> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">December 29, 2021</span> </small> </div> <!-- end default contents --> <!-- Get setting from mkdocs.yml, but allow page-level overrides --> <!-- Inject Disqus into current page --> <p><small>Author: <a href=https://sbamin.com/about rel=me>Samir B. Amin</a> <span class=twemoji> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </span><a href=https://twitter.com/sbamin>@sbamin</a></small></p> <!--   <script src="https://code.sbamin.com/1.0../../../assets/javascripts/bundle.93302429.min.js"></script>
  <script src="https://code.sbamin.com/1.0../../../assets/javascripts/bundle.71c96ae2.min.js"></script> --> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top data-md-state=hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg> Back to top </a> </main> <!-- Footer --> <footer class=md-footer> <!-- Link to previous and/or next page --> <nav class="md-footer__inner md-grid" aria-label=Footer> <!-- Link to previous page --> <a href=../sumner_2/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Part 2" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Part 2 </div> </div> </a> <!-- Link to next page --> <a href=../../gpu/winter_1/ class="md-footer__link md-footer__link--next" aria-label="Next: Part 1" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Part 1 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <!-- Further information --> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <!-- Copyright and theme information --> <div class=md-copyright> <div class=md-copyright__highlight> © <a rel=license href=https://sbamin.com/disclosure/ title="CC BY-NC-SA 4.0 License, link to site disclosure">2003-2021</a>: <a href=https://sbamin.com title=Home>SBAmin.com</a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <!-- Social links --> <div class=md-social> <a href=https://sbamin.com/about target=_blank rel=noopener title=sbamin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path fill-rule=evenodd d="M10.5 5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0zm.061 3.073a4 4 0 1 0-5.123 0 6.004 6.004 0 0 0-3.431 5.142.75.75 0 0 0 1.498.07 4.5 4.5 0 0 1 8.99 0 .75.75 0 1 0 1.498-.07 6.005 6.005 0 0 0-3.432-5.142z"/></svg> </a> <a href=https://twitter.com/sbamin target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://linkedin.com/in/samiramin/ target=_blank rel=noopener title=linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=https://github.com/sbamin target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://sbamin.com/contact target=_blank rel=noopener title=sbamin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs", "navigation.instant", "navigation.top", "navigation.indexes", "navigation.sections"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.b6ff8c07.min.js", "version": {"provider": "mike", "default": "latest"}}</script> <script src=../../../assets/javascripts/bundle.5e13d264.min.js></script> <script src=../../../assets/js/extra.js></script> <script src=../../../assets/js/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.2.1/tablesort.min.js></script> <script src=../../../assets/js/tables.js></script> </body> </html>