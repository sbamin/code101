<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Setup CellProfiler, CellPose, StarDist on HPC Winter - GPU HPC at JAX"><meta name=author content="Samir B. Amin"><link href=https://code.sbamin.com/hpc/gpu/image_analysis_cellprofiler_cellpose/ rel=canonical><link rel=icon href=../../../assets/images/fixed/favicon.ico><meta name=generator content="mkdocs-1.3.0, mkdocs-material-8.3.5"><title>Image analysis on GPU-based HPC - Programming 101</title><link rel=stylesheet href=../../../assets/stylesheets/main.4a0965b7.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Fira Code"}</style><link rel=stylesheet href=../../../assets/css/extra.css><script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><!-- Determine analytics provider (deprecated, removed in v8) --><!-- Determine analytics provider --><!-- Set up analytics provider --><!-- Determine analytics property (deprecated, removed in v8) --><!-- Determine analytics property --><!-- Google Analytics 4 (G-XXXXXXXXXX) --><script>
    window.ga = window.ga || function() {
      (ga.q = ga.q || []).push(arguments)
    }
    ga.l = +new Date()

    /* Set up integration and send page view */
    ga("create", "UA-307297-1", "auto")
    ga("set", "anonymizeIp", true)
    ga("send", "pageview")

    /* Register virtual event handlers */
    document.addEventListener("DOMContentLoaded", function() {
      if (document.forms.search) {
        var query = document.forms.search.query
        query.addEventListener("blur", function() {
          if (this.value) {
            var path = document.location.pathname;
            ga("send", "pageview", path + "?q=" + this.value)
          }
        })
      }

      /* Send page view on location change */
      if (typeof location$ !== "undefined")
        location$.subscribe(function(url) {
          ga("send", "pageview", url.pathname)
        })
    })
  </script><script async src=https://www.google-analytics.com/analytics.js></script><!--   <link rel="stylesheet" href="https://code.sbamin.com/../../../assets/stylesheets/main.c296cc61.min.css"> --><meta name=keywords content=hpc,linux,configuration,winter,gpu,cuda,imaging,cellprofiler,workflow,pipeline,cellpose,stardist><meta property=og:type content=website><meta property=og:title content="Image analysis on GPU-based HPC · Programming 101"><meta property=og:description content="Setup CellProfiler, CellPose, StarDist on HPC Winter - GPU HPC at JAX"><meta content=https://code.sbamin.com/hpc/gpu/image_analysis_cellprofiler_cellpose/ property=og:url><meta property=og:image content=https://code.sbamin.com/assets/images/fixed/sitelogo.png><meta property=og:image:type content=image/png><meta property=og:image:width content=256><meta property=og:image:height content=256><meta name=twitter:card content=summary><meta name=twitter:site content=@sbamin><meta name=twitter:creator content=@sbamin><meta name=twitter:title content="Image analysis on GPU-based HPC · Programming 101"><meta name=twitter:description content="Setup CellProfiler, CellPose, StarDist on HPC Winter - GPU HPC at JAX"><meta name=twitter:image content=https://code.sbamin.com/assets/images/fixed/sitelogo.png><meta name=twitter:image:alt content="webpage banner or site logo"></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#image-analysis-on-gpu-based-hpc class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="Programming 101" class="md-header__button md-logo" aria-label="Programming 101" data-md-component=logo> <img src=../../../assets/images/fixed/sitelogo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Programming 101 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Image analysis on GPU-based HPC </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=teal data-md-color-accent=light-green aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/sbamin/code101 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M100.59 334.24c48.57 3.31 58.95 2.11 58.95 11.94 0 20-65.55 20.06-65.55 1.52.01-5.09 3.29-9.4 6.6-13.46zm27.95-116.64c-32.29 0-33.75 44.47-.75 44.47 32.51 0 31.71-44.47.75-44.47zM448 80v352a48 48 0 0 1-48 48H48a48 48 0 0 1-48-48V80a48 48 0 0 1 48-48h352a48 48 0 0 1 48 48zm-227 69.31c0 14.49 8.38 22.88 22.86 22.88 14.74 0 23.13-8.39 23.13-22.88S258.62 127 243.88 127c-14.48 0-22.88 7.84-22.88 22.31zM199.18 195h-49.55c-25-6.55-81.56-4.85-81.56 46.75 0 18.8 9.4 32 21.85 38.11C74.23 294.23 66.8 301 66.8 310.6c0 6.87 2.79 13.22 11.18 16.76-8.9 8.4-14 14.48-14 25.92C64 373.35 81.53 385 127.52 385c44.22 0 69.87-16.51 69.87-45.73 0-36.67-28.23-35.32-94.77-39.38l8.38-13.43c17 4.74 74.19 6.23 74.19-42.43 0-11.69-4.83-19.82-9.4-25.67l23.38-1.78zm84.34 109.84-13-1.78c-3.82-.51-4.07-1-4.07-5.09V192.52h-52.6l-2.79 20.57c15.75 5.55 17 4.86 17 10.17V298c0 5.62-.31 4.58-17 6.87v20.06h72.42zM384 315l-6.87-22.37c-40.93 15.37-37.85-12.41-37.85-16.73v-60.72h37.85v-25.41h-35.82c-2.87 0-2 2.52-2-38.63h-24.18c-2.79 27.7-11.68 38.88-34 41.42v22.62c20.47 0 19.82-.85 19.82 2.54v66.57c0 28.72 11.43 40.91 41.67 40.91 14.45 0 30.45-4.83 41.38-10.2z"/></svg> </div> <div class=md-source__repository> sbamin/code101 </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../ class="md-tabs__link md-tabs__link--active"> Getting started with HPC </a> </li> <li class=md-tabs__item> <a href=../../../tags/ class=md-tabs__link> Tags </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Programming 101" class="md-nav__button md-logo" aria-label="Programming 101" data-md-component=logo> <img src=../../../assets/images/fixed/sitelogo.png alt=logo> </a> Programming 101 </label> <div class=md-nav__source> <a href=https://github.com/sbamin/code101 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M100.59 334.24c48.57 3.31 58.95 2.11 58.95 11.94 0 20-65.55 20.06-65.55 1.52.01-5.09 3.29-9.4 6.6-13.46zm27.95-116.64c-32.29 0-33.75 44.47-.75 44.47 32.51 0 31.71-44.47.75-44.47zM448 80v352a48 48 0 0 1-48 48H48a48 48 0 0 1-48-48V80a48 48 0 0 1 48-48h352a48 48 0 0 1 48 48zm-227 69.31c0 14.49 8.38 22.88 22.86 22.88 14.74 0 23.13-8.39 23.13-22.88S258.62 127 243.88 127c-14.48 0-22.88 7.84-22.88 22.31zM199.18 195h-49.55c-25-6.55-81.56-4.85-81.56 46.75 0 18.8 9.4 32 21.85 38.11C74.23 294.23 66.8 301 66.8 310.6c0 6.87 2.79 13.22 11.18 16.76-8.9 8.4-14 14.48-14 25.92C64 373.35 81.53 385 127.52 385c44.22 0 69.87-16.51 69.87-45.73 0-36.67-28.23-35.32-94.77-39.38l8.38-13.43c17 4.74 74.19 6.23 74.19-42.43 0-11.69-4.83-19.82-9.4-25.67l23.38-1.78zm84.34 109.84-13-1.78c-3.82-.51-4.07-1-4.07-5.09V192.52h-52.6l-2.79 20.57c15.75 5.55 17 4.86 17 10.17V298c0 5.62-.31 4.58-17 6.87v20.06h72.42zM384 315l-6.87-22.37c-40.93 15.37-37.85-12.41-37.85-16.73v-60.72h37.85v-25.41h-35.82c-2.87 0-2 2.52-2-38.63h-24.18c-2.79 27.7-11.68 38.88-34 41.42v22.62c20.47 0 19.82-.85 19.82 2.54v66.57c0 28.72 11.43 40.91 41.67 40.91 14.45 0 30.45-4.83 41.38-10.2z"/></svg> </div> <div class=md-source__repository> sbamin/code101 </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <div class="md-nav__link md-nav__link--index "> <a href=../../ >Getting started with HPC</a> <label for=__nav_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Getting started with HPC" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting started with HPC </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2 type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2> CPU Computing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="CPU Computing" data-md-level=2> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> CPU Computing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../cpu/sumner_1/ class=md-nav__link> Part 1 </a> </li> <li class=md-nav__item> <a href=../../cpu/sumner_2/ class=md-nav__link> Part 2 </a> </li> <li class=md-nav__item> <a href=../../cpu/sumner_3/ class=md-nav__link> Part 3 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 type=checkbox id=__nav_2_3 checked> <label class=md-nav__link for=__nav_2_3> GPU Computing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="GPU Computing" data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> GPU Computing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../winter_1/ class=md-nav__link> GPU setup </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Image analysis on GPU-based HPC <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Image analysis on GPU-based HPC </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#initial-setup class=md-nav__link> Initial Setup </a> <nav class=md-nav aria-label="Initial Setup"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cellprofiler class=md-nav__link> CellProfiler </a> </li> <li class=md-nav__item> <a href=#cellpose class=md-nav__link> CellPose </a> </li> <li class=md-nav__item> <a href=#stardist class=md-nav__link> StarDist </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#resolve-version-conflicts class=md-nav__link> Resolve version conflicts </a> </li> <li class=md-nav__item> <a href=#jupyter-support class=md-nav__link> Jupyter Support </a> <nav class=md-nav aria-label="Jupyter Support"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kernel-setup class=md-nav__link> Kernel setup </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#backup-conda-env class=md-nav__link> Backup Conda Env </a> </li> <li class=md-nav__item> <a href=#gpu-configuration class=md-nav__link> GPU configuration </a> <nav class=md-nav aria-label="GPU configuration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#test-gpu class=md-nav__link> Test GPU </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cellprofiler-plugins class=md-nav__link> CellProfiler Plugins </a> </li> <li class=md-nav__item> <a href=#questions class=md-nav__link> Questions </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../tags/ class=md-nav__link> Tags </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#initial-setup class=md-nav__link> Initial Setup </a> <nav class=md-nav aria-label="Initial Setup"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cellprofiler class=md-nav__link> CellProfiler </a> </li> <li class=md-nav__item> <a href=#cellpose class=md-nav__link> CellPose </a> </li> <li class=md-nav__item> <a href=#stardist class=md-nav__link> StarDist </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#resolve-version-conflicts class=md-nav__link> Resolve version conflicts </a> </li> <li class=md-nav__item> <a href=#jupyter-support class=md-nav__link> Jupyter Support </a> <nav class=md-nav aria-label="Jupyter Support"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kernel-setup class=md-nav__link> Kernel setup </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#backup-conda-env class=md-nav__link> Backup Conda Env </a> </li> <li class=md-nav__item> <a href=#gpu-configuration class=md-nav__link> GPU configuration </a> <nav class=md-nav aria-label="GPU configuration"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#test-gpu class=md-nav__link> Test GPU </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#cellprofiler-plugins class=md-nav__link> CellProfiler Plugins </a> </li> <li class=md-nav__item> <a href=#questions class=md-nav__link> Questions </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/sbamin/code101/edit/scratch/web/docs/hpc/gpu/image_analysis_cellprofiler_cellpose.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <nav class=md-tags> <a href=../../../tags/#gpu class=md-tag> gpu </a> <a href=../../../tags/#hpc class=md-tag> hpc </a> <a href=../../../tags/#imaging class=md-tag> imaging </a> <a href=../../../tags/#segmentation class=md-tag> segmentation </a> <a href=../../../tags/#cellprofiler class=md-tag> cellprofiler </a> <a href=../../../tags/#cellpose class=md-tag> cellpose </a> <a href=../../../tags/#stardist class=md-tag> stardist </a> </nav> <h1 id=image-analysis-on-gpu-based-hpc>Image analysis on GPU-based HPC<a class=headerlink href=#image-analysis-on-gpu-based-hpc title="Permanent link">&para;</a></h1> <blockquote> <p>Setup CellProfiler, CellPose, StarDist on GPU-based HPC.</p> </blockquote> <p>CPU version of CellProfiler (CP) is <a href=https://code.sbamin.com//hpc/gpu/winter_1/#cellprofiler>installed under env <em>grogu</em></a>. However, we like to run CP based workflow in a headless HPC environment such that it can leverage <a href=https://github.com/CellProfiler/CellProfiler-plugins>CP plugins</a>, including use of GPU-enabled CellPose and StartDist plugins. This requires manually configuring several dependencies for CP vs. those for CellPose and StarDist, such that all three programs can live in harmony within a single conda env.</p> <h2 id=initial-setup>Initial Setup<a class=headerlink href=#initial-setup title="Permanent link">&para;</a></h2> <p>Create a new conda env, <em>cellprofiler</em> because we will be using <code>pip install</code> several times and this may require changing package versions which otherwise existing and stable conda-managed env - with other packages and their dependencies - may not allow us to edit/update.</p> <p>Following setup is based on GPU-enabled HPC at <a href=https://www.jax.org/about-us/our-campuses-and-communities/connecticut>The Jackson Laboratory for Genomic Medicine</a> but it should be applicable for most other NVIDIA-based GPUs running Cent OS 7.</p> <h3 id=cellprofiler>CellProfiler<a class=headerlink href=#cellprofiler title="Permanent link">&para;</a></h3> <ul> <li>Login to Winter HPC which is our GPU based HPC.</li> </ul> <div class=highlight><pre><span></span><code>ssh winter
mamba activate base
</code></pre></div> <details class=tip><summary>Do <code>echo $?</code> after each major installation step</summary><p>For error-free setup, check exit code for a successfully run command (should be 0) after each of major installation commands below. This can be done either using <code>echo $?</code> <strong>immediately after</strong> the major command or suffixing <code>&amp;&amp; echo "Success"</code> to a major command text string.</p> </details> <ul> <li>Create a new env and install CP from the official source. Know that purpose of installing CP via conda is to install CP dependencies and not CP itself. For CP, we will later use <code>pip install</code> to install it from the source and so override conda managed CP.</li> </ul> <div class=highlight><pre><span></span><code>mamba create -c conda-forge -c bioconda -n cellprofiler cellprofiler
</code></pre></div> <h3 id=cellpose>CellPose<a class=headerlink href=#cellpose title="Permanent link">&para;</a></h3> <ul> <li>Install CellPose dependencies, including CUDA drivers for GPU functionality.</li> </ul> <div class=highlight><pre><span></span><code>mamba activate cellprofiler
mamba install -c conda-forge -c pytorch pytorch <span class=nv>cudatoolkit</span><span class=o>=</span><span class=m>11</span>.3
</code></pre></div> <ul> <li>Install or upgrade cellpose along with all of its dependencies.</li> </ul> <details class=warning><summary><code>pip install</code> of dependencies is generally not a best practice</summary><p>When working in a conda env, it is not a good idea to install packages using <code>pip install</code>, especially dependencies. You may rather install all of dependencies for a package using <code>mamba install</code> command to avoid version conflict with conda managed packages. You can usually find required dependencies of a package, say CellPose in <em>setup.py</em> and/or <code>requirements.txt</code> file under <a href=https://github.com/MouseLand/cellpose>CellPose source code</a>.</p> <p>Here, I already know that CP and CellPose have conflicting dependencies and I am attempting to fix those manually using <code>pip install</code> with trade off of potentially breaking conda managed package dependencies. Let's see what happens at the end of this setup!</p> </details> <div class=highlight><pre><span></span><code>pip install cellpose<span class=o>[</span>all<span class=o>]</span> --upgrade <span class=p>|&amp;</span> tee -a ~/logs/cellpose2_envcp_install.log
</code></pre></div> <blockquote> <p>Expected end of the installation log:</p> </blockquote> <div class=highlight><pre><span></span><code>...
Installing collected packages: slicerator, PyQt5-Qt5, pyasn1, tqdm, rsa, pyqtgraph, pyqt5.sip, pyasn1-modules, protobuf, opencv-python-headless, natsort, llvmlite, google-crc32c, fastremap, cachetools, pyqt5, pims, numba, googleapis-common-protos, google-resumable-media, google-auth, google-api-core, cellpose, google-cloud-core, dask-image, google-cloud-storage
Successfully installed PyQt5-Qt5-5.15.2 cachetools-5.2.0 cellpose-2.1.0 dask-image-2021.12.0 fastremap-1.13.2 google-api-core-2.8.2 google-auth-2.9.1 google-cloud-core-2.3.2 google-cloud-storage-2.4.0 google-crc32c-1.3.0 google-resumable-media-2.3.3 googleapis-common-protos-1.56.4 llvmlite-0.39.0 natsort-8.1.0 numba-0.56.0 opencv-python-headless-4.6.0.66 pims-0.6.1 protobuf-4.21.4 pyasn1-0.4.8 pyasn1-modules-0.2.8 pyqt5-5.15.7 pyqt5.sip-12.11.0 pyqtgraph-0.12.4 rsa-4.9 slicerator-1.1.0 tqdm-4.64.0
</code></pre></div> <h3 id=stardist>StarDist<a class=headerlink href=#stardist title="Permanent link">&para;</a></h3> <ul> <li>Similarly install <a href=https://github.com/stardist/stardist>StarDist</a> tensorflow 2 version. For this, we need to first install TensorFlow 2 GPU package, CUDA drivers, and related packages using <code>mamba install</code>.</li> </ul> <div class="admonition warning"> <p class=admonition-title>Downgrading major version for CUDA toolkit and cudnn</p> <p>Note that following command may downgrade above installed (during CellPose dependencies install) cudatoolkit from 11 to 10 and cudnn from 8 to 7. While this is not a best practice, we need to ensure that dependencies for all three - CellProfiler, CellPose, and StarDist - live in harmony under the same conda env, <em>cellprofiler</em>!</p> </div> <div class=highlight><pre><span></span><code>mamba activate cellprofiler
mamba install -c conda-forge -c pytorch tensorflow-gpu keras pytorch torchvision cudatoolkit scikit-learn numpy scipy natsort tifffile tqdm numba torch-optimizer
</code></pre></div> <ul> <li>Verify if tensorflow is using GPU. Note that tensorflow may require a valid path to CUDA toolkit in LD_LIBRARY_PATH. Since conda env does not put its lib path in LD_LIBRARY_PATH, we may need to set that explicitly as follows (and later as modulefile - See towards the end)</li> </ul> <div class=highlight><pre><span></span><code><span class=nb>export</span> <span class=nv>LD_LIBRARY_PATH</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$LD_LIBRARY_PATH</span><span class=s2>:</span><span class=si>${</span><span class=nv>CONDA_PREFIX</span><span class=si>}</span><span class=s2>/lib/&quot;</span>
<span class=c1># Verify install:</span>
python3 -c <span class=s2>&quot;import tensorflow as tf; print(tf.config.list_physical_devices(&#39;GPU&#39;))&quot;</span>
</code></pre></div> <ul> <li>Test pytorch cuda support: <strong>This is critical for running Cellpose in GPU mode.</strong></li> </ul> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>torch</span>
<span class=c1>## RELU only has one CUDA device: 0</span>
<span class=n>device</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>device</span><span class=p>(</span><span class=s1>&#39;cuda:0&#39;</span><span class=p>)</span>
<span class=n>torch</span><span class=o>.</span><span class=n>zeros</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>])</span><span class=o>.</span><span class=n>to</span><span class=p>(</span><span class=n>device</span><span class=p>)</span>
</code></pre></div> <blockquote> <p>This may fail and cellpose may fallback to CPU. If so, reinstall pytorch from cuda-specific conda repository.</p> </blockquote> <ul> <li>Cellpose may not use GPU unless pytorch package is compiled using compatible cuda toolkit. See <a href=https://github.com/MouseLand/cellpose/issues/203>details here</a>. To fix, reinstall pytorch ensuring it comes from a channel starting with respective cuda major version, e.g., <code>cuda102...</code> in this case.</li> </ul> <blockquote> <p>For Winter HPC: GPU suport worked with previous steps, and so, I did not reinstall pytorch as pytorch was already built using <code>cuda102...</code> toolkit. See pytorch line in <em>Check versions</em> step below.</p> </blockquote> <div class=highlight><pre><span></span><code>mamba update -c conda-forge -c pytorch pytorch
</code></pre></div> <ul> <li>Check versions for GPU related libraries.</li> </ul> <div class=highlight><pre><span></span><code><span class=o>(</span>cellprofiler<span class=o>)</span> foo@winter204:/fastscratch/foo$ mamba list <span class=p>|</span> grep -E <span class=s2>&quot;tensor|cuda|torch&quot;</span>
cudatoolkit               <span class=m>10</span>.2.89             h713d32c_10    conda-forge
pytorch                   <span class=m>1</span>.12.0          cuda102py38hfdb21e3_202    conda-forge
pytorch-ranger            <span class=m>0</span>.1.1              pyhd8ed1ab_0    conda-forge
tensorboard               <span class=m>2</span>.8.0              pyhd8ed1ab_1    conda-forge
tensorboard-data-server   <span class=m>0</span>.6.0            py38h2b5fc30_2    conda-forge
tensorboard-plugin-wit    <span class=m>1</span>.8.1              pyhd8ed1ab_0    conda-forge
tensorflow                <span class=m>2</span>.8.1           cuda102py38h32e99bf_0    conda-forge
tensorflow-base           <span class=m>2</span>.8.1           cuda102py38ha005362_0    conda-forge
tensorflow-estimator      <span class=m>2</span>.8.1           cuda102py38h4357c17_0    conda-forge
tensorflow-gpu            <span class=m>2</span>.8.1           cuda102py38hf05f184_0    conda-forge
torch-optimizer           <span class=m>0</span>.3.0              pyhd8ed1ab_0    conda-forge
torchvision               <span class=m>0</span>.13.0          cuda102py38h041733a_0    conda-forge
</code></pre></div> <ul> <li>Now install or upgrade StarDist.</li> </ul> <div class=highlight><pre><span></span><code>pip install stardist --upgrade <span class=p>|&amp;</span> tee -a ~/logs/stardist_envcp_install.log
</code></pre></div> <details class=warning><summary>StarDist: Version conflict with <code>pip install</code></summary><p>Notice errors below while installing stardist using <code>pip install</code>. While exit code (<code>echo $?</code>) returned zero or success status, CellProfiler command may fail given some of dependencies are mismatched between StarDist and CellProfiler. We need to resolve this later in the setup process.</p> <blockquote> <p>Expected end of the installation log:</p> </blockquote> <div class=highlight><pre><span></span><code>...
Installing collected packages: numpy, h5py, csbdeep, stardist
  Attempting uninstall: numpy
    Found existing installation: numpy 1.23.1
    Uninstalling numpy-1.23.1:
      Successfully uninstalled numpy-1.23.1
  Attempting uninstall: h5py
    Found existing installation: h5py 3.7.0
    Uninstalling h5py-3.7.0:
      Successfully uninstalled h5py-3.7.0

ERROR: pip&#39;s dependency resolver does not currently take into account all the packages that are installed. This behavior is the source of the following dependency conflicts.
python-bioformats 4.0.5 requires python-javabridge==4.0.3, but you have python-javabridge 4.0.0 which is incompatible.
centrosome 1.2.0 requires matplotlib==3.1.3, but you have matplotlib 3.5.2 which is incompatible.
cellprofiler 4.2.1 requires docutils==0.15.2, but you have docutils 0.19 which is incompatible.
cellprofiler 4.2.1 requires h5py==3.2.1, but you have h5py 2.10.0 which is incompatible.
cellprofiler 4.2.1 requires matplotlib==3.1.3, but you have matplotlib 3.5.2 which is incompatible.
cellprofiler 4.2.1 requires mysqlclient==1.4.6, but you have mysqlclient 2.0.3 which is incompatible.
cellprofiler 4.2.1 requires python-javabridge==4.0.3, but you have python-javabridge 4.0.0 which is incompatible.
cellprofiler 4.2.1 requires pyzmq==18.0.1, but you have pyzmq 18.1.1 which is incompatible.
cellprofiler 4.2.1 requires sentry-sdk==0.18.0, but you have sentry-sdk 1.9.0 which is incompatible.
cellprofiler 4.2.1 requires wxPython==4.1.0, but you have wxpython 4.1.1 which is incompatible.
cellprofiler-core 4.2.1 requires docutils==0.15.2, but you have docutils 0.19 which is incompatible.
cellprofiler-core 4.2.1 requires h5py==3.2.1, but you have h5py 2.10.0 which is incompatible.
cellprofiler-core 4.2.1 requires python-javabridge==4.0.3, but you have python-javabridge 4.0.0 which is incompatible.
cellprofiler-core 4.2.1 requires pyzmq==18.0.1, but you have pyzmq 18.1.1 which is incompatible.
Successfully installed csbdeep-0.7.2 h5py-2.10.0 numpy-1.22.4 stardist-0.8.3
</code></pre></div> </details> <ul> <li>Also install including OmniPose which I missed installing earlier with CellPose.</li> </ul> <div class=highlight><pre><span></span><code>pip install omnipose --upgrade <span class=p>|&amp;</span> tee -a ~/logs/omnipose_envcp_install.log
</code></pre></div> <details class=warning><summary>Omnipose: Version conflict with <code>pip install</code></summary><p>Similar to StarDist setup, we need to resolve these conflict issues later.</p> <blockquote> <p>Expected end of the installation log:</p> </blockquote> <div class=highlight><pre><span></span><code>Successfully built ncolor
Installing collected packages: mahotas, edt, ncolor, omnipose
  Attempting uninstall: mahotas
    Found existing installation: mahotas 1.4.13
    Uninstalling mahotas-1.4.13:
      Successfully uninstalled mahotas-1.4.13
ERROR: pip&#39;s dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.
cellprofiler 4.2.1 requires docutils==0.15.2, but you have docutils 0.19 which is incompatible.
cellprofiler 4.2.1 requires h5py==3.2.1, but you have h5py 2.10.0 which is incompatible.
cellprofiler 4.2.1 requires matplotlib==3.1.3, but you have matplotlib 3.5.2 which is incompatible.
cellprofiler 4.2.1 requires mysqlclient==1.4.6, but you have mysqlclient 2.0.3 which is incompatible.
cellprofiler 4.2.1 requires python-javabridge==4.0.3, but you have python-javabridge 4.0.0 which is incompatible.
cellprofiler 4.2.1 requires pyzmq==18.0.1, but you have pyzmq 18.1.1 which is incompatible.
cellprofiler 4.2.1 requires sentry-sdk==0.18.0, but you have sentry-sdk 1.9.0 which is incompatible.
cellprofiler 4.2.1 requires wxPython==4.1.0, but you have wxpython 4.1.1 which is incompatible.
Successfully installed edt-2.3.0 mahotas-1.4.12 ncolor-1.1.5 omnipose-0.2.1
</code></pre></div> </details> <h2 id=resolve-version-conflicts>Resolve version conflicts<a class=headerlink href=#resolve-version-conflicts title="Permanent link">&para;</a></h2> <p>Before fixing version conflicts that we observed above, see if example headless pipeline of CellProfiler can run on HPC under <em>cellprofiler</em> conda env. If so, there may not be any need of resolving conflicts. I usually check CellProfiler dependencies in its source code (at setup.py and requirements.txt if any) and at their <a href=https://github.com/CellProfiler/CellProfiler/wiki/Conda-Installation>conda installation</a> and <a href=https://github.com/CellProfiler/CellProfiler/wiki/Ubuntu-20.04>Linux setup</a> pages.</p> <p>I usually avoid package downgrade unless I encounter a relevant error. I also avoid upgrading packages unless there is a change in major or minor version from say <code>h5py</code> 2.10.0 to 3.2.1 as in above case or 2.10.0 to 5.4.1 to 5.5.0. First, I try using <code>mamba update</code> if it can update packages while respecting other packages dependencies that are managed via conda (but may not do so for packages installed via <code>pip</code>).</p> <div class=highlight><pre><span></span><code>mamba update -c conda-forge -c bioconda -c pytorch python-javabridge matplotlib docutils h5py mysqlclient pyzmq sentry-sdk wxPython
</code></pre></div> <blockquote> <p>Resulted into no version changes and so I skipped updating <code>h5py</code> at least for now.</p> </blockquote> <div class="admonition wip"> <p class=admonition-title>ToDo: Check with CellProfiler Team on upgrading <code>h5py</code> package</p> <p>Check with CP team on need for upgrading h5py - whether critical or ok to keep v 2.10.0 over 3.2.1?</p> </div> <p>Another option is to source install CellProfiler from the <a href=https://github.com/CellProfiler/CellProfiler>CP source code</a> and using <code>pip3 install .</code>. Read <a href=https://github.com/CellProfiler/CellProfiler/wiki/Ubuntu-20.04>installing CP on Ubuntu 20.04</a>. However, I have avoided this so far to manage much of my conda CP env using conda and <code>pip install</code> commands. So far, I have not seen errors that break CP workflow with or without use of GPU-based CellPose and StarDist plugins. If I do notice errors that can only be fixed by installing CP from its source, I will update this page accordingly.</p> <ul> <li>At the end of this setup, you should have all three tools installed in cellprofiler conda env.</li> </ul> <div class=highlight><pre><span></span><code>mamba list <span class=p>|</span> grep -E <span class=s2>&quot;cellpose|stardist|cellprofiler&quot;</span>
</code></pre></div> <div class=highlight><pre><span></span><code>cellpose                  2.1.0                    pypi_0    pypi
cellprofiler              4.2.1            py38h779adbc_0    bioconda
cellprofiler-core         4.2.1              pyhdfd78af_0    bioconda
stardist                  0.8.3                    pypi_0    pypi
</code></pre></div> <h2 id=jupyter-support>Jupyter Support<a class=headerlink href=#jupyter-support title="Permanent link">&para;</a></h2> <p>To use cellprofiler conda env in jupyter kernel, e.g., in VScode or elsewhere, install <code>ipykernel</code> (and related jupyter dependencies)</p> <div class=highlight><pre><span></span><code>mamba activate cellprofiler
mamba install -c conda-forge ipykernel
<span class=c1>## install env specific kernel at ~/.local/share/jupyter/kernels</span>
python -m ipykernel install --user --name cellprofiler_py --display-name <span class=s2>&quot;cellprofiler_py&quot;</span>
</code></pre></div> <h3 id=kernel-setup>Kernel setup<a class=headerlink href=#kernel-setup title="Permanent link">&para;</a></h3> <p>This setup - using a wrapper script - will first activate CP conda env and then launch python kernel for jupyter connection. That way, I can be certain that all of <em>cellprofiler</em> conda env configurations, including GPU configs, are loaded before launching jupyter session.</p> <p>To do so, first create a wrapper script like following and save it somewhere on your filesystem, e.g., <em>/projects/foo/hpcenv/opt/kernels/wrap_cellprofiler_py38</em>. </p> <div class=highlight><pre><span></span><code><span class=ch>#!/bin/bash</span>

<span class=c1>## Load env before loading jupyter kernel</span>

<span class=c1>## https://github.com/jupyterhub/jupyterhub/issues/847#issuecomment-260152425</span>

<span class=c1>## restrict loading kernel only to GPU (and not CPU) based HPC</span>
<span class=k>if</span> <span class=o>[[</span> <span class=s2>&quot;</span><span class=k>$(</span>hostname<span class=k>)</span><span class=s2>&quot;</span> !<span class=o>=</span> *<span class=s2>&quot;winter&quot;</span>* <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
    <span class=nb>echo</span> -e <span class=s2>&quot;ERROR: Invalid hostname\nThis kernel works only on winter HPC\n&quot;</span> &gt;<span class=p>&amp;</span><span class=m>2</span>
    <span class=nb>exit</span> <span class=m>1</span>
<span class=k>else</span>
    <span class=c1>#### Activate CONDA in subshell ####</span>
    <span class=c1>## Read https://github.com/conda/conda/issues/7980</span>
    <span class=c1># I am using conda instead of mamba to activate env</span>
    <span class=c1># as somehow I notices warnings/errors sourcing</span>
    <span class=c1># mamba.sh in sub-shells.</span>
    <span class=nv>CONDA_BASE</span><span class=o>=</span><span class=k>$(</span>conda info --base<span class=k>)</span> <span class=o>&amp;&amp;</span> <span class=se>\</span>
    <span class=nb>source</span> <span class=s2>&quot;</span><span class=si>${</span><span class=nv>CONDA_BASE</span><span class=si>}</span><span class=s2>&quot;</span>/etc/profile.d/conda.sh <span class=o>&amp;&amp;</span> <span class=se>\</span>
    conda activate cellprofiler
    <span class=c1>#### END CONDA SETUP ####</span>

    <span class=c1>## Load additional CUDA drivers, toolkit, etc.</span>
    <span class=c1>## if applicable prior to initializing kernel</span>

    <span class=c1># this is the critical part, and should be at the end of your script:</span>
    <span class=c1># replace with path to python under cellprofiler conda env</span>
    <span class=nb>exec</span> /projects/foo/hpcenv/mambaforge/envs/cellprofiler/bin/python -m ipykernel_launcher <span class=s2>&quot;</span><span class=nv>$@</span><span class=s2>&quot;</span>

    <span class=c1>## Make sure to update corresponding kernel.json under ~/.local/share/jupyter/kernels/&lt;kernel_name&gt;/kernel.json</span>
<span class=k>fi</span>
<span class=c1>#_end_</span>
</code></pre></div> <ul> <li>Now go to <code>~/.local/share/jupyter/kernels</code> and locate at <code>kernel.json</code> file under <strong>cellprofiler_py</strong> (or whichever name you used when configuring ipykernel above). Open </li> </ul> <div class=highlight><pre><span></span><code><span class=p>{</span><span class=w></span>
<span class=w> </span><span class=nt>&quot;argv&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w></span>
<span class=w>  </span><span class=s2>&quot;/projects/foo/hpcenv/opt/kernels/wrap_cellprofiler_py38&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>  </span><span class=s2>&quot;-f&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>  </span><span class=s2>&quot;{connection_file}&quot;</span><span class=w></span>
<span class=w> </span><span class=p>],</span><span class=w></span>
<span class=w> </span><span class=nt>&quot;display_name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;cellprofiler_py&quot;</span><span class=p>,</span><span class=w></span>
<span class=w> </span><span class=nt>&quot;language&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;python&quot;</span><span class=p>,</span><span class=w></span>
<span class=w> </span><span class=nt>&quot;metadata&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=nt>&quot;debugger&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w></span>
<span class=w> </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> <details class=tip><summary>Change icons to show CellProfiler icon in Jupyter</summary><p>You can also replace icon images under <code>~/.local/share/jupyter/kernels/cellprofiler_py</code> to show cellprofile env specific icon in Jupyter Launcher session.</p> </details> <figure> <p><img alt="Jupyter Launcher after kernel setup" src=https://code.sbamin.com//assets/images/pages/jupyter_env.png width=98%> </p> <figcaption>Example Jupyter Launcher after kernel setup</figcaption> </figure> <h2 id=backup-conda-env>Backup Conda Env<a class=headerlink href=#backup-conda-env title="Permanent link">&para;</a></h2> <p>At this stage, you should backup configurations for cellprofiler conda env, similar to <a href=https://code.sbamin.com//hpc/cpu/sumner_2/#backup-conda-env>one detailed here</a>.</p> <p>At the end of this setup, including commands that I ran below for GPU and CP plugins setup, my conda <em>cellprofiler</em> env was identical to an <em>env export file</em>: <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path fill-rule=evenodd d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0v-2.5zm7.5-.188V4.25c0 .138.112.25.25.25h2.688a.252.252 0 0 0-.011-.013l-2.914-2.914a.272.272 0 0 0-.013-.011zM5.72 6.72a.75.75 0 0 0 0 1.06l1.47 1.47-1.47 1.47a.75.75 0 1 0 1.06 1.06l2-2a.75.75 0 0 0 0-1.06l-2-2a.75.75 0 0 0-1.06 0zM3.28 7.78a.75.75 0 0 0-1.06-1.06l-2 2a.75.75 0 0 0 0 1.06l2 2a.75.75 0 0 0 1.06-1.06L1.81 9.25l1.47-1.47z"/></svg></span> <a href=https://github.com/sbamin/code101/blob/main/confs/hpc/mambaforge/envs/cellprofiler/bkup/cellprofiler_gpu_env_export_pkgs.yml>cellprofiler_gpu_env_export_pkgs.yml</a>. Some of package versions may differ for you though and that should be ok. Anaconda provides <a href=https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#create-env-from-file>an option to recreate an env similar to an exported env file</a> which I have not tested personally.</p> <h2 id=gpu-configuration>GPU configuration<a class=headerlink href=#gpu-configuration title="Permanent link">&para;</a></h2> <p>Following setup as above, GPU env should be configured and managed via conda. You may however see bash variable <code>CUDA_HOME</code> as undefined. This variable may be required by some tools and should point to path where cellprofiler conda env is installed, e.g., <code>/projects/foo/mambaforge/envs/cellprofiler</code>.</p> <details class=info><summary>Optional: load required CUDA drivers as a modulefile</summary><p>Here an example module file I have in my env. This is optional (and <strong>not loaded</strong> in my HPC env) and only needed for some cases where one or more tools fail to recognize GPU drivers. Talk to your HPC team to configure a valid CUDA driver setup that matches GPU hardware on the HPC.</p> <div class=highlight><pre><span></span><code>(cellprofiler) foo@winter204:/fastscratch/foo/tmp$ module show gpu/10.2_cellprofiler
-----------------------------------------------------------------------------------------------------------------------------------------
   /projects/foo/hpcenv/opt/modules/def/gpu/10.2_cellprofiler:
-----------------------------------------------------------------------------------------------------------------------------------------
whatis(&quot;adds user-defined NVIDIA CUDA 11.1 Toolkit to your environment variables &quot;)
conflict(&quot;gpu/11.1.1&quot;)
conflict(&quot;gpu/11.1.1_ben&quot;)
conflict(&quot;gpu/10.2_ben&quot;)
setenv(&quot;CUDA_INSTALL_PATH&quot;,&quot;/projects/foo/hpcenv/mambaforge/envs/cellprofiler&quot;)
setenv(&quot;CUDA_PATH&quot;,&quot;/projects/foo/hpcenv/mambaforge/envs/cellprofiler&quot;)
setenv(&quot;CUDA_ROOT&quot;,&quot;/projects/foo/hpcenv/mambaforge/envs/cellprofiler&quot;)
setenv(&quot;CUDA_HOME&quot;,&quot;/projects/foo/hpcenv/mambaforge/envs/cellprofiler&quot;)
prepend_path(&quot;PATH&quot;,&quot;/projects/foo/hpcenv/opt/modules/apps/gpu/10.2/local/bin&quot;)
prepend_path(&quot;LIBRARY_PATH&quot;,&quot;/projects/foo/hpcenv/opt/modules/apps/gpu/10.2/local/lib&quot;)
prepend_path(&quot;LD_LIBRARY_PATH&quot;,&quot;/projects/foo/hpcenv/opt/modules/apps/gpu/10.2/local/lib&quot;)
prepend_path(&quot;INCLUDEPATH&quot;,&quot;/projects/foo/hpcenv/opt/modules/apps/gpu/10.2/local/include&quot;)
prepend_path(&quot;MANPATH&quot;,&quot;/projects/foo/hpcenv/opt/modules/apps/gpu/10.2/local/share/man&quot;)
prepend_path(&quot;LIBRARY_PATH&quot;,&quot;/projects/foo/hpcenv/mambaforge/envs/cellprofiler/lib&quot;)
prepend_path(&quot;LD_LIBRARY_PATH&quot;,&quot;/projects/foo/hpcenv/mambaforge/envs/cellprofiler/lib&quot;)
prepend_path(&quot;INCLUDEPATH&quot;,&quot;/projects/foo/hpcenv/mambaforge/envs/cellprofiler/include&quot;)
prepend_path(&quot;CUDA_INC_PATH&quot;,&quot;/projects/foo/hpcenv/mambaforge/envs/cellprofiler&quot;)
setenv(&quot;CUDA_INSTALL_DIR&quot;,&quot;/projects/foo/hpcenv/mambaforge/envs/cellprofiler&quot;)
help([[ Adds user-defined NVIDIA CUDA 11.1 Toolkit to your environment variables,
]])
</code></pre></div> </details> <h3 id=test-gpu>Test GPU<a class=headerlink href=#test-gpu title="Permanent link">&para;</a></h3> <p>Following commands in bash and python should test GPU functionality. Ideally, you should run all three - CellProfiler, CellPose, and StarDist - to ensure that GPU is in-use during runtime.</p> <div class=highlight><pre><span></span><code><span class=nb>echo</span> <span class=nv>$CUDA_HOME</span> <span class=c1># (1)</span>
nvcc --version <span class=c1># (2)</span>
nvidia-smi <span class=c1># (3)</span>
</code></pre></div> <ol> <li>CUDA_HOME should point to conda env home path, e.g., <em>/foo/mambaforge/envs/cellprofiler</em>. If not, you may get an error for certain tools.</li> <li><code>nvcc</code> is located at <code>*/foo/mambaforge/envs/cellprofiler/bin/nvcc</code></li> <li><code>nvidia-smi</code> is a system-managed binary at <code>/usr/bin/nvidia-smi</code></li> </ol> <div class=highlight><pre><span></span><code><span class=nb>export</span> <span class=nv>LD_LIBRARY_PATH</span><span class=o>=</span><span class=s2>&quot;</span><span class=nv>$LD_LIBRARY_PATH</span><span class=s2>:</span><span class=si>${</span><span class=nv>CONDA_PREFIX</span><span class=si>}</span><span class=s2>/lib/&quot;</span>
<span class=c1># Verify install:</span>
python3 -c <span class=s2>&quot;import tensorflow as tf; print(tf.config.list_physical_devices(&#39;GPU&#39;))&quot;</span>
</code></pre></div> <div class=highlight><pre><span></span><code>python -c <span class=s2>&quot;import tensorflow as tf;print(tf.reduce_sum(tf.random.normal([1000, 1000])))&quot;</span>
</code></pre></div> <div class=highlight><pre><span></span><code>2022-07-29 14:08:14.276017: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  SSE4.1 SSE4.2 AVX AVX2 AVX512F FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2022-07-29 14:08:15.656565: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1525] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 30976 MB memory:  -&gt; device: 0, name: Tesla V100-SXM2-32GB, pci bus id: 0000:89:00.0, compute capability: 7.0
</code></pre></div> <blockquote> <p>As long as it says using <code>device:GPU:0</code>, TensorFlow 2 is setup to use GPU.</p> </blockquote> <div class=highlight><pre><span></span><code><span class=kn>import</span> <span class=nn>torch</span>
<span class=c1>## RELU only has one CUDA device: 0</span>
<span class=n>device</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>device</span><span class=p>(</span><span class=s1>&#39;cuda:0&#39;</span><span class=p>)</span>
<span class=n>torch</span><span class=o>.</span><span class=n>zeros</span><span class=p>([</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>])</span><span class=o>.</span><span class=n>to</span><span class=p>(</span><span class=n>device</span><span class=p>)</span>

<span class=n>x</span> <span class=o>=</span> <span class=n>torch</span><span class=o>.</span><span class=n>rand</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</code></pre></div> <blockquote> <p>Should show a tensor with random numbers.</p> </blockquote> <div class=highlight><pre><span></span><code>tensor([[[0., 0., 0.],
         [0., 0., 0.]]], device=&#39;cuda:0&#39;)
</code></pre></div> <div class=highlight><pre><span></span><code>tensor([[0.8770, 0.5362, 0.5748],
        [0.4587, 0.8161, 0.3703],
        [0.0056, 0.8461, 0.0816],
        [0.6864, 0.8047, 0.5323],
        [0.2400, 0.3549, 0.7756]])
</code></pre></div> <h2 id=cellprofiler-plugins>CellProfiler Plugins<a class=headerlink href=#cellprofiler-plugins title="Permanent link">&para;</a></h2> <p>Following guide is based on documentation from <a href=https://github.com/CellProfiler/CellProfiler-plugins>CellProfiler Plugin</a> page.</p> <div class=highlight><pre><span></span><code>mkdir -p <span class=s2>&quot;</span><span class=si>${</span><span class=nv>HPCAPPS</span><span class=si>}</span><span class=s2>&quot;</span>/cellprofiler
<span class=nb>cd</span> <span class=s2>&quot;</span><span class=si>${</span><span class=nv>HPCAPPS</span><span class=si>}</span><span class=s2>&quot;</span>/cellprofiler
git clone https://github.com/CellProfiler/CellProfiler-plugins.git
</code></pre></div> <blockquote> <p>I have used CP plugin version with commits upto: <a class="magiclink magiclink-github magiclink-commit" href=https://github.com/CellProfiler/CellProfiler-plugins/commit/714d4e738921f79cb3c148efe9c02b1720e916d0 title="GitHub Commit: CellProfiler/CellProfiler-plugins@714d4e7">CellProfiler/CellProfiler-plugins@714d4e7</a> dated 2022-08-18.</p> </blockquote> <ul> <li>Open CellProfiler in GUI mode. <code>Preferences &gt; CellProfiler plugins directory</code>, update path to cellprofiler plugins dir. Restart CP from commandline in GUI mode as <code>cellprofiler</code>. If running CP on HPC, this may not be feasible. If so, run CP in headless mode with <code>--plugins-directory</code> flag pointing to plugin path we installed above.</li> </ul> <blockquote> <p>Observe errors on command line and install missing packages as long as 1) updates do not break existing setup of cellprofiler env, and 2) we can run CellPose and StarDist as plugins. We may not need to install dependencies for other plugins, if any. Check plugin-specific dependencies at <a href=https://github.com/CellProfiler/CellProfiler-plugins>CellProfiler-plugins</a> website.</p> </blockquote> <div class=highlight><pre><span></span><code>mamba activate cellprofiler
mamba install -c conda-forge pandas jpype1 pyimagej
</code></pre></div> <ul> <li>Restart CP and check for errors on terminal if any.</li> </ul> <div class=highlight><pre><span></span><code><span class=nb>cd</span> /fastscratch/foo/cellprofiler/toyset
cellprofiler -c -r -p pipeline/hcs_toyrun.cppipe -o output -i input -L <span class=m>20</span>  --plugins-directory <span class=s2>&quot;</span><span class=si>${</span><span class=nv>HPCAPPS</span><span class=si>}</span><span class=s2>&quot;</span>/cellprofiler/CellProfiler-plugins
</code></pre></div> <p>Hurray! CP works in headless mode with GPU-based CellPose as a plugin.</p> <details><summary><span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14 12h-4v-2h4m0 6h-4v-2h4m6-6h-2.81a5.985 5.985 0 0 0-1.82-1.96L17 4.41 15.59 3l-2.17 2.17a6.002 6.002 0 0 0-2.83 0L8.41 3 7 4.41l1.62 1.63C7.88 6.55 7.26 7.22 6.81 8H4v2h2.09c-.05.33-.09.66-.09 1v1H4v2h2v1c0 .34.04.67.09 1H4v2h2.81c1.04 1.79 2.97 3 5.19 3s4.15-1.21 5.19-3H20v-2h-2.09c.05-.33.09-.66.09-1v-1h2v-2h-2v-1c0-.34-.04-.67-.09-1H20V8Z"/></svg></span> Error in sys.excepthook</summary><p>I was able to run CP with GPU-enabled CellPose workflow in headless mode and was able to get expected output of the workflow. However, CP ended with <em>Error in sys.excepthook</em> message but with a bash exit code (<code>$?</code>) 0. This is likely a harmless error and a possible bug in the upstream code. See related <a href=https://forum.image.sc/t/error-in-sys-excepthook-while-running-cellprofiler-in-headless-mode-with-cellpose-as-a-plugin/70866>Image.sc forum post</a></p> </details> <h2 id=questions>Questions<a class=headerlink href=#questions title="Permanent link">&para;</a></h2> <p>For questions specific to above setup, please use GitHub based comments system below. For questions related to cellprofiler and related plugins, please use an excellent community forum at <a href=https://forum.image.sc>Images.sc</a>, including <a href=https://forum.image.sc/tag/cellprofiler>cellprofiler based questions</a>.</p> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2022-09-04</span> </small> </div> <p><small>Author: Samir B. Amin</small></p> <h2 id=__comments>Comments</h2> <p>Comments are powered by <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path fill-rule=evenodd d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg></span> <a href=https://github.com/sbamin/code101/issues>GitHub issues</a> and requires a login with a github id.</p> <script src=https://utteranc.es/client.js repo=sbamin/code101 issue-term=title label="site issues :speech_balloon:" theme=github-light crossorigin=anonymous async>
		</script> <!-- Reload on palette change --> <script>
	var palette = __md_get("__palette")
	if (palette && typeof palette.color === "object")
	  if (palette.color.scheme === "slate") {
	  	
	    	var utterances = document.querySelector("script[src*=utteranc]")
	    	utterances.setAttribute("theme", "github-dark")
	    
	  }

	/* Register event handlers after documented loaded */
	document.addEventListener("DOMContentLoaded", function() {
	  var ref = document.querySelector("[data-md-component=palette]")
	  ref.addEventListener("change", function() {
	    var palette = __md_get("__palette")
	    if (palette && typeof palette.color === "object") {
	    	// reload theme for either giscus or utterances
	    	
				/* Instruct Utterances to change theme */
				// https://github.com/utterance/utterances/issues/549#issuecomment-907606127
				var frame = document.querySelector(".utterances-frame")
				var theme = palette.color.scheme === "slate" ? "github-dark" : "github-light"
				const message = {
					type: 'set-theme',
					theme: theme
				};
      	  		const iframe = document.querySelector('.utterances-frame');
      	  		iframe.contentWindow.postMessage(message, 'https://utteranc.es');
			
	    }
	  })
	})
	</script> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <!-- Footer --> <footer class=md-footer> <!-- Link to previous and/or next page --> <nav class="md-footer__inner md-grid" aria-label=Footer> <!-- Link to previous page --> <a href=../winter_1/ class="md-footer__link md-footer__link--prev" aria-label="Previous: GPU setup" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> GPU setup </div> </div> </a> <!-- Link to next page --> <a href=../../../tags/ class="md-footer__link md-footer__link--next" aria-label="Next: Tags" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Tags </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <!-- Further information --> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <!-- Copyright and theme information --> <div class=md-copyright> <div class=md-copyright__highlight> &copy; 2003-2022: <a href=https://sbamin.com title=Home>SBAmin.com</a> | <a href=/disclosure/ >Disclosure</a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <!-- Social links --> <div class=md-social> <a href=https://sbamin.com/about target=_blank rel=noopener title=sbamin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path fill-rule=evenodd d="M10.5 5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0zm.061 3.073a4 4 0 1 0-5.123 0 6.004 6.004 0 0 0-3.431 5.142.75.75 0 0 0 1.498.07 4.5 4.5 0 0 1 8.99 0 .75.75 0 1 0 1.498-.07 6.005 6.005 0 0 0-3.432-5.142z"/></svg> </a> <a href=https://twitter.com/sbamin target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://linkedin.com/in/samiramin/ target=_blank rel=noopener title=linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=https://github.com/sbamin target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://sbamin.com/contact target=_blank rel=noopener title=sbamin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M0 128c0-35.35 28.65-64 64-64h384c35.3 0 64 28.65 64 64v256c0 35.3-28.7 64-64 64H64c-35.35 0-64-28.7-64-64V128zm48 0v22.1l172.5 141.6c20.6 17 50.4 17 71 0L464 150.1v-23c0-7.9-7.2-16-16-16H64c-8.84 0-16 8.1-16 16v.9zm0 84.2V384c0 8.8 7.16 16 16 16h384c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.6 31.5-132.9 0L48 212.2z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs", "navigation.instant", "navigation.top", "navigation.indexes", "navigation.sections", "content.code.annotate", "search.suggest", "search.highlight", "search.share"], "search": "../../../assets/javascripts/workers/search.85cb4492.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script> <script src=../../../assets/javascripts/bundle.431f3d41.min.js></script> <script src=../../../assets/js/extra.js></script> <script src=../../../assets/js/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.2.1/tablesort.min.js></script> <script src=../../../assets/js/tables.js></script> </body> </html>