<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Getting started with HPC Setup. Part 2: Configure conda enviornment, setup R and python, configure Jupyter kernels and start Jupyter Lab."><meta name=author content="Samir B. Amin"><link href=https://code.sbamin.com/hpc/cpu/sumner_2/ rel=canonical><link rel=icon href=../../../assets/images/fixed/favicon.ico><meta name=generator content="mkdocs-1.3.0, mkdocs-material-8.3.5"><title>Setting up CPU env - Part 2 - Programming 101</title><link rel=stylesheet href=../../../assets/stylesheets/main.4a0965b7.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Fira Code"}</style><link rel=stylesheet href=../../../assets/css/extra.css><script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><!-- Determine analytics provider (deprecated, removed in v8) --><!-- Determine analytics provider --><!-- Set up analytics provider --><!-- Determine analytics property (deprecated, removed in v8) --><!-- Determine analytics property --><!-- Google Analytics 4 (G-XXXXXXXXXX) --><script>
    window.ga = window.ga || function() {
      (ga.q = ga.q || []).push(arguments)
    }
    ga.l = +new Date()

    /* Set up integration and send page view */
    ga("create", "UA-307297-1", "auto")
    ga("set", "anonymizeIp", true)
    ga("send", "pageview")

    /* Register virtual event handlers */
    document.addEventListener("DOMContentLoaded", function() {
      if (document.forms.search) {
        var query = document.forms.search.query
        query.addEventListener("blur", function() {
          if (this.value) {
            var path = document.location.pathname;
            ga("send", "pageview", path + "?q=" + this.value)
          }
        })
      }

      /* Send page view on location change */
      if (typeof location$ !== "undefined")
        location$.subscribe(function(url) {
          ga("send", "pageview", url.pathname)
        })
    })
  </script><script async src=https://www.google-analytics.com/analytics.js></script><!--   <link rel="stylesheet" href="https://code.sbamin.com/../../../assets/stylesheets/main.c296cc61.min.css"> --><meta name=keywords content=hpc,setup,conda,jupyter,kernels,lab,programming,jax,sumner><meta property=og:type content=website><meta property=og:title content="Part 2 · Programming 101"><meta property=og:description content="Getting started with HPC Setup. Part 2: Configure conda enviornment, setup R and python, configure Jupyter kernels and start Jupyter Lab."><meta content=https://code.sbamin.com/hpc/cpu/sumner_2/ property=og:url><meta property=og:image content=https://code.sbamin.com/assets/images/fixed/sitelogo.png><meta property=og:image:type content=image/png><meta property=og:image:width content=256><meta property=og:image:height content=256><meta name=twitter:card content=summary><meta name=twitter:site content=@sbamin><meta name=twitter:creator content=@sbamin><meta name=twitter:title content="Part 2 · Programming 101"><meta name=twitter:description content="Getting started with HPC Setup. Part 2: Configure conda enviornment, setup R and python, configure Jupyter kernels and start Jupyter Lab."><meta name=twitter:image content=https://code.sbamin.com/assets/images/fixed/sitelogo.png><meta name=twitter:image:alt content="webpage banner or site logo"></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#configuring-conda-env class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-component=outdated hidden> <aside class="md-banner md-banner--warning"> </aside> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="Programming 101" class="md-header__button md-logo" aria-label="Programming 101" data-md-component=logo> <img src=../../../assets/images/fixed/sitelogo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Programming 101 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Setting up CPU env - Part 2 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=blue data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=teal data-md-color-accent=light-green aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/sbamin/code101 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M100.59 334.24c48.57 3.31 58.95 2.11 58.95 11.94 0 20-65.55 20.06-65.55 1.52.01-5.09 3.29-9.4 6.6-13.46zm27.95-116.64c-32.29 0-33.75 44.47-.75 44.47 32.51 0 31.71-44.47.75-44.47zM448 80v352a48 48 0 0 1-48 48H48a48 48 0 0 1-48-48V80a48 48 0 0 1 48-48h352a48 48 0 0 1 48 48zm-227 69.31c0 14.49 8.38 22.88 22.86 22.88 14.74 0 23.13-8.39 23.13-22.88S258.62 127 243.88 127c-14.48 0-22.88 7.84-22.88 22.31zM199.18 195h-49.55c-25-6.55-81.56-4.85-81.56 46.75 0 18.8 9.4 32 21.85 38.11C74.23 294.23 66.8 301 66.8 310.6c0 6.87 2.79 13.22 11.18 16.76-8.9 8.4-14 14.48-14 25.92C64 373.35 81.53 385 127.52 385c44.22 0 69.87-16.51 69.87-45.73 0-36.67-28.23-35.32-94.77-39.38l8.38-13.43c17 4.74 74.19 6.23 74.19-42.43 0-11.69-4.83-19.82-9.4-25.67l23.38-1.78zm84.34 109.84-13-1.78c-3.82-.51-4.07-1-4.07-5.09V192.52h-52.6l-2.79 20.57c15.75 5.55 17 4.86 17 10.17V298c0 5.62-.31 4.58-17 6.87v20.06h72.42zM384 315l-6.87-22.37c-40.93 15.37-37.85-12.41-37.85-16.73v-60.72h37.85v-25.41h-35.82c-2.87 0-2 2.52-2-38.63h-24.18c-2.79 27.7-11.68 38.88-34 41.42v22.62c20.47 0 19.82-.85 19.82 2.54v66.57c0 28.72 11.43 40.91 41.67 40.91 14.45 0 30.45-4.83 41.38-10.2z"/></svg> </div> <div class=md-source__repository> sbamin/code101 </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../ class="md-tabs__link md-tabs__link--active"> Getting started with HPC </a> </li> <li class=md-tabs__item> <a href=../../../tags/ class=md-tabs__link> Tags </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="Programming 101" class="md-nav__button md-logo" aria-label="Programming 101" data-md-component=logo> <img src=../../../assets/images/fixed/sitelogo.png alt=logo> </a> Programming 101 </label> <div class=md-nav__source> <a href=https://github.com/sbamin/code101 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M100.59 334.24c48.57 3.31 58.95 2.11 58.95 11.94 0 20-65.55 20.06-65.55 1.52.01-5.09 3.29-9.4 6.6-13.46zm27.95-116.64c-32.29 0-33.75 44.47-.75 44.47 32.51 0 31.71-44.47.75-44.47zM448 80v352a48 48 0 0 1-48 48H48a48 48 0 0 1-48-48V80a48 48 0 0 1 48-48h352a48 48 0 0 1 48 48zm-227 69.31c0 14.49 8.38 22.88 22.86 22.88 14.74 0 23.13-8.39 23.13-22.88S258.62 127 243.88 127c-14.48 0-22.88 7.84-22.88 22.31zM199.18 195h-49.55c-25-6.55-81.56-4.85-81.56 46.75 0 18.8 9.4 32 21.85 38.11C74.23 294.23 66.8 301 66.8 310.6c0 6.87 2.79 13.22 11.18 16.76-8.9 8.4-14 14.48-14 25.92C64 373.35 81.53 385 127.52 385c44.22 0 69.87-16.51 69.87-45.73 0-36.67-28.23-35.32-94.77-39.38l8.38-13.43c17 4.74 74.19 6.23 74.19-42.43 0-11.69-4.83-19.82-9.4-25.67l23.38-1.78zm84.34 109.84-13-1.78c-3.82-.51-4.07-1-4.07-5.09V192.52h-52.6l-2.79 20.57c15.75 5.55 17 4.86 17 10.17V298c0 5.62-.31 4.58-17 6.87v20.06h72.42zM384 315l-6.87-22.37c-40.93 15.37-37.85-12.41-37.85-16.73v-60.72h37.85v-25.41h-35.82c-2.87 0-2 2.52-2-38.63h-24.18c-2.79 27.7-11.68 38.88-34 41.42v22.62c20.47 0 19.82-.85 19.82 2.54v66.57c0 28.72 11.43 40.91 41.67 40.91 14.45 0 30.45-4.83 41.38-10.2z"/></svg> </div> <div class=md-source__repository> sbamin/code101 </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <div class="md-nav__link md-nav__link--index "> <a href=../../ >Getting started with HPC</a> <label for=__nav_2> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav aria-label="Getting started with HPC" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting started with HPC </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2 type=checkbox id=__nav_2_2 checked> <label class=md-nav__link for=__nav_2_2> CPU Computing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="CPU Computing" data-md-level=2> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> CPU Computing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../sumner_1/ class=md-nav__link> Part 1 </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Part 2 <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Part 2 </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#configuring-conda-env class=md-nav__link> Configuring conda env </a> </li> <li class=md-nav__item> <a href=#update-conda-package class=md-nav__link> Update conda package </a> </li> <li class=md-nav__item> <a href=#jupyterlab class=md-nav__link> JupyterLab </a> </li> <li class=md-nav__item> <a href=#installing-r class=md-nav__link> Installing R </a> <nav class=md-nav aria-label="Installing R"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-a-new-env class=md-nav__link> Create a new env </a> </li> <li class=md-nav__item> <a href=#pin-r-and-conda-auto-updates class=md-nav__link> Pin R and conda auto-updates </a> </li> <li class=md-nav__item> <a href=#install-r-libraries class=md-nav__link> Install R libraries </a> <nav class=md-nav aria-label="Install R libraries"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#reticulate-r-package class=md-nav__link> reticulate R package </a> </li> <li class=md-nav__item> <a href=#rpy2-python-package class=md-nav__link> rpy2 python package </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#setup-rprofile-and-renviron class=md-nav__link> Setup Rprofile and Renviron </a> </li> <li class=md-nav__item> <a href=#compiling-r-libraries class=md-nav__link> Compiling R libraries </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#install-essentials class=md-nav__link> Install essentials </a> </li> <li class=md-nav__item> <a href=#setup-jupyterlab class=md-nav__link> Setup JupyterLab </a> <nav class=md-nav aria-label="Setup JupyterLab"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#python-kernel class=md-nav__link> python kernel </a> </li> <li class=md-nav__item> <a href=#r-kernel class=md-nav__link> R kernel </a> </li> <li class=md-nav__item> <a href=#bash-kernel class=md-nav__link> bash kernel </a> </li> <li class=md-nav__item> <a href=#kernel-loading class=md-nav__link> kernel loading </a> <nav class=md-nav aria-label="kernel loading"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#yoda-python class=md-nav__link> yoda python </a> </li> <li class=md-nav__item> <a href=#yoda-r class=md-nav__link> yoda R </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configure-jupyterlab class=md-nav__link> Configure JupyterLab </a> <nav class=md-nav aria-label="Configure JupyterLab"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#self-signed-ssl-certificates class=md-nav__link> self-signed SSL certificates </a> </li> <li class=md-nav__item> <a href=#cookie-file class=md-nav__link> cookie file </a> </li> <li class=md-nav__item> <a href=#config-file class=md-nav__link> config file </a> </li> <li class=md-nav__item> <a href=#jupyter-password class=md-nav__link> jupyter password </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#customizing-user-interface class=md-nav__link> Customizing user interface </a> <nav class=md-nav aria-label="Customizing user interface"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#themes class=md-nav__link> Themes </a> </li> <li class=md-nav__item> <a href=#keyboard-shortcuts class=md-nav__link> keyboard shortcuts </a> </li> <li class=md-nav__item> <a href=#gpg-signatures class=md-nav__link> gpg signatures </a> </li> <li class=md-nav__item> <a href=#rmate class=md-nav__link> rmate </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#backup-conda-env class=md-nav__link> Backup conda env </a> </li> <li class=md-nav__item> <a href=#start-jupyterlab class=md-nav__link> Start JupyterLab </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../sumner_3/ class=md-nav__link> Part 3 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_3 type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3> GPU Computing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="GPU Computing" data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> GPU Computing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../gpu/winter_1/ class=md-nav__link> GPU setup </a> </li> <li class=md-nav__item> <a href=../../gpu/image_analysis_cellprofiler_cellpose/ class=md-nav__link> Image analysis on GPU-based HPC </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../tags/ class=md-nav__link> Tags </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#configuring-conda-env class=md-nav__link> Configuring conda env </a> </li> <li class=md-nav__item> <a href=#update-conda-package class=md-nav__link> Update conda package </a> </li> <li class=md-nav__item> <a href=#jupyterlab class=md-nav__link> JupyterLab </a> </li> <li class=md-nav__item> <a href=#installing-r class=md-nav__link> Installing R </a> <nav class=md-nav aria-label="Installing R"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#create-a-new-env class=md-nav__link> Create a new env </a> </li> <li class=md-nav__item> <a href=#pin-r-and-conda-auto-updates class=md-nav__link> Pin R and conda auto-updates </a> </li> <li class=md-nav__item> <a href=#install-r-libraries class=md-nav__link> Install R libraries </a> <nav class=md-nav aria-label="Install R libraries"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#reticulate-r-package class=md-nav__link> reticulate R package </a> </li> <li class=md-nav__item> <a href=#rpy2-python-package class=md-nav__link> rpy2 python package </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#setup-rprofile-and-renviron class=md-nav__link> Setup Rprofile and Renviron </a> </li> <li class=md-nav__item> <a href=#compiling-r-libraries class=md-nav__link> Compiling R libraries </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#install-essentials class=md-nav__link> Install essentials </a> </li> <li class=md-nav__item> <a href=#setup-jupyterlab class=md-nav__link> Setup JupyterLab </a> <nav class=md-nav aria-label="Setup JupyterLab"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#python-kernel class=md-nav__link> python kernel </a> </li> <li class=md-nav__item> <a href=#r-kernel class=md-nav__link> R kernel </a> </li> <li class=md-nav__item> <a href=#bash-kernel class=md-nav__link> bash kernel </a> </li> <li class=md-nav__item> <a href=#kernel-loading class=md-nav__link> kernel loading </a> <nav class=md-nav aria-label="kernel loading"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#yoda-python class=md-nav__link> yoda python </a> </li> <li class=md-nav__item> <a href=#yoda-r class=md-nav__link> yoda R </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configure-jupyterlab class=md-nav__link> Configure JupyterLab </a> <nav class=md-nav aria-label="Configure JupyterLab"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#self-signed-ssl-certificates class=md-nav__link> self-signed SSL certificates </a> </li> <li class=md-nav__item> <a href=#cookie-file class=md-nav__link> cookie file </a> </li> <li class=md-nav__item> <a href=#config-file class=md-nav__link> config file </a> </li> <li class=md-nav__item> <a href=#jupyter-password class=md-nav__link> jupyter password </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#customizing-user-interface class=md-nav__link> Customizing user interface </a> <nav class=md-nav aria-label="Customizing user interface"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#themes class=md-nav__link> Themes </a> </li> <li class=md-nav__item> <a href=#keyboard-shortcuts class=md-nav__link> keyboard shortcuts </a> </li> <li class=md-nav__item> <a href=#gpg-signatures class=md-nav__link> gpg signatures </a> </li> <li class=md-nav__item> <a href=#rmate class=md-nav__link> rmate </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#backup-conda-env class=md-nav__link> Backup conda env </a> </li> <li class=md-nav__item> <a href=#start-jupyterlab class=md-nav__link> Start JupyterLab </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/sbamin/code101/edit/scratch/web/docs/hpc/cpu/sumner_2.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <nav class=md-tags> <a href=../../../tags/#hpc class=md-tag> hpc </a> <a href=../../../tags/#setup class=md-tag> setup </a> <a href=../../../tags/#conda class=md-tag> conda </a> <a href=../../../tags/#kernels class=md-tag> kernels </a> <a href=../../../tags/#jupyter class=md-tag> jupyter </a> <a href=../../../tags/#programming class=md-tag> programming </a> </nav> <h1>Part 2</h1> <p>Following up from <a href=../sumner_1/ >Part 1: Initial HPC setup</a>, we now start installing essential softwares or (in conda dictionary) packages, e.g., R, Jupyter, etc.</p> <div class=highlight><pre><span></span><code><span class=c1>## login back to HPC</span>
ssh userid@login.sumner.jax.org

<span class=c1>## start screen</span>
screen

<span class=c1>## start interactive session</span>
srun -p compute -q batch -N <span class=m>1</span> -n <span class=m>4</span> --mem 10G -t <span class=m>08</span>:00:00 --pty bash

<span class=c1>## unload gcc if loaded</span>
module unload gcc
</code></pre></div> <div class="admonition danger"> <p class=admonition-title>☠️ Keep a note of walltime ☠️</p> <p>Make sure you do not run over alloted walltime while configuring conda env, especially when you are in the middle of installing via <code>mamba install</code> or <code>mamba update</code> command, and walltime dies out! (speaking from an experience) and that may break an ongoing conda setup.</p> <p>conda is good in a way that it locks process files for package(s) it is trying to install or update. If you are lucky, you should be able to save your ongoing setup else start again! Just read errors you may encounter during such issue and it should resolve such issue.</p> </div> <h2 id=configuring-conda-env>Configuring conda env<a class=headerlink href=#configuring-conda-env title="Permanent link">&para;</a></h2> <p>Typically, we use <code>conda</code> command to manage all of conda env, e.g., <code>conda install package</code>, <code>conda update package</code>, <code>conda list</code>, etc. However, we will now use <code>mamba</code> instead of <code>conda</code>. <a href=https://github.com/mamba-org/mamba>Mamba</a> is a faster drop-in replacement for <code>conda</code> to manage packages.</p> <div class="admonition tip"> <p class=admonition-title>Use <code>mamba</code> instead of <code>conda</code></p> <p>Moving forward, do not forget to use <code>mamba</code> instead of <code>conda</code> for all of available commands. See <code>mamba --help</code> to list available commands. At present, following commands from <code>conda</code> are supported by <code>mamba</code>: install, create, list, search, run, info and clean. For rest of commands, e.g, config, activate, deactivate, etc., use <code>conda</code> command.</p> <p>Turns out <code>mamba activate &lt;env_name&gt;</code> or <code>mamba deactivate</code> also works following one-time command: <code>mamba init</code> which will ensure sourcing mamba shell variable at the bash startup by writing a few lines towards the end of <em>~/.bashrc</em> file. <strong>Please note</strong> to execute <code>mamba init</code> after <code>conda init</code> as in <a href=../sumner_1/#install-conda>Part 1: Initialize conda</a>. This will ensure at the bash startup sequence to load conda setup prior to mamba setup. If you end up running <code>mamba init</code> now (I ended up running it late in the setup), prefer activating or deactivating conda env using <code>mamba</code> and not <code>conda</code> command.</p> </div> <p>It is important to install packages only from a single channel and not do mix-and-match install. Read more at <a href=https://conda-forge.org/docs/user/tipsandtricks.html>conda-forge page</a> on <code>channel_priority: strict</code> which is enabled as default for conda v4.6 or higher. We are using conda v4.10.3 and anaconda v2021-11. We can check that using <code>conda --version</code> and <code>conda list anaconda</code> respectively.</p> <ul> <li>Add Bioconda and conda-forge channels to get updated and compbio related packages. <strong>Do not</strong> change the order of following commands and a command with <code>--add channels conda-forge</code> must be the last one else other channels may take a priority over default <code>conda-forge</code> channel.</li> </ul> <div class=highlight><pre><span></span><code>conda config --add channels bioconda
conda config --add channels conda-forge
</code></pre></div> <p>Above command will generate <code>~/.condarc</code> file and sets priority for channels, i.e., when same package is available from more than one channels, we prioritize installation per ordered channel list in <code>~/.condarc</code> file as below. This file should be present after above commands and no need to edit unless changing priority of channels.</p> <div class="admonition tip"> <p class=admonition-title>precedence of <em>condarc</em> file</p> <p>Since we are using Mambaforge and not anaconda3, it already ships with conda-forge as a default channel, as specified in <code>cat "${CONDA_PREFIX}"/.condarc</code>. Note that <em>~/.condarc</em> will <a href=https://docs.conda.io/projects/conda/en/latest/user-guide/configuration/use-condarc.html>take precedence over default</a> <em>"${CONDA_PREFIX}"/.condarc</em> file, so ensure that <code>conda-forge</code> is the most preferred channel (first channel) in both files.</p> </div> <ul> <li>Besides channel priority, I have added a few other custom settings to my <em>~/.condarc</em> file. For more on these settings, please <a href=https://docs.conda.io/projects/conda/en/latest/user-guide/configuration/use-condarc.html>refer to condarc documentation</a> before applying to your own HPC env.</li> </ul> <blockquote> <p><em>~/.condarc</em> is a yml format file, so take care of preceding spaces (and not tabs) before and after <code>-</code> while editing this file.</p> </blockquote> <div class=highlight><pre><span></span><code><span class=nt>channels</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">conda-forge</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bioconda</span><span class=w></span>
<span class=nt>auto_update_conda</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class=w></span>
<span class=nt>always_yes</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class=w></span>
<span class=nt>add_pip_as_python_dependency</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class=w></span>
<span class=nt>ssl_verify</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class=w></span>
<span class=nt>allow_softlinks</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">True</span><span class=w></span>
<span class=nt>use_only_tar_bz2</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class=w></span>
<span class=nt>anaconda_upload</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">False</span><span class=w></span>

<span class=nt>repodata_threads</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class=w></span>
<span class=nt>verify_threads</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class=w></span>
<span class=nt>execute_threads</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class=w></span>
</code></pre></div> <div class="admonition danger"> <p class=admonition-title>Do not exceed requested resources for an interactive job</p> <p>If you increase number of threads for conda operations, make sure that you request required threads for an interactive HPC job else you may consume more resources than requested threads, and HPC workload manager may kill your interactive job - conda env can potentially break if interrupted during install or update command.</p> </div> <ul> <li>You can verify custom set <em>~/.condarc</em> configurations using <code>conda config --get</code> command. If some of key:value pairs are showing warnings saying <em>unknown key</em>, you should remove those entries from <em>~/.condarc</em>.</li> </ul> <blockquote> <p>If channel priority has been set as above, you will notice <code>--add channels 'conda-forge' # highest priority</code> from the output of <code>conda config --get</code> command.</p> </blockquote> <h2 id=update-conda-package>Update conda package<a class=headerlink href=#update-conda-package title="Permanent link">&para;</a></h2> <ul> <li>Since we used Mambaforge, anaconda3 variant from a third-pary <a href=https://conda-forge.org>conda-forge</a> open-source community, let's make sure that the base <code>conda</code> package is the most up-to-date or not.</li> </ul> <div class=highlight><pre><span></span><code>conda --version
</code></pre></div> <blockquote> <p>conda 4.10.3</p> </blockquote> <ul> <li>To check if this is the current version, we will update <code>conda</code> package. </li> </ul> <div class=highlight><pre><span></span><code>mamba update conda
</code></pre></div> <blockquote> <p>You may notice that conda update is available else no further action needed. Notice source of updated conda package from <em>conda-forge/linux-64</em>. That is because we set <em>conda-forge</em> with the highest channel priority in <em>~/.condarc</em>. </p> </blockquote> <div class=highlight><pre><span></span><code>  - conda       4.10.3  py39hf3d152e_2  installed                      
  + conda       4.11.0  py39hf3d152e_0  conda-forge/linux-64      17 MB
</code></pre></div> <ul> <li>Confirm that conda package is now updated with an updated version, if any.</li> </ul> <div class=highlight><pre><span></span><code>conda --version
</code></pre></div> <blockquote> <p>conda 4.11.0</p> </blockquote> <h2 id=jupyterlab>JupyterLab<a class=headerlink href=#jupyterlab title="Permanent link">&para;</a></h2> <p>For most packages, e.g., R, snakemake workflow, etc., we will use dedicated conda env and avoid installing into base env. That is to keep base env clean and without much of dependencies. Unlike base env, additional env can be recreated without a risk of breaking conda setup. However, we will require a few packages, e.g., JupyterLab and Notebook, that typically ships with regular (and not miniconda or mambaforge) anaconda3 installation.</p> <details class=tip><summary>Install JupyterLab in its own conda env</summary><p>If you prefer, you can skip installing JupyterLab in <em>base</em> env and instead use its own dedicated env. This is perhaps a preferred way to keep <em>base</em> env minimal and also allows you to update JupyterLab from time to time without worrying about breaking <em>base</em> env. However, when you start jupyterlab session, you need to switch (activate) to the respective conda env from <em>base</em> or other envs.</p> <p>To install jupyterlab in its dedicated env, do following:</p> <div class=highlight><pre><span></span><code>mamba create -c conda-forge -n jlab jupyterlab nodejs jupyterthemes jupytext dos2unix jupyter_http_over_ws jupyterlab-link-share

mamba activate jlab

<span class=c1>## check installed extensions, if any</span>
jupyter lab extension list
jupyter server extension list
</code></pre></div> <p>Read install guide for extensions, if any, e.g. some extensions like jupyter_http_over_ws are not enabled by default for good (saftey) reasons.</p> </details> <ul> <li><a href=https://jupyter.org>JupyterLab</a> is similar to RStudio IDE and provides richer interface to several programming languages, including python, R, julia, and many more. To install jupyterlab, <a href=https://jupyterlab.readthedocs.io/en/stable/getting_started/installation.html>please read installation guide</a>.</li> </ul> <div class=highlight><pre><span></span><code><span class=c1>## core package</span>
mamba install -c conda-forge jupyterlab
</code></pre></div> <blockquote> <p>Even though conda-forge is set as the highest priority channel in <em>~/.condarc</em>, I am explicitly specifying to use the same channel while running install or update command.</p> <p>This will install jupyterlab and series of its dependencies. You can check version of related packages using <code>mamba list | grep -E "jupyter"</code> although versions may differ as they get updated over time.</p> </blockquote> <div class=highlight><pre><span></span><code># packages in environment at /projects/verhaak-lab/amins/hpcenv/mambaforge:
#
# Name                    Version                   Build  Channel
jupyter_client            7.1.0              pyhd8ed1ab_0    conda-forge
jupyter_core              4.9.1            py39hf3d152e_1    conda-forge
jupyter_server            1.12.1             pyhd8ed1ab_0    conda-forge
jupyterlab                3.2.4              pyhd8ed1ab_0    conda-forge
jupyterlab_pygments       0.1.2              pyh9f0ad1d_0    conda-forge
jupyterlab_server         2.8.2              pyhd8ed1ab_0    conda-forge
</code></pre></div> <ul> <li><strong>Optional:</strong> I have also installed following set of packages in the base env for my own needs or convenience for not switching to other conda environments. If you do so, try to limit installing packages in base env to bare minimum, and avoid installing packages that require multiple dependencies, e.g., R, tensorflow, node, julia, GO library, etc.</li> </ul> <div class=highlight><pre><span></span><code>mamba install -c conda-forge git rsync vim globus-cli tmux screen
</code></pre></div> <p>We will setup rest of jupyterlab settings and initialize it later after we install R in a separate conda env.</p> <h2 id=installing-r>Installing R<a class=headerlink href=#installing-r title="Permanent link">&para;</a></h2> <p>We will install R and other routinely used tools in a separate conda env for reasons explained above. You should <a href=https://docs.anaconda.com/anaconda/user-guide/tasks/using-r-language/ >read official documentation on installing R</a> to familiarize with steps that I am going to follow below.</p> <h3 id=create-a-new-env>Create a new env<a class=headerlink href=#create-a-new-env title="Permanent link">&para;</a></h3> <p>I am going to name a new env as <strong><em>yoda</em></strong>. Ideally, naming should be such that you should not have difficulty finding which env to switch to for the type of packages and analysis you may end up running at the later date, e.g., in my case, while far from ideal, I have used nomenclature based on <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="m554.9 293.1-58.88 58.88h40C493.2 446.1 398.2 511.1 287.1 512 176.8 511.992 81.9 446.12 40 352h40l-58.87-58.9c-3.38-18-5.13-34.5-5.13-51.9 0-5.75.75-11.5 1-17.25h47L22.75 182.7C37.38 117.1 75.86 59.37 130.6 20.5c2.75-2 6.021-3.005 9.272-3.005 5.5 0 10.5 2.75 13.5 7.25 3.125 4.375 3.625 10.13 1.625 15.13C148.5 56.12 145.1 73.62 145.1 91.12c0 45.13 21.13 86.63 57.75 113.8 4.05 2.78 6.55 7.48 6.65 12.28.25 5-1.751 9.752-5.501 13-32.75 29.38-47.5 74-38.5 117.1 9.751 48.38 48.88 87.13 97.26 96.5l2.5-65.37-27.13 18.5c-3.125 2-7.251 1.75-10-.75-2.75-2.625-3.25-6.75-1.375-10l20.13-33.75-42.13-8.627c-3.625-.875-6.375-4.125-6.375-7.875s2.75-7 6.375-7.875l42.13-8.75L226.8 285.6c-1.9-3.1-1.4-7.2 1.3-9.9 2.75-2.5 6.876-2.875 10-.75l30.38 20.63 11.49-287.8C280.3 3.461 283.7.016 287.1 0c4.237.016 7.759 3.461 8.009 7.828l11.49 287.8 30.38-20.63c3.125-2.125 7.251-1.75 10 .75 2.75 2.625 3.25 6.75 1.375 9.875l-20.13 33.75 42.13 8.75c3.625.875 6.375 4.125 6.375 7.875s-2.75 7-6.375 7.875l-42.13 8.627 20.13 33.75c1.875 3.25 1.375 7.375-1.375 10-2.75 2.5-6.876 2.75-10 .75l-27.13-18.5 2.5 65.37c48.38-9.375 87.51-48.13 97.26-96.5 9.001-43.13-5.75-87.75-38.5-117.1-3.75-3.25-5.751-8.002-5.501-13 .125-4.875 2.626-9.5 6.626-12.38 36.63-27.13 57.75-68.63 57.75-113.8 0-17.5-3.375-35-9.875-51.25-2-5-1.5-10.75 1.625-15.13 3-4.5 8.001-7.25 13.5-7.25 3.25 0 6.474.955 9.224 2.955 54.75 38.88 93.28 96.67 107.9 162.3l-41.25 41.25h47c.25 5.75.997 11.5.997 17.25C559.1 258.6 558.3 275.1 554.9 293.1z"/></svg></span> <a href=https://en.wikipedia.org/wiki/Jedi>the Jedi members</a> for conda env:</p> <table> <thead> <tr> <th>env id</th> <th>intended use</th> </tr> </thead> <tbody> <tr> <td>yoda</td> <td>hosts all packages, including R and others that I use on daily basis</td> </tr> <tr> <td>luke</td> <td>serves as an env for background processes using databases</td> </tr> <tr> <td>leia</td> <td>a standalone env for <a href=https://snakemake.readthedocs.io>running snakemake</a> workflows</td> </tr> <tr> <td>obiwan</td> <td>fallback to <em>yoda</em> when I require to use another mature version of R or other packages</td> </tr> <tr> <td>windu</td> <td>conda env using legacy Python 2 over Python 3</td> </tr> <tr> <td>anakin</td> <td>dev or beta env for testing: Optimized for CPU-based HPC</td> </tr> <tr> <td>rey</td> <td>Similar to yoda but optimized for GPU-based HPC</td> </tr> <tr> <td>ben</td> <td>dev or beta env for testing: Optimized for GPU-based HPC</td> </tr> <tr> <td>grogu</td> <td>toy env for everything else: for experimental purpose</td> </tr> </tbody> </table> <blockquote> <p><em>rey</em> and <em>ben</em> env are optimized for GPU-based, <em>Winter</em> HPC at JAX and should not be used while working in the CPU-based, <em>Sumner</em> HPC at JAX. However, all of CPU-based envs, e.g., <em>yoda, luke, leia</em>, etc. will work on both, Sumner and Winter HPCs.</p> </blockquote> <ul> <li>Let's create the first env, <em>yoda</em> and install base R package and a several essential R packages for routine analysis.</li> </ul> <div class=highlight><pre><span></span><code>mamba create -c conda-forge -n yoda r-base r-essentials
</code></pre></div> <blockquote> <p>Note that most up-to-date R version may be available in the <em>conda-forge</em> or sometimes in the other conda channels, like <em>r</em> or <em>bioconda</em>. However, <strong>it is preferable to install R from the first priority channel</strong>, i.e., <em>conda-forge</em> in our case.</p> </blockquote> <ul> <li>Activate a new env. Note that we use <code>conda</code> instead of <code>mamba</code> command as the latter (at least for now) only accepts following sub commands: install, create, list, search, run, info and clean.</li> </ul> <div class=highlight><pre><span></span><code>conda activate yoda
</code></pre></div> <blockquote> <p>You will notice bash prompt changing from <code>(base) [userid@sumner50]</code> to <code>(yoda) [userid@sumner50]</code>.</p> </blockquote> <h3 id=pin-r-and-conda-auto-updates>Pin R and conda auto-updates<a class=headerlink href=#pin-r-and-conda-auto-updates title="Permanent link">&para;</a></h3> <ul> <li>Before moving further, let's <a href=https://stackoverflow.com/a/48733093/1243763 title="how to fix software versions in conda environment - stackoverflow">pin R version</a> to 4.1.1 (at the time of this writing) and also disallow conda auto-updates. That way, we have lesser chances of breaking conda env when we do <code>mamba install &lt;pkg&gt;</code> in future, and carefully install/update packages without breaking existing setup. For more on pinning packages, <a href=https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-pkgs.html#preventing-packages-from-updating-pinning>read official documentation</a>.</li> </ul> <div class="admonition note"> <p class=admonition-title>Technical note</p> <p>Typically, I avoid installing or updating package if <code>mamba install</code> throws a message or warning about <strong>removing or downgrading existing packages</strong>. In such cases, I fall back to <a href=https://docs.conda.io/projects/conda-build/en/latest/resources/compiler-tools.html>compiling package using available devtools in conda</a>. Also, I load compiled package using <em>Modulefile</em> when needed, and not integrate it in my default bash environment as this may give errors while running some random program due to conflicts in shared library versions.</p> </div> <div class=highlight><pre><span></span><code><span class=c1>## we already set auto update to False above</span>
<span class=c1>## under ~/.condarc settings</span>
<span class=c1># conda config --set auto_update_conda False</span>

<span class=c1># Find package version using</span>
mamba list <span class=p>|</span> grep -Ei <span class=s1>&#39;r-base&#39;</span>
</code></pre></div> <ul> <li>We can notice that R version is 4.1.1 (or higher). You can also check R version by <code>R --version</code>. Remember this version and add it to following newly created file:</li> </ul> <div class=highlight><pre><span></span><code>nano <span class=s2>&quot;</span><span class=si>${</span><span class=nv>CONDA_PREFIX</span><span class=si>}</span><span class=s2>&quot;</span>/conda-meta/pinned
</code></pre></div> <blockquote> <p>Note that <code>echo ${CONDA_PREFIX}</code> points to <em>conda-meta/</em> directory under <em>yoda</em> and not the <em>base</em> env because we are within <em>yoda</em> env. In other words, pinned packages env specific and you can update R package in other environment(s), if present.</p> </blockquote> <ul> <li>Add following as a new line entry:</li> </ul> <div class=highlight><pre><span></span><code>r-base ==4.1.1
</code></pre></div> <details class=info><summary>Check a valid line break</summary><p>Since we are creating a new file and only adding a single line of text, when we save this text file, we should confirm that it is the <a href=https://en.wikipedia.org/wiki/Newline>end of the line</a>. This is usually recognized by pressing the <span class=keys><kbd class=key-enter>Enter</kbd></span>. Unix systems recognizes such line break using an invisible <code>$</code> sign which you can confirm by running <code>cat -e "${CONDA_PREFIX}"/conda-meta/pinned</code></p> <div class=highlight><pre><span></span><code>r-base ==4.1.1$
$
</code></pre></div> <p>With each line break, you will notice <code>$</code> sign, e.g., two lines in my case. You may remove a second line by editing file again but make sure to run <code>cat -e "${CONDA_PREFIX}"/conda-meta/pinned</code> to check a valid line break.</p> </details> <p>You may <a href=https://conda.io/projects/conda/en/latest/user-guide/tasks/manage-pkgs.html#preventing-packages-from-updating-pinning>pin</a> only part of <a href=https://en.wikipedia.org/wiki/Software_versioning>the major and minor version</a>, i.e., to allow updates from 4.1.1 to 4.1.2 or 4.1.3 but not from 4.1.1 to 4.2.*. However, I rather freeze the specific version and update to builds at the later date, if need arises. To do so, remove the pinned entry from <code>"${CONDA_PREFIX}"/conda-meta/pinned</code> and do <code>mamba update r-base=4.1.2</code> or other version. Since <a href=https://cran.r-project.org/doc/manuals/r-release/NEWS.html>R developer team</a> updates <a href=https://en.wikipedia.org/wiki/Software_versioning>major.minor version</a> of R every quarter or so, I try to keep those R versions in a separate env rather updating as certain R packages may throw an error with such major updates.</p> <h3 id=install-r-libraries>Install R libraries<a class=headerlink href=#install-r-libraries title="Permanent link">&para;</a></h3> <p>You may now install additional R libraries (or packages - it's alias!) or any other packages, e.g., git, bedtools, samtools, etc. in the new env using <code>mamba install</code> command. Just make sure that you are in the new env by <code>conda activate yoda</code>. You can check which env you are in by <code>echo "$(basename ${CONDA_PREFIX})"</code></p> <blockquote> <p>Some of packages, e.g., git, rsync, etc. are already installed in the base env. However, they may not be recognized in the new env: <em>yoda</em>. Ideally, you should install the same package in the new env. Conda will usually link package files (which takes much of space) from the central package directory, so installing the same package in different env should not take significant additional space.</p> </blockquote> <p>To search for packages, prefer using <a href=https://anaconda.org/ >anaconda website</a> and look for packages that are under <em>conda-forge/</em> or <em>bioconda</em> channels, i.e., the first and second preference, respectively in our <em>~/.condarc</em> file.</p> <div class="admonition warning"> <p class=admonition-title>Avoid installing packages from non-standard channels</p> <p>For a stable and error-free conda env, avoid installing conda packages from non-standard channels, i.e., a channel other than conda-forge and bioconda or ones specified in <em>~/.condarc</em> file. Installing packages from non-standard channels will unnecessarily increase complexity of package dependencies in conda env and will increase likelihood of slowing or breaking down one or more conda env. Note that we have yet to create additional conda env besides a default base env.</p> </div> <ul> <li>Install R packages: You can tie up all of your packages in a single command or break it down to smaller chunks. The former appraoch may take longer and difficult to debug if package installation fails due to conflicting dependencies with one or more packages.</li> </ul> <div class=highlight><pre><span></span><code>mamba install -c conda-forge r-tidyverse r-tidymodels r-devtools r-biocmanager
mamba install -c conda-forge gnupg git rsync vim openjdk r-rjava
mamba install -c conda-forge bedtools pybedtools bedops
mamba install -c conda-forge matplotlib scikit-learn
</code></pre></div> <ul> <li>Reticulate and rpy2 packages will allow us to use R and python interchangeably in the same R script or python notebook, respectively! <a href=https://rstudio.github.io/reticulate/ >Read details about reticulate on RStudio website</a> and <a href=https://rpy2.github.io/ >rpy2 here</a>.</li> </ul> <h4 id=reticulate-r-package>reticulate R package<a class=headerlink href=#reticulate-r-package title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>mamba install -c conda-forge r-reticulate
</code></pre></div> <h4 id=rpy2-python-package>rpy2 python package<a class=headerlink href=#rpy2-python-package title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code>mamba install -c conda-forge rpy2
</code></pre></div> <p>If above command works without forcing you to downgrade python, R, or other major packages, good for you! If not, it is due to <a href=https://github.com/rpy2/rpy2/blob/master/setup.py>strict requirements</a> of rpy2 package which can conflict with other core packages in <em>yoda</em> env. So, <code>mamba install -c conda-forge rpy2</code> may not work.</p> <div class="admonition danger"> <p class=admonition-title>☠️ Beware of using <code>pip install</code> in conda env ☠️</p> <p>You should be comfortable compiling and installing packages using <code>pip install</code> and knowing how to manually install python package requirements. If not, it is safer to skip installing rpy2 (or any other) package by steps detailed below. Wait until <em>conda-forge</em> developers make rpy2 package available. <em>conda-forge</em> developer community is pretty good and active, so patience should pay off then risking to break an otherwise functioning <em>yoda</em> env!</p> </div> <ul> <li>From <a href=https://github.com/rpy2/rpy2>rpy2 setup.py and requirements.txt</a> file, list number of packages required as dependencies for rpy2.</li> </ul> <blockquote> <p>If we do <code>pip install rpy2</code>, pip will automatically install these requirements. However, I prefer to let conda manage all package versions because <strong>pip may not necessarily evaluate if certain package versions are compatible with other conda-installed packages</strong>. That's why I prefer installing requirements by myself using <code>mamba install</code> and then do <code>pip install</code>, so only minimal set of requirements will be installed by pip command. That way, I can minimize chances of breaking conda env due to conflicting package dependencies.</p> </blockquote> <div class=highlight><pre><span></span><code><span class=c1>## required packages by rpy2</span>
<span class=c1>## see how many of these are already installed</span>
conda list <span class=p>|</span> grep -E <span class=s2>&quot;cffi|pytest|pandas|numpy|jinja2|pytz|tzlocal&quot;</span>
</code></pre></div> <ul> <li>Install missing packages using <code>mamba</code>.</li> </ul> <div class=highlight><pre><span></span><code><span class=c1>## ok to write packages which are already installed</span>
<span class=c1>## conda will take care of version conflict, if any.</span>
mamba install -c conda-forge cffi pytest pandas numpy jinja2 pytz tzlocal
</code></pre></div> <ul> <li>Now try (fingers crossed!) installing rpy2 using pip. Make sure that <a href=https://pypi.org/project/rpy2/ >rpy2 pip website</a> is showing same version (3.4.5 in my case) as on <a href=https://github.com/rpy2/rpy2>rpy2 github website</a> else you need to download source file from pip website, and check respective <em>setup.py</em> and <em>requirements.txt</em> file to ensure dependencies are identical and satisfied or installed via <code>mamba install</code> command.</li> </ul> <div class=highlight><pre><span></span><code><span class=c1>## in yoda env</span>
mkdir - ~/logs <span class=o>&amp;&amp;</span> <span class=se>\</span>
pip install rpy2 <span class=p>|&amp;</span> tee -a logs/pip_install_rpy2.log
</code></pre></div> <details class=info><summary>Success installing rpy2</summary><p>Great! <code>pip install</code> did not end up installing any dependencies (as we already installed those using <code>mamba install</code>), and rpy2 is now successfully installed.</p> <div class=highlight><pre><span></span><code>Collecting rpy2
  Downloading rpy2-3.4.5.tar.gz (194 kB)
  Preparing metadata (setup.py): started
  Preparing metadata (setup.py): finished with status &#39;done&#39;
Requirement already satisfied: cffi&gt;=1.10.0 in /projects/verhaak-lab/amins/hpcenv/mambaforge/envs/yoda/lib/python3.10/site-packages (from rpy2) (1.15.0)
Requirement already satisfied: jinja2 in /projects/verhaak-lab/amins/hpcenv/mambaforge/envs/yoda/lib/python3.10/site-packages (from rpy2) (3.0.3)
Requirement already satisfied: pytz in /projects/verhaak-lab/amins/hpcenv/mambaforge/envs/yoda/lib/python3.10/site-packages (from rpy2) (2021.3)
Requirement already satisfied: tzlocal in /projects/verhaak-lab/amins/hpcenv/mambaforge/envs/yoda/lib/python3.10/site-packages (from rpy2) (4.1)
Requirement already satisfied: pycparser in /projects/verhaak-lab/amins/hpcenv/mambaforge/envs/yoda/lib/python3.10/site-packages (from cffi&gt;=1.10.0-&gt;rpy2) (2.21)
Requirement already satisfied: MarkupSafe&gt;=2.0 in /projects/verhaak-lab/amins/hpcenv/mambaforge/envs/yoda/lib/python3.10/site-packages (from jinja2-&gt;rpy2) (2.0.1)
Requirement already satisfied: pytz-deprecation-shim in /projects/verhaak-lab/amins/hpcenv/mambaforge/envs/yoda/lib/python3.10/site-packages (from tzlocal-&gt;rpy2) (0.1.0.post0)
Requirement already satisfied: tzdata in /projects/verhaak-lab/amins/hpcenv/mambaforge/envs/yoda/lib/python3.10/site-packages (from pytz-deprecation-shim-&gt;tzlocal-&gt;rpy2) (2021.5)
Building wheels for collected packages: rpy2
  Building wheel for rpy2 (setup.py): started
  Building wheel for rpy2 (setup.py): finished with status &#39;done&#39;
  Created wheel for rpy2: filename=rpy2-3.4.5-cp310-cp310-linux_x86_64.whl size=300939 sha256=136144e165e2b0f156fdb7f525547ae073dda06346a893de398aa6836e625af1
  Stored in directory: /home/amins/.cache/pip/wheels/ba/d8/8b/68fc240578a71188d0ca04b6fe8a58053fbcbcfbe2a3cbad12
Successfully built rpy2
Installing collected packages: rpy2
Successfully installed rpy2-3.4.5
</code></pre></div> </details> <ul> <li>Since we just installed JAVA (openjdk) and rJava R library, for sanity check, run <code>R CMD javareconf</code> (to print and update java configuration for R) and <code>echo $JAVA_HOME</code> (to confirm that bash variable is correctly set).</li> <li>If you also have installed git, you can copy boilerplate <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path fill-rule=evenodd d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0v-2.5zm7.5-.188V4.25c0 .138.112.25.25.25h2.688a.252.252 0 0 0-.011-.013l-2.914-2.914a.272.272 0 0 0-.013-.011zM5.72 6.72a.75.75 0 0 0 0 1.06l1.47 1.47-1.47 1.47a.75.75 0 1 0 1.06 1.06l2-2a.75.75 0 0 0 0-1.06l-2-2a.75.75 0 0 0-1.06 0zM3.28 7.78a.75.75 0 0 0-1.06-1.06l-2 2a.75.75 0 0 0 0 1.06l2 2a.75.75 0 0 0 1.06-1.06L1.81 9.25l1.47-1.47z"/></svg></span> <a href=https://github.com/sbamin/code101/blob/main/confs/hpc/user_env/.gitconfig>~/.gitconfig</a>, and make changes under line starting with name, email, and excludesfile. Make sure to <a href=https://git-scm.com/docs/git-config>read about gitconfig</a> too.</li> </ul> <div class="admonition tip"> <p class=admonition-title>Best practices using <code>mamba install</code> or <code>mamba update</code></p> <p>Keep a habit of checking following when using <code>mamba install</code> command:</p> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox><span class=task-list-indicator></span></label> Prefer <em>conda-forge</em> channel, followed by <em>bioconda</em>, and avoid installing packages from other channels. You can do so in dev or beta env, e.g., env <em>grogu</em> in my case to see how it pans out.</li> <li class=task-list-item><label class=task-list-control><input type=checkbox><span class=task-list-indicator></span></label> Before hitting <code>Y/Yes</code> to install packages, ensure that installing or updating packages does not force <strong>downgrading</strong> of one or more major packages, like python, R, and any other packages that you deem it as major package in your routine analysis and downgrading it may break reproducibility of your analysis. You can always use dev env, like <em>grogu</em> to play packages showing such downgrade warnings.</li> </ul> </div> <p>While doing <code>mamba install -c conda-forge samtools bcftools htslib</code>, I noticed <code>openssl</code> dependency being downgraded from v3.0.0 to v1.1.1. I find it a major downgrade to one of the core package and so I skipped installing samtools and related packages using <code>mamba</code>. I would rather install these packages by compiling from their respective source tar balls. You can <a href=http://www.htslib.org/download/ >read installation details for samtools family packages at author's website</a>.</p> <p>Similarly for <code>mamba install -c conda-forge bedtools pybedtools bedops</code>, I got following error as <em>yoda</em> env is using python 3.10 and it is pinned by default. So, it can not be downgraded! Similar to samtools, I will compile pybedtools or use a separate env, like <em>grogu</em> for such packages with <em>unique</em> requirements! For <code>bedops</code>, it was asking me to install older version of samtools which I was not ok with. I will rather compile those tools from the current version. So, finally I ended up installing only bedtools with clean requirements! <code>mamba install -c conda-forge bedtools</code>.</p> <div class=highlight><pre><span></span><code>package pybedtools-0.8.2-py39h39abbe0_1 requires python &gt;=3.9,&lt;3.10.0a0, but none of the providers can be installed
</code></pre></div> <h3 id=setup-rprofile-and-renviron>Setup Rprofile and Renviron<a class=headerlink href=#setup-rprofile-and-renviron title="Permanent link">&para;</a></h3> <p>Rprofile and Renviron files provide additional configuration option for R, similar to <em>~/.condarc</em> file to manage several conda-related configurations. You can read more about these files at <a href=https://cran.r-project.org/web/packages/startup/vignettes/startup-intro.html>R developer website</a> and <a href=https://support.rstudio.com/hc/en-us/articles/360047157094-Managing-R-with-Rprofile-Renviron-Rprofile-site-Renviron-site-rsession-conf-and-repos-conf>RStudio website</a>. For detailed notes, Jennifer Bryan and Jim Hester has written an excellent resources, titled <a href=https://rstats.wtf/ ><em>What they forgot to teach you about R</em></a> with a chapter on <a href=https://rstats.wtf/r-startup.html>R Startup</a>.</p> <ul> <li>Setup R library directory path for R 3.6</li> </ul> <p>Before setting up R startup, I will make a dedicated package directory that will store R libraries or packages. By default, R will store all libraries at conda env specific path, i.e., for my case, it is at <em>"${CONDA_PREFIX}"/lib/R/library/</em>. You can check this path using <code>Rscript -e '.libPaths()'</code>. This default path is ideally intended for R libraries managed via <code>mamba install</code> or <code>mamba update</code> command. However, I also compile R libraries using <code>install.packages()</code> R command when I find conflicting dependencies in installing R libraries using <code>mamba install</code> command. In such cases, I prefer to use a separate R library directory than a default R library path.</p> <blockquote> <p>I am making an empty library directory for installing libraries or R packages that I may compile using R <code>install.packages()</code> command. R usually defaults to making such user-package directory in the user's home path but I will use tier 1 space again to avoid filling up my home directory with a limited quota.</p> </blockquote> <div class=highlight><pre><span></span><code>mkdir -p /projects/verhaak-lab/amins/hpcenv/opt/R/pkgs/4.1
</code></pre></div> <ul> <li>Create <em>~/.Renviron</em> file</li> </ul> <div class=highlight><pre><span></span><code>nano ~/.Renviron
</code></pre></div> <blockquote> <p>Add following to <em>~/.Renviron</em>. Notice the order in which R will store newly compiled packages. It will use an empty directory we just created to store new packages. If for some reasons, this directory is not accessible (file permission errors), R will fallback to the second path, and so on. The second path is an expanded path of a default R package directory, i.e., output of <code>echo _"${CONDA_PREFIX}"/lib/R/library/_</code> command.</p> </blockquote> <div class=highlight><pre><span></span><code><span class=nv>R_LIBS</span><span class=o>=</span><span class=s2>&quot;/projects/verhaak-lab/amins/hpcenv/opt/R/pkgs/4.1:/projects/verhaak-lab/amins/hpcenv/mambaforge/envs/yoda/lib/R/library&quot;</span>
</code></pre></div> <blockquote> <p>You can confirm precedence of R library paths in R using <code>.libPaths()</code> R command or from bash using <code>Rscript -e '.libPaths()'</code>.</p> </blockquote> <ul> <li>Create <em>~/.Rprofile</em> file</li> </ul> <div class=highlight><pre><span></span><code>nano ~/.Rprofile
</code></pre></div> <blockquote> <p>Add following contents. Please read more about configuring R startup from links shared earlier in this section. Comment out lines using <code>#</code> if you do not require one or more of following options.</p> </blockquote> <div class=highlight><pre><span></span><code><span class=c1>## set user specific env variables, e.g., GITHUB_PAT here</span>
<span class=nf>Sys.setenv</span><span class=p>(</span><span class=s>&quot;GITHUB_PAT&quot;</span><span class=o>=</span><span class=s>&quot;my_github_secret_token&quot;</span><span class=p>)</span>

<span class=c1>## Default source to download packages</span>
<span class=nf>local</span><span class=p>({</span>
  <span class=n>r</span> <span class=o>&lt;-</span> <span class=nf>getOption</span><span class=p>(</span><span class=s>&quot;repos&quot;</span><span class=p>)</span>
  <span class=n>r</span><span class=p>[</span><span class=s>&quot;CRAN&quot;</span><span class=p>]</span> <span class=o>&lt;-</span> <span class=s>&quot;https://cran.rstudio.com&quot;</span>
  <span class=nf>options</span><span class=p>(</span><span class=n>repos</span> <span class=o>=</span> <span class=n>r</span><span class=p>)</span>
<span class=p>})</span>
</code></pre></div> <details class=tip><summary>Protect secret tokens, passwords, etc.</summary><p>If your <em>~/.Rprofile</em> file contains any secret tokens, it's a best practice to make it read/write only by file owner (you) using <code>chmod 600 ~/.Rprofile</code>. Same goes for similar files in your home directory, e.g., <em>.gitconfig</em>, <em>.netrc</em>, etc. Equivalent command for directory, e.g., for <em>.ssh/</em> is <code>chmod 700 ~/.ssh</code>. <a href=https://www.linux.com/training-tutorials/understanding-linux-file-permissions/ >Read more about linux file permissions</a>.</p> </details> <h3 id=compiling-r-libraries>Compiling R libraries<a class=headerlink href=#compiling-r-libraries title="Permanent link">&para;</a></h3> <p>Since we already have setup <em>yoda</em> env for R, you can now install additional R libraries using <code>mamba install r-PackageName</code> (<a href=#install-r-libraries>see above</a>) as long as it is available in <a href=https://anaconda.org/ >anaconda repository</a>, preferably in <em>conda-forge</em> or <em>bioconda</em> sources AND it does not significantly downgrades essential packages like python, R, and other core libraries, e.g., zlib, openssl, etc. The latter is subjective and depends on what you will consider as an essential. In any case where I have doubts of breaking conda env, I fall back to compiling R library using native R command: <code>install.packages()</code>. However, I am going to wait using this command until I have finished my HPC setup, specifically, <strong>bash startup</strong> using <em>~/.profile.d</em> configuration. We are not there yet but not far from it too!</p> <h2 id=install-essentials>Install essentials<a class=headerlink href=#install-essentials title="Permanent link">&para;</a></h2> <p>This can again vary per user's need and optional. If you find errors compiling packages, you may end up installing respective dev libraries, e.g., libiconv, zlib, etc. if they are not already installed in the current (<em>yoda</em> in this case) conda env.</p> <div class=highlight><pre><span></span><code>mamba install -c conda-forge wget curl rsync libiconv parallel ipyparallel
</code></pre></div> <h2 id=setup-jupyterlab>Setup JupyterLab<a class=headerlink href=#setup-jupyterlab title="Permanent link">&para;</a></h2> <p>We have installed JupyterLab <a href=#jupyterlab>earlier</a> but did not finish complete setup. Let's do that!</p> <p>In this section, I will setup jupyter notebook and kernels to launch python, R, and bash based notebooks. I will also harden notebook server with several security settings.</p> <p>Remember that we will be using JupyterLab installation from the conda <em>base</em> env even though JupyterLab could have been installed in <em>yoda</em> and other conda env. Managing jupyterlab server from <em>base</em> env is convenient and allows us to interact with all other env. Also, if we end up resetting or deleting other env, jupyter configuration in <em>base</em> env will remain intact. </p> <p>First, we install language-specific kernels. By default, jupyterlab ships with python kernel, named ipykernel which is backend when we interact with jupyter python notebook. Jupyter can allow us to use other language-specific kernels to interact with R, Julia, bash, and <a href=https://jupyter.org/try>many more languages</a>. Accordingly, I will install kernels for R and bash in specific envs, e.g., <em>yoda</em> and then switch back to <em>base</em> env to configure jupyterlab, such that we can connect to kernels in <em>yoda</em> env from conda <em>base</em> env.</p> <ul> <li>Make sure you are in <em>yoda</em> env. We will switch to <em>base</em> env after we configure all kernels in <em>yoda</em> env.</li> </ul> <div class=highlight><pre><span></span><code>conda activate yoda
</code></pre></div> <ul> <li>Install kernels</li> </ul> <div class=highlight><pre><span></span><code>mamba install -c conda-forge ipykernel r-irkernel bash_kernel
</code></pre></div> <blockquote> <p>Note that I have also installed python kernel, ipykernel in <em>yoda</em> env as we may not have jupyterlab installed in <em>yoda</em> as we only need to install jupyterlab in the <em>base</em> env.</p> <p>Also, some of kernels may already have been downloaded as part of dependency for other packages we installed earlier. You can check <code>conda list | grep kernel</code> output to confirm which kernels are already installed.</p> </blockquote> <p>Now we can link each of these kernels to jupyterlab in <em>base</em> env. </p> <h3 id=python-kernel>python kernel<a class=headerlink href=#python-kernel title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>python -m ipykernel install --user --name yoda_py310 --display-name <span class=s2>&quot;yoda_py310&quot;</span>
<span class=c1># confirm that installation exited without any error</span>
<span class=nb>echo</span> <span class=nv>$?</span>
<span class=c1># this should return 0 for successful installation</span>
</code></pre></div> <blockquote> <p>--name and --display-name will show up as kernel file location at <em>~/.local/share/jupyter/kernels/</em> and icon name in the jupyterlab launcher page, respectively. You can name as you like but without any spaces or special characters. I am following naming format that uses env followed by language and its major and minor version.</p> </blockquote> <h3 id=r-kernel>R kernel<a class=headerlink href=#r-kernel title="Permanent link">&para;</a></h3> <ul> <li>Start R session</li> </ul> <div class=highlight><pre><span></span><code>R
</code></pre></div> <ul> <li>Install kernel while in <em>yoda</em> env</li> </ul> <blockquote> <p><a href=https://irkernel.github.io/installation/ >Read available options</a> for IRkernel installation. Also, consider installing <a href=https://github.com/techrah/jupyterext-text-shortcuts>jupytertext-text-shortcuts</a> but <strong>not now</strong> and we can install this along with other extensions towards the end of configuring jupyterlab.</p> </blockquote> <div class=highlight><pre><span></span><code><span class=nf>library</span><span class=p>(</span><span class=n>IRkernel</span><span class=p>)</span>
<span class=nf>installspec</span><span class=p>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&quot;yoda_r41&quot;</span><span class=p>,</span> <span class=n>displayname</span> <span class=o>=</span> <span class=s>&quot;yoda_r41&quot;</span><span class=p>,</span> <span class=n>user</span> <span class=o>=</span> <span class=kc>TRUE</span><span class=p>)</span>

<span class=c1>## quit R session</span>
<span class=nf>q</span><span class=p>(</span><span class=n>save</span> <span class=o>=</span> <span class=s>&quot;no&quot;</span><span class=p>)</span>
</code></pre></div> <blockquote> <p>Similar to python kernel, r kernel should now be at <em>~/.local/share/jupyter/kernels/</em>.</p> </blockquote> <h3 id=bash-kernel>bash kernel<a class=headerlink href=#bash-kernel title="Permanent link">&para;</a></h3> <p>We will now install <a href=https://github.com/takluyver/bash_kernel>bash kernel</a> in <em>yoda</em> env. Unlike other (R and python) kernels, bash kernel do not need to be installed in all of conda env because we can always switch between conda env specific bash env using <code>mamba activate anakin</code> or <code>mamba activate rey</code>, etc.</p> <p>Here, I will install bash kernel in <em>yoda</em> and not <em>base</em> env as I intend to use <em>yoda</em> as my primary go-to env when I login to HPC.</p> <div class="admonition tip"> <p class=admonition-title>Keep use of <em>base</em> env to bare minimum</p> <p>Please remember that we keep use of <em>base</em> to bare minimum for maintaining core of codna packages, and should avoid installing (and populating dependencies) packages in <em>base</em> env. You can always delete secondary conda env and restart but you cannot do so with <em>base</em> env!</p> </div> <div class=highlight><pre><span></span><code><span class=c1>## in yoda env</span>
mamba list <span class=p>|</span> grep -E <span class=s2>&quot;bash_kernel&quot;</span>
<span class=c1>## if this does not show bash_kernel installed, redo install</span>
<span class=c1># mamba install -c conda-forge ipykernel r-irkernel bash_kernel</span>
<span class=c1>## and the install kernel into jupyter env</span>
python -m bash_kernel.install
</code></pre></div> <ul> <li>Unlike python and R kernels, I could not find overriding default name and display_name for bash kernel. So, I will rename bash kernel manually else if I end up installing similar kernel from other env, it will override kernel with the same default name: <em>bash</em>. Typically, you do not need to install <em>bash</em> kernels in all conda env as jupyterlab ships with a powerful terminal that allows switching from one to other env using same <code>conda activate</code> command. So, I hardly use bash kernel.</li> </ul> <div class=highlight><pre><span></span><code><span class=c1>## go to kernel base dir</span>
<span class=nb>cd</span> ~/.local/share/jupyter/kernels/

<span class=c1>## rename bash dir to yoda_bash</span>
mv bash yoda_bash

<span class=c1>## edit bash kernel.json to rename display name</span>
<span class=nb>cd</span> yoda_bash
nano kernel.json
</code></pre></div> <blockquote> <p>Rename <code>"display_name": "Bash"</code> to <code>"display_name": "yoda_bash"</code></p> </blockquote> <h3 id=kernel-loading>kernel loading<a class=headerlink href=#kernel-loading title="Permanent link">&para;</a></h3> <p>Following completion of the entire setup, we are going to run JupyterLab from the <em>base</em> env. However, on daily basis, we like to access Python and R from <em>yoda</em> and not <em>base</em><sup id=fnref:noRinbase><a class=footnote-ref href=#fn:noRinbase>1</a></sup>. Default kernel setup above should let jupyterlab handle conda env specific python but not so for other kernels.</p> <p>However, I have noticed issues running Python and R from a non <em>base</em> conda env as sometimes packages requiring shared libraries may throw an error as such shared libraries are either missing in <em>base</em> env or have a different version than one in the current env, i.e., <em>yoda</em> env where package was originally installed or compiled.</p> <p>I mitigate such issues by <strong>loading a valid bash env prior to initializing kernel</strong>, e.g., I will wrap a default jupyter kernel settings into a bash script (wrapper) and will activate a valid conda env, e.g., <em>yoda</em> in this case prior to initializing <em>yoda</em> specific Python or R kernel. That way, kernel will consistently inherit a valid login (bash) env for the respective conda env.</p> <h4 id=yoda-python>yoda python<a class=headerlink href=#yoda-python title="Permanent link">&para;</a></h4> <ul> <li>Create a new kernel wrapper matching name of kernel we like to edit, e.g., <em>/projects/verhaak-lab/amins/hpcenv/opt/kernels/wrap_yoda_py310</em></li> </ul> <div class=highlight><pre><span></span><code>mkdir -p /projects/verhaak-lab/amins/hpcenv/opt/kernels
touch /projects/verhaak-lab/amins/hpcenv/opt/kernels/wrap_yoda_py310

<span class=c1># make file executable</span>
chmod <span class=m>700</span> /projects/verhaak-lab/amins/hpcenv/opt/kernels/wrap_yoda_py310
</code></pre></div> <ul> <li>Add following to <em>wrap_yoda_py310</em> file. Change user paths where applicable.</li> </ul> <div class=highlight><pre><span></span><code>#!/bin/bash

## Load env before loading jupyter kernel
## @sbamin

## https://github.com/jupyterhub/jupyterhub/issues/847#issuecomment-260152425

#### Activate CONDA in subshell ####
## Read https://github.com/conda/conda/issues/7980
# I am using conda instead of mamba to activate env
# as somehow I notices warnings/errors sourcing
# mamba.sh in sub-shells.
CONDA_BASE=$(conda info --base) &amp;&amp; \
source &quot;${CONDA_BASE}&quot;/etc/profile.d/conda.sh &amp;&amp; \
conda activate yoda
#### END CONDA SETUP ####

# this is the critical part, and should be at the end of your script:
exec /projects/verhaak-lab/amins/hpcenv/mambaforge/envs/yoda/bin/python -m ipykernel_launcher &quot;$@&quot;

## Make sure to update corresponding kernel.json under ~/.local/share/jupyter/kernels/&lt;kernel_name&gt;/kernel.json

#_end_
</code></pre></div> <ul> <li>Now, adjust kernel settings.</li> </ul> <div class=highlight><pre><span></span><code><span class=c1>## go to kernel base dir</span>
<span class=nb>cd</span> ~/.local/share/jupyter/kernels/

<span class=c1>## there should be yoda_py310 directory or</span>
<span class=c1>## one matching --name yoda_py310 argument</span>
<span class=c1>## we used above when installing python kernel</span>
<span class=nb>cd</span> yoda_py310

<span class=c1>## edit kernel.json</span>
nano kernel.json
</code></pre></div> <ul> <li>Replace contents of <em>kernel.json</em> with following:</li> </ul> <div class=highlight><pre><span></span><code><span class=p>{</span><span class=w></span>
<span class=w> </span><span class=nt>&quot;argv&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w></span>
<span class=w>  </span><span class=s2>&quot;/projects/verhaak-lab/amins/hpcenv/opt/kernels/wrap_yoda_py310&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>  </span><span class=s2>&quot;-f&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>  </span><span class=s2>&quot;{connection_file}&quot;</span><span class=w></span>
<span class=w> </span><span class=p>],</span><span class=w></span>
<span class=w> </span><span class=nt>&quot;display_name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;yoda_py310&quot;</span><span class=p>,</span><span class=w></span>
<span class=w> </span><span class=nt>&quot;language&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;python&quot;</span><span class=p>,</span><span class=w></span>
<span class=w> </span><span class=nt>&quot;metadata&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span><span class=w></span>
<span class=w>  </span><span class=nt>&quot;debugger&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w></span>
<span class=w> </span><span class=p>}</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> <h4 id=yoda-r>yoda R<a class=headerlink href=#yoda-r title="Permanent link">&para;</a></h4> <p>Now, we can reconfigure R kernel for <em>yoda</em> same as above but with a few changes in the wrapper script.</p> <ul> <li>Create a new kernel wrapper for R, e.g., <em>/projects/verhaak-lab/amins/hpcenv/opt/kernels/wrap_yoda_r41</em></li> </ul> <div class=highlight><pre><span></span><code>mkdir -p /projects/verhaak-lab/amins/hpcenv/opt/kernels
touch /projects/verhaak-lab/amins/hpcenv/opt/kernels/wrap_yoda_r41

<span class=c1># make file executable</span>
chmod <span class=m>700</span> /projects/verhaak-lab/amins/hpcenv/opt/kernels/wrap_yoda_r41
</code></pre></div> <ul> <li>Add following to <em>wrap_yoda_r41</em> file. Change user paths where applicable.</li> </ul> <div class=highlight><pre><span></span><code>#!/bin/bash

## Load env before loading jupyter kernel @sbamin https://github.com/jupyterhub/jupyterhub/issues/847#issuecomment-260152425

#### Activate CONDA in subshell ####
## Read https://github.com/conda/conda/issues/7980
CONDA_BASE=$(conda info --base) &amp;&amp; \
source &quot;${CONDA_BASE}&quot;/etc/profile.d/conda.sh &amp;&amp; \
conda activate yoda
#### END CONDA SETUP ####

## this is the critical part, and should be at the end of your script:
## path to R and arguments come from original kernel.json under
## ~/.local/share/jupyter/kernels/yoda_r41/ directory.

## In some cases, path to R may differ and may originate from
## .../envs/yoda/lib64/R/bin/R instead of .../envs/rey/lib64/R/bin/R

## If so, adjust path to R here accordingly.
exec /projects/verhaak-lab/amins/hpcenv/mambaforge/envs/yoda/lib/R/bin/R --slave -e &quot;IRkernel::main()&quot; --args &quot;$@&quot;

## Make sure to update corresponding kernel.json under ~/.local/share/jupyter/kernels/&lt;kernel_name&gt;/kernel.json

#_end_
</code></pre></div> <ul> <li>Now, adjust kernel settings.</li> </ul> <div class=highlight><pre><span></span><code><span class=c1>## go to kernel base dir</span>
<span class=nb>cd</span> ~/.local/share/jupyter/kernels/

<span class=c1>## there should be yoda_py310 directory or</span>
<span class=c1>## one matching --name yoda_py310 argument</span>
<span class=c1>## we used above when installing python kernel</span>
<span class=nb>cd</span> yoda_r41

<span class=c1>## edit kernel.json</span>
nano kernel.json
</code></pre></div> <ul> <li>Replace contents of <em>kernel.json</em> with following:</li> </ul> <div class=highlight><pre><span></span><code><span class=p>{</span><span class=w></span>
<span class=w> </span><span class=nt>&quot;argv&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w></span>
<span class=w>  </span><span class=s2>&quot;/projects/verhaak-lab/amins/hpcenv/opt/kernels/wrap_yoda_r41&quot;</span><span class=p>,</span><span class=w></span>
<span class=w>  </span><span class=s2>&quot;{connection_file}&quot;</span><span class=w></span>
<span class=w> </span><span class=p>],</span><span class=w></span>
<span class=w> </span><span class=nt>&quot;display_name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;yoda_r41&quot;</span><span class=p>,</span><span class=w></span>
<span class=w> </span><span class=nt>&quot;language&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;R&quot;</span><span class=w></span>
<span class=p>}</span><span class=w></span>
</code></pre></div> <p>Done! Next time you run jupyter, you should have a new julia kernel in JupyterLab.</p> <h3 id=configure-jupyterlab>Configure JupyterLab<a class=headerlink href=#configure-jupyterlab title="Permanent link">&para;</a></h3> <p>Once we have installed env specific kernels as in <em>yoda</em> (and other envs, if a ny), now it's a time configure JupyterLab in the <em>base</em> env.</p> <div class=highlight><pre><span></span><code><span class=c1>## deactivate yoda env</span>
conda deactivate
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>You should now be in conda <em>base</em> env</p> <p>If you were jumping across more than one conda envs, then each instance of <code>conda deactivate</code> command will bring you back to previously active env. So, make sure to return to <em>base</em> env which you can confirm using <code>echo $CONDA_PREFIX</code> output. That should point to base path of conda (mambaforge in my case) installation: <em>/projects/verhaak-lab/amins/hpcenv/mambaforge/</em>. Also, notice change in bash prompt to <code>(base) userid@sumner50</code>.</p> </div> <ul> <li>Once in the <em>base</em> env, generate skeleton for default jupyter configuration.</li> </ul> <div class=highlight><pre><span></span><code><span class=c1>## return to home dir</span>
<span class=nb>cd</span> <span class=s2>&quot;</span><span class=si>${</span><span class=nv>HOME</span><span class=si>}</span><span class=s2>&quot;</span> <span class=o>&amp;&amp;</span> <span class=se>\</span>
jupyter server --generate-config
</code></pre></div> <blockquote> <p>Writing default config to: /home/userid/.jupyter/jupyter_notebook_config.py</p> </blockquote> <div class="admonition danger"> <p class=admonition-title>Secure Jupyter Server</p> <p>It is critical that you harden security of jupyterlab server. Default configuration is not good enough (in my view) for launching notebook server over HPC, especially without SSL (or <em>https</em>) support. Setting up individual security steps is beyond scope of this documentation. However, I strongly recommend reading official documentation on <a href=https://jupyter-server.readthedocs.io/en/latest/operators/public-server.html>running a public Jupyter Server</a> and <a href=https://jupyter-server.readthedocs.io/en/latest/operators/security.html>security in the jupyter server</a>.</p> <p>Checkout <a href=https://medium.com/@nyghtowl/setup-jupyter-notebook-access-on-google-compute-engine-with-https-ad69297f438b>this example guide</a> on creating self-signed SSL certificates in case you do not have SSL certificates from Research IT department.</p> </div> <h4 id=self-signed-ssl-certificates>self-signed SSL certificates<a class=headerlink href=#self-signed-ssl-certificates title="Permanent link">&para;</a></h4> <p>Ideally you should have SSL certificates signed by a verified certificate authority (CA) else most of modern web browsers will issue a warning or an error regarding SSL secutity. CA-signed SSLs are typically paid unless issued via <a href=https://letsencrypt.org/ >let's encrypt</a> or your DNS providers.</p> <p>Securing a website (Jupyter Env in our case) is beyond scope of this guide but I will suggest to inquire to your research IT department to see if they can help secure your Jupyter env. It's better to have CA-signed SSL over self-signed SSL, and always better to have SSL (https) over insecure (http) connection to your Jupyter env. This is true even when you are working within a secure firewall of your work network.</p> <p>Here, I am creating a self-signed SSL which most of you can generate and at least have self-signed SSL. <a href=https://medium.com/@nyghtowl/setup-jupyter-notebook-access-on-google-compute-engine-with-https-ad69297f438b>See this post for details</a>.</p> <div class=highlight><pre><span></span><code><span class=c1>## switch to base conda env</span>
mamba activate base

<span class=c1>## create dir to save SSL certificates</span>
mkdir ~/ssl_cert <span class=o>&amp;&amp;</span> <span class=se>\</span>
chmod <span class=m>700</span> ~/ssl_cert <span class=o>&amp;&amp;</span> <span class=se>\</span>
<span class=nb>cd</span> ~/ssl_cert

<span class=c1>## generate a private key</span>
openssl genrsa -out hpc_cert.key <span class=m>2048</span>

<span class=c1>## secure your private key</span>
chmod <span class=m>600</span> hpc_cert.key

<span class=c1>## create a signed certificate using a key we generated above</span>
openssl req -new -key hpc_cert.key -out hpc_cert.csr

<span class=c1>## finally self-sign this certicate</span>
openssl x509 -req -days <span class=m>365</span> -in hpc_cert.csr -signkey hpc_cert.key -out hpc_cert.pem
</code></pre></div> <blockquote> <p>While creating a signed certificate, <em>hpc_cert.csr</em>, you will be prompted to enter issuer's country, city, etc., including Common Name (CN). You should put some info related to use of this certificate into respective fields, e.g., Common Name can be <code>hpcjupyter</code>.</p> </blockquote> <div class="admonition warning"> <p class=admonition-title>SSL certificate - unable to verify SSL connection</p> <p>Regardless of what you put in CN, say <code>hpcjupyter.mywebsite.com</code>, most of modern web browsers so either SSL warning or error of not verifying your self-signed SSL. This is because you have self-signed this SSL and not using an approved certificate authority (CA) provider for signing your SSL. <a href=https://support.dnsimple.com/articles/what-is-common-name/ >Read this post for details</a>. In essense, your self-signed SSL is acting as it is an authentic SSL for a CN you provided above, <code>hpcjupyter.mywebsite.com</code>. Since that's a clearly a security risk, most modern browsers will throw a warning before you are allowed to visit a site (Jupyter server in this case) or even may not allow at all to load that website! Hence, prefer asking your Research IT to make a signed SSL available for a specific intranet subdomain, e.g., <code>jupyter.company.com</code> for users to use.</p> </div> <h4 id=cookie-file>cookie file<a class=headerlink href=#cookie-file title="Permanent link">&para;</a></h4> <ul> <li>After creating SSL certificates, also create a cookie file for jupyter server.</li> </ul> <div class=highlight><pre><span></span><code>openssl rand -hex <span class=m>32</span> &gt; /home/foo/ssl_cert/jp_cookie
chmod <span class=m>600</span> /home/foo/ssl_cert/jp_cookie
</code></pre></div> <h4 id=config-file>config file<a class=headerlink href=#config-file title="Permanent link">&para;</a></h4> <ul> <li>Example config for <em>/home/userid/.jupyter/jupyter_server_config.py</em>. <strong>Please do not copy and paste these options</strong> without knowing <a href=https://jupyter-notebook.readthedocs.io/en/stable/config.html>underlying details</a>.</li> </ul> <div class="admonition warning"> <p class=admonition-title>Jupyter token - provide a strong token string</p> <p>While editing jupyter config file below, please read inline comments carefully, especially for <code>c.ServerApp.token</code>. <strong>Do not use the default token as that token is used for login to your running jupyter server</strong>. Provide a secure (a longer string, 32 characters or more) string generated using <code>uuidgen</code> and after removing dashes.</p> <p>Do not worry of remembering this token. Jupyter does allow you to have an alternate way of login using a custom, user-generated password (see further below).</p> </div> <div class=highlight><pre><span></span><code><span class=c1>## leave commented out portion of default config as it is.</span>
<span class=c1>## then you can add your custom config</span>
<span class=c1>## Do not copy these configurations without knowing what they do!</span>

<span class=c1>#### NOTEBOOK CONFIGS ####</span>
<span class=c1>## SSL settings</span>
<span class=c1>## read documentation for details</span>
<span class=n>c</span><span class=o>.</span><span class=n>ServerApp</span><span class=o>.</span><span class=n>certfile</span> <span class=o>=</span> <span class=sa>u</span><span class=s1>&#39;/home/foo/ssl_cert/hpc_cert.csr&#39;</span>
<span class=n>c</span><span class=o>.</span><span class=n>ServerApp</span><span class=o>.</span><span class=n>keyfile</span> <span class=o>=</span> <span class=sa>u</span><span class=s1>&#39;/home/foo/ssl_cert/hpc_cert.key&#39;</span>

<span class=n>c</span><span class=o>.</span><span class=n>JupyterHub</span><span class=o>.</span><span class=n>cookie_secret_file</span> <span class=o>=</span> <span class=s1>&#39;/home/foo/ssl_cert/jp_cookie&#39;</span>
<span class=n>c</span><span class=o>.</span><span class=n>ServerApp</span><span class=o>.</span><span class=n>open_browser</span> <span class=o>=</span> <span class=kc>False</span>

<span class=c1>## token used to programmatically login to jupyter,</span>
<span class=c1>## e.g., via VS Code Jupyter extension.</span>
<span class=c1>## This is essentially a password to login to jupyter</span>
<span class=c1>## Provide an alphanumeric secret string - longer the better.</span>
<span class=c1>## you can create one using uuidgen command: Remove dashes.</span>
<span class=n>c</span><span class=o>.</span><span class=n>ServerApp</span><span class=o>.</span><span class=n>token</span> <span class=o>=</span> <span class=s1>&#39;PLEASE_REPLACE_THIS_TOKEN_c8syb2lnd89g2fosyyfskdfy02h&#39;</span>
<span class=n>c</span><span class=o>.</span><span class=n>ServerApp</span><span class=o>.</span><span class=n>allow_password_change</span> <span class=o>=</span> <span class=kc>False</span>

<span class=c1>## should be set to False</span>
<span class=c1>## unsafe to set True from https security point of view</span>
<span class=n>c</span><span class=o>.</span><span class=n>ServerApp</span><span class=o>.</span><span class=n>disable_check_xsrf</span> <span class=o>=</span> <span class=kc>False</span>

<span class=c1>## use one of available options: See documentation</span>
<span class=n>c</span><span class=o>.</span><span class=n>Application</span><span class=o>.</span><span class=n>log_level</span> <span class=o>=</span> <span class=s1>&#39;INFO&#39;</span>

<span class=c1>## use login shell</span>
<span class=n>c</span><span class=o>.</span><span class=n>ServerApp</span><span class=o>.</span><span class=n>terminado_settings</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;shell_command&#39;</span><span class=p>:[</span><span class=s1>&#39;bash&#39;</span><span class=p>,</span> <span class=s1>&#39;-l&#39;</span><span class=p>]}</span>
<span class=c1>## END ##</span>
</code></pre></div> <h4 id=jupyter-password>jupyter password<a class=headerlink href=#jupyter-password title="Permanent link">&para;</a></h4> <ul> <li> <p>Once you customize config file above, <strong>make sure to generate a secret and strong password using</strong> <code>jupyter server password</code> command. Your password then will be written in an encrypted format in <em>/home/userid/.jupyter/jupyter_server_config.json</em> file.</p> </li> <li> <p>Make both files read/write-only by you.</p> </li> </ul> <div class=highlight><pre><span></span><code><span class=c1>## for directory, we use permission 700</span>
chmod <span class=m>700</span> ~/.jupyter

<span class=c1># For files, we use permission 600</span>
chmod <span class=m>600</span> ~/.jupyter/jupyter_server_config.py
chmod <span class=m>600</span> ~/.jupyter/jupyter_server_config.json
</code></pre></div> <h3 id=customizing-user-interface>Customizing user interface<a class=headerlink href=#customizing-user-interface title="Permanent link">&para;</a></h3> <p>If you need to add custom themes, fonts, shortcuts, etc. for Jupyter, you may follow this section, else safe to skip to <a href=#start-jupyterlab>Start Jupyter</a> section.</p> <p>Before installing themes or customizing jupyterlab further, I will install <a href=https://nodejs.org/en/ >node js</a> package to <em>base</em> env.</p> <blockquote> <p>Ideally, <em>base</em> env should not be cluttered with packages except bare mininmum that comes with original conda installation (mambaforge in my case). However, node js is required to setup and manage jupyterlab extensions and how jupyterhub can interact with a few kernels, e.g., <code>jupyterlab-sql</code> extension to interact with sql databases that I will end up installing in the future.</p> </blockquote> <div class=highlight><pre><span></span><code>mamba install -c conda-forge nodejs
npm --version
</code></pre></div> <blockquote> <p>using v8.1.2</p> </blockquote> <h4 id=themes>Themes<a class=headerlink href=#themes title="Permanent link">&para;</a></h4> <p>Themes provide custom user interface and is optional for setup. See example themes at <a class="magiclink magiclink-github magiclink-repository" href=https://github.com/dunovank/jupyter-themes title="GitHub Repository: dunovank/jupyter-themes">dunovank/jupyter-themes</a></p> <div class=highlight><pre><span></span><code>mamba install -c conda-forge jupyterthemes
</code></pre></div> <blockquote> <p>Note: This may downgrade node js. Since I do not use node js in <em>base</em> and it is installed in <em>base</em> to manage jupyter extensions, I was ok downgrading it as it changed only <a href=https://en.wikipedia.org/wiki/Software_versioning>a build and not major or minor version</a>.</p> </blockquote> <ul> <li>setup theme, see <a href=https://github.com/dunovank/jupyter-themes>details here</a></li> </ul> <div class=highlight><pre><span></span><code>jt -t solarizedl -T -N -f firacode -fs <span class=m>12</span> -tf ptserif -tfs <span class=m>11</span> -nf ptsans -nfs <span class=m>12</span> -dfs <span class=m>11</span> -ofs <span class=m>10</span> -cellw <span class=m>90</span>% -lineh <span class=m>170</span>
</code></pre></div> <h4 id=keyboard-shortcuts>keyboard shortcuts<a class=headerlink href=#keyboard-shortcuts title="Permanent link">&para;</a></h4> <p>If you are familiar with RStudio shortcuts for R pipe <code>%&gt;%</code> and assignment <code>&lt;-</code> operator, you can enable those in JupyterLab too<sup id=fnref:ref_kbr><a class=footnote-ref href=#fn:ref_kbr>2</a></sup> by first starting a jupyterlab session. You can then go to <code>Advanced Settings Editor</code> either by pressing <span class=keys><kbd class=key-command>Cmd</kbd><span>+</span><kbd class=key-comma>,</kbd></span> on a mac or go to <code>Settings</code> from a top menubar, and then clicking <code>Keyboard Shortcuts</code> option. There, under <code>User Preferences</code> pane, you can paste following to enable keyboard shortcuts, i.e., <span class=keys><kbd class=key-alt>Alt</kbd><span>+</span><kbd class=key-minus>-</kbd></span> for <code>&lt;-</code> and <span class=keys><kbd class=key-shift>Shift</kbd><span>+</span><kbd class=key-command>Cmd</kbd><span>+</span><kbd class=key-m>M</kbd></span> for <code>%&gt;%</code> operator.</p> <div class=highlight><pre><span></span><code>{
    &quot;shortcuts&quot;: [
        {
            &quot;command&quot;: &quot;apputils:run-first-enabled&quot;,
            &quot;selector&quot;: &quot;body&quot;,
            &quot;keys&quot;: [&quot;Alt -&quot;],
            &quot;args&quot;: {
                &quot;commands&quot;: [
                    &quot;console:replace-selection&quot;,
                    &quot;fileeditor:replace-selection&quot;,
                    &quot;notebook:replace-selection&quot;,
                ],
                &quot;args&quot;: {&quot;text&quot;: &quot; &lt;- &quot;}
            }
        },
        {
            &quot;command&quot;: &quot;apputils:run-first-enabled&quot;,
            &quot;selector&quot;: &quot;body&quot;,
            &quot;keys&quot;: [&quot;Accel Shift M&quot;],
            &quot;args&quot;: {
                &quot;commands&quot;: [
                    &quot;console:replace-selection&quot;,
                    &quot;fileeditor:replace-selection&quot;,
                    &quot;notebook:replace-selection&quot;,
                ],
                &quot;args&quot;: {&quot;text&quot;: &quot; %&gt;% &quot;}
            }
        }
    ]
}
</code></pre></div> <h4 id=gpg-signatures>gpg signatures<a class=headerlink href=#gpg-signatures title="Permanent link">&para;</a></h4> <p>Import gpg keys, if any for <a href=https://docs.github.com/en/authentication/managing-commit-signature-verification/signing-commits>code signing</a>. More at <a href=https://unix.stackexchange.com/a/392355/28675>https://unix.stackexchange.com/a/392355/28675</a></p> <p>Earlier I installed required gpg packages, <em>gpg</em> and <em>python-gnupg</em> but they ended up conflicting with <code>gpg-agent</code> that is running by the system gpg at <code>/usr/bin/gpg</code>. So, I have to remove both conda packages in order to use system gpg at <code>/usr/bin/</code>.</p> <div class=highlight><pre><span></span><code>mamba remove -c conda-forge gnupg python-gnupg
</code></pre></div> <div class="admonition warning"> <p class=admonition-title>Removing packages using <code>mamba remove</code></p> <p>This also removed several other packages which were required by gpg packages but not by other packages still present in <em>conda</em> env. However, over time, you may end up compiling softwares outside of conda env but still using certain dependencies installed via conda. If so, be careful running <code>mamba remove</code> command as it <strong>can not check dependencies for softwares installed outside conda env</strong>, and removing packages like below may break your compiled tools.</p> </div> <div class=highlight><pre><span></span><code>  - gnupg           2.3.3  h7853c96_0     installed         
  - libassuan       2.5.5  h9c3ff4c_0     installed         
  - libgcrypt       1.9.4  h7f98852_0     installed         
  - libgpg-error     1.42  h9c3ff4c_0     installed         
  - libksba         1.3.5  hf484d3e_1000  installed         
  - npth              1.6  hf484d3e_1000  installed         
  - ntbtls          0.1.2  hdbcaa40_1000  installed         
  - python-gnupg    0.4.8  pyhd8ed1ab_0   installed 
</code></pre></div> <div class="admonition danger"> <p class=admonition-title>Careful with gpg command</p> <p>For code signing, you do not need private keys and public keys works ok. <strong>Make sure to check gpg documentation before running these commands.</strong> Incorrect use may expose your private keys (worst if you push incorrect keys to a public gpg server!) and defeats the purpose of encryption.</p> </div> <div class=highlight><pre><span></span><code><span class=c1>## list public keys, if any</span>
<span class=c1>## This will setup ~/.gnupg dir if running command for the first time</span>
<span class=c1>## Do chmod 700 ~/.gnupg in case dir perm are not correctly set</span>
gpg --list-keys

gpg --allow-secret-key-import --import private_public.key

<span class=c1>## list public keys</span>
gpg --list-keys

<span class=c1>## set trust level</span>
<span class=c1>## set a valid trust level after reading documentation</span>
gpg --edit-key <span class=o>{</span>KEY<span class=o>}</span> trust quit

<span class=c1>## list secret keys</span>
gpg --list-secret-keys
</code></pre></div> <h4 id=rmate>rmate<a class=headerlink href=#rmate title="Permanent link">&para;</a></h4> <p>I user <code>rmate</code> command to open remote files on HPC in the text editor like Atom or SublimeText on my macbook.</p> <ul> <li>Prefer installing <a href=https://github.com/textmate/rmate>standalone binary</a> over ruby-based (<code>gem install rmate</code>) command. If you prefer ruby based installation, better to add ruby installation in a separate conda env, e.g., in <em>luke</em> or other backend env.</li> </ul> <div class=highlight><pre><span></span><code><span class=c1># in base env</span>

<span class=c1>## download standalone binary and save as rmate in ~/bin/</span>
mkdir -p ~/bin
curl -Lo ~/bin/rmate https://raw.githubusercontent.com/textmate/rmate/master/bin/rmate
chmod <span class=m>700</span> ~/bin/rmate
</code></pre></div> <blockquote> <p><a href=https://github.com/textmate/rmate>Read usage instructions</a> for more on using <code>rmate</code> command.</p> </blockquote> <h2 id=backup-conda-env>Backup conda env<a class=headerlink href=#backup-conda-env title="Permanent link">&para;</a></h2> <p>Let's backup conda setup we have done so far. I will backup configurations for each of conda env we created above. I have created a small wrapper, <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path fill-rule=evenodd d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0 1 14.25 15h-9a.75.75 0 0 1 0-1.5h9a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 10 4.25V1.5H5.75a.25.25 0 0 0-.25.25v2.5a.75.75 0 0 1-1.5 0v-2.5zm7.5-.188V4.25c0 .138.112.25.25.25h2.688a.252.252 0 0 0-.011-.013l-2.914-2.914a.272.272 0 0 0-.013-.011zM5.72 6.72a.75.75 0 0 0 0 1.06l1.47 1.47-1.47 1.47a.75.75 0 1 0 1.06 1.06l2-2a.75.75 0 0 0 0-1.06l-2-2a.75.75 0 0 0-1.06 0zM3.28 7.78a.75.75 0 0 0-1.06-1.06l-2 2a.75.75 0 0 0 0 1.06l2 2a.75.75 0 0 0 1.06-1.06L1.81 9.25l1.47-1.47z"/></svg></span> <a href=https://github.com/sbamin/code101/blob/main/confs/hpc/user_env/bin/conda_bkup.sh>conda_bkup.sh</a> - using <a href=https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html><code>conda env export</code> and <code>conda list</code> commands</a> - to backup conda env. </p> <ul> <li>Base or root env</li> </ul> <blockquote> <p>~/conda_env_bkup/sumner/base/<timestamp>/</p> </blockquote> <div class=highlight><pre><span></span><code>conda_bkup.sh
</code></pre></div> <ul> <li>dev env</li> </ul> <blockquote> <p>~/conda_env_bkup/sumner/yoda/<timestamp>/</p> </blockquote> <div class=highlight><pre><span></span><code>conda activate yoda <span class=o>&amp;&amp;</span> <span class=se>\</span>
conda_bkup.sh

<span class=c1>## return to base env</span>
conda deactivate
</code></pre></div> <h2 id=start-jupyterlab>Start JupyterLab<a class=headerlink href=#start-jupyterlab title="Permanent link">&para;</a></h2> <ul> <li><strong>Optional:</strong> Install several tools in <em>base</em> env.</li> </ul> <div class=highlight><pre><span></span><code><span class=c1># I use dos2unix often to fix line endings for</span>
<span class=c1># files created from windows (dos2unix) or mac (mac2unix)</span>

<span class=c1>## A few other packages for jupyterlab extensions</span>
mamba install -c conda-forge jupyter_http_over_ws jupyterlab-link-share dos2unix

<span class=c1>## check for successful install</span>
<span class=nb>echo</span> <span class=nv>$?</span>

<span class=c1># Run only if you have installed jupyter_http_over_ws AND</span>
<span class=c1># you are familiar with managing jupyter server backend.</span>
<span class=c1># jupyter server extension enable --py jupyter_http_over_ws</span>
</code></pre></div> <ul> <li>Test jupyterlab run.</li> </ul> <div class="admonition warning"> <p class=admonition-title>☠️ Use SSL and password protection ☠️</p> <p>Avoid running notebook server without SSL and proper password and token configuration as <a href=#configure-jupyterlab>detailed above</a>) else you may encounter a significant data security risk.</p> </div> <div class=highlight><pre><span></span><code>mkdir -p ~/tmp/jupyter/sumner

<span class=c1>## capture LAN IP for a login or compute node</span>
<span class=c1>## https://stackoverflow.com/a/3232433</span>
<span class=nv>REMOTEIP</span><span class=o>=</span><span class=s2>&quot;</span><span class=k>$(</span>hostname -I <span class=p>|</span> head -n1 <span class=p>|</span> xargs<span class=k>)</span><span class=s2>&quot;</span>

<span class=c1>## test run from a login or compute node</span>
<span class=c1>## SSL related settings will be inherited from jupyter config file that </span>
<span class=c1>## we already have created as above.</span>
jupyter lab --no-browser --ip<span class=o>=</span><span class=s2>&quot;</span><span class=si>${</span><span class=nv>REMOTEIP</span><span class=si>}</span><span class=s2>&quot;</span> <span class=p>|&amp;</span> tee -a ~/tmp/jupyter/sumner/runtime.log
</code></pre></div> <ul> <li>Once a jupyter session begins and assuming you are on a secure local area network, you can open URL: <code>https://&lt;REMOTEIP&gt;:&lt;PORT&gt;/lab</code> to launch jupyter lab. Here, <code>&lt;PORT&gt;</code> is randomly assigned when you start a server and URL will be displayed on the terminal or in a log file at <em>~/tmp/jupyter/sumner/runtime.log</em>.</li> </ul> <div class="admonition warning"> <p class=admonition-title>Run jupyterlab from a compute and not login node</p> <p><strong>Avoid running JupyterLab server on a login node.</strong> It will most likely be killed by HPC admins. For longer running and compute-intensive jupyterlab sessions, it is preferable to run jupyterlab from a compute and not a login node. This requires series of secure port forwarding which is beyond the scope of current documentation. However, your HPC may already have support for running JupyterLab on a compute node, e.g, similar to this one at <a href=https://hpc-unibe-ch.github.io/software/JupyterLab.html>Univ. of Bern</a> or <a href=https://researchcomputing.princeton.edu/support/knowledge-base/jupyter>Princeton Univ.</a>. Talk to your HPC staff for policies on running JupyterLab server.</p> </div> <p>Before continuing setup (not over yet!), let's logout and login first from interactive job and exit HPC.</p> <div class=highlight><pre><span></span><code><span class=nb>exit</span> <span class=c1># from interactive session</span>
<span class=nb>exit</span> <span class=c1># from sumner</span>

ssh sumner
</code></pre></div> <p><a href=../sumner_3/ >In Part 3</a>, I will finalize setting up Sumner (or CPU-based) HPC and also install a dedicated conda env for Winter (GPU-based) HPC. If you like to stop here, you may except I prefer that you follow <a href=https://code.sbamin.com//hpc/cpu/sumner_3/#bash-startup>bash startup</a> section in Part 3, so that conda and program-specific (R and python) environment variables are consistently loaded across HPC bash user env.</p> <div class=footnote> <hr> <ol> <li id=fn:noRinbase> <p>Notice that there is no R in the <em>base</em> env. So, hitting R will not start R session unless you do <code>mamba activate yoda</code>!&#160;<a class=footnote-backref href=#fnref:noRinbase title="Jump back to footnote 1 in the text">&#8617;</a></p> </li> <li id=fn:ref_kbr> <p>Based on a reply from <a class="magiclink magiclink-github magiclink-mention" href=https://github.com/krassowski title="GitHub User: krassowski">@krassowski</a> at <a href=https://github.com/jupyterlab/jupyterlab/issues/10114#issuecomment-821993321>JupyterLab forums</a>&#160;<a class=footnote-backref href=#fnref:ref_kbr title="Jump back to footnote 2 in the text">&#8617;</a></p> </li> </ol> </div> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2022-08-28</span> </small> </div> <p><small>Author: <a href=https://sbamin.com/about rel=me>Samir B. Amin</a> <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></span><a href=https://twitter.com/sbamin>@sbamin</a></small></p> <h2 id=__comments>Comments</h2> <p>Comments are powered by <span class=twemoji><svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path fill-rule=evenodd d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg></span> <a href=https://github.com/sbamin/code101/issues>GitHub issues</a> and requires a login with a github id.</p> <script src=https://utteranc.es/client.js repo=sbamin/code101 issue-term=title label="site issues :speech_balloon:" theme=github-light crossorigin=anonymous async>
		</script> <!-- Reload on palette change --> <script>
	var palette = __md_get("__palette")
	if (palette && typeof palette.color === "object")
	  if (palette.color.scheme === "slate") {
	  	
	    	var utterances = document.querySelector("script[src*=utteranc]")
	    	utterances.setAttribute("theme", "github-dark")
	    
	  }

	/* Register event handlers after documented loaded */
	document.addEventListener("DOMContentLoaded", function() {
	  var ref = document.querySelector("[data-md-component=palette]")
	  ref.addEventListener("change", function() {
	    var palette = __md_get("__palette")
	    if (palette && typeof palette.color === "object") {
	    	// reload theme for either giscus or utterances
	    	
				/* Instruct Utterances to change theme */
				// https://github.com/utterance/utterances/issues/549#issuecomment-907606127
				var frame = document.querySelector(".utterances-frame")
				var theme = palette.color.scheme === "slate" ? "github-dark" : "github-light"
				const message = {
					type: 'set-theme',
					theme: theme
				};
      	  		const iframe = document.querySelector('.utterances-frame');
      	  		iframe.contentWindow.postMessage(message, 'https://utteranc.es');
			
	    }
	  })
	})
	</script> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <!-- Footer --> <footer class=md-footer> <!-- Link to previous and/or next page --> <nav class="md-footer__inner md-grid" aria-label=Footer> <!-- Link to previous page --> <a href=../sumner_1/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Part 1" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Part 1 </div> </div> </a> <!-- Link to next page --> <a href=../sumner_3/ class="md-footer__link md-footer__link--next" aria-label="Next: Part 3" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Part 3 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <!-- Further information --> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <!-- Copyright and theme information --> <div class=md-copyright> <div class=md-copyright__highlight> &copy; 2003-2022: <a href=https://sbamin.com title=Home>SBAmin.com</a> | <a href=/disclosure/ >Disclosure</a> </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <!-- Social links --> <div class=md-social> <a href=https://sbamin.com/about target=_blank rel=noopener title=sbamin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path fill-rule=evenodd d="M10.5 5a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0zm.061 3.073a4 4 0 1 0-5.123 0 6.004 6.004 0 0 0-3.431 5.142.75.75 0 0 0 1.498.07 4.5 4.5 0 0 1 8.99 0 .75.75 0 1 0 1.498-.07 6.005 6.005 0 0 0-3.432-5.142z"/></svg> </a> <a href=https://twitter.com/sbamin target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://linkedin.com/in/samiramin/ target=_blank rel=noopener title=linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=https://github.com/sbamin target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://sbamin.com/contact target=_blank rel=noopener title=sbamin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M0 128c0-35.35 28.65-64 64-64h384c35.3 0 64 28.65 64 64v256c0 35.3-28.7 64-64 64H64c-35.35 0-64-28.7-64-64V128zm48 0v22.1l172.5 141.6c20.6 17 50.4 17 71 0L464 150.1v-23c0-7.9-7.2-16-16-16H64c-8.84 0-16 8.1-16 16v.9zm0 84.2V384c0 8.8 7.16 16 16 16h384c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.6 31.5-132.9 0L48 212.2z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs", "navigation.instant", "navigation.top", "navigation.indexes", "navigation.sections", "content.code.annotate", "search.suggest", "search.highlight", "search.share"], "search": "../../../assets/javascripts/workers/search.85cb4492.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script> <script src=../../../assets/javascripts/bundle.431f3d41.min.js></script> <script src=../../../assets/js/extra.js></script> <script src=../../../assets/js/mathjax.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.2.1/tablesort.min.js></script> <script src=../../../assets/js/tables.js></script> </body> </html>